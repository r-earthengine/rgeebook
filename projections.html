<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Projections | Earth Engine with R</title>
<meta name="author" content="rgee team">
<meta name="generator" content="bookdown 0.25.2 with bs4_book()">
<meta property="og:title" content="Projections | Earth Engine with R">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Projections | Earth Engine with R">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-141212623-1"></script><script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-141212623-1');
  </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<meta name="description" content="This section requires the next libraries: library(rgee) library(rgeeExtra) ee_Initialize() Earth Engine is designed so that you rarely have to worry about map projections when doing computations....">
<meta property="og:description" content="This section requires the next libraries: library(rgee) library(rgeeExtra) ee_Initialize() Earth Engine is designed so that you rarely have to worry about map projections when doing computations....">
<meta name="twitter:description" content="This section requires the next libraries: library(rgee) library(rgeeExtra) ee_Initialize() Earth Engine is designed so that you rarely have to worry about map projections when doing computations....">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Earth Engine with R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="earthengine-examples.html">earthengine-examples</a></li>
<li><a class="" href="rgee-cheatsheet.html">rgee-cheatsheet</a></li>
<li class="book-part">R Guides</li>
<li><a class="" href="overview.html">Overview</a></li>
<li><a class="" href="rgeeextra.html">rgeeExtra</a></li>
<li><a class="" href="visualization.html">Visualization</a></li>
<li class="book-part">Get Started</li>
<li><a class="" href="r-quickstart.html">R Quickstart</a></li>
<li><a class="" href="coding-best-practices.html">Coding Best Practices</a></li>
<li><a class="" href="debugging.html">Debugging</a></li>
<li class="book-part">Development Environments</li>
<li><a class="" href="earth-engine-in-rstudio.html">Earth Engine in Rstudio</a></li>
<li><a class="" href="r-and-python-requirements.html">R and Python requirements</a></li>
<li><a class="" href="sync-gcs-and-rgee.html">sync GCS and rgee</a></li>
<li><a class="" href="integrate-rmarkdown-and-rgee.html">Integrate Rmarkdown and rgee</a></li>
<li><a class="" href="deploy-rgee-shiny-apps.html">Deploy rgee Shiny apps</a></li>
<li><a class="" href="comparing-rgee-vs-python-and-javascript.html">Comparing rgee vs Python and Javascript</a></li>
<li><a class="" href="extra-considerations.html">Extra considerations</a></li>
<li class="book-part">API Tutorials</li>
<li><a class="" href="overview-1.html">Overview</a></li>
<li><a class="" href="introduction-to-r-for-earth-engine.html">Introduction to R for Earth Engine</a></li>
<li><a class="" href="the-earth-engine-api.html">The Earth Engine API</a></li>
<li><a class="" href="global-forest-change.html">Global Forest Change</a></li>
<li><a class="" href="global-surface-water.html">Global Surface Water</a></li>
<li><a class="" href="video-tutorials-1.html">Video Tutorials</a></li>
<li class="book-part">Concepts</li>
<li><a class="" href="how-earth-engine-works.html">How Earth Engine works</a></li>
<li><a class="" href="client-vs-server.html">Client vs Server</a></li>
<li><a class="" href="deferred-exacution.html">Deferred exacution</a></li>
<li><a class="" href="scale.html">Scale</a></li>
<li><a class="active" href="projections.html">Projections</a></li>
<li class="book-part">Objects and Methods</li>
<li><a class="" href="objects-and-methods-overview.html">Objects and Methods Overview</a></li>
<li><a class="" href="image.html">Image</a></li>
<li><a class="" href="imagecollection.html">ImageCollection</a></li>
<li><a class="" href="geometry.html">Geometry</a></li>
<li><a class="" href="feature-featurecollection.html">Feature &amp; FeatureCollection</a></li>
<li><a class="" href="reducer.html">Reducer</a></li>
<li><a class="" href="join.html">Join</a></li>
<li><a class="" href="array.html">Array</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/r-earthengine/rgeebook">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="projections" class="section level1 unnumbered">
<h1>Projections<a class="anchor" aria-label="anchor" href="#projections"><i class="fas fa-link"></i></a>
</h1>
<p>This section requires the next libraries:</p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/rgee/">rgee</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rgeeExtra</span><span class="op">)</span>

<span class="fu">ee_Initialize</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Earth Engine is designed so that you rarely have to worry about map projections when doing computations. As with scale, the projection in which computations take place is determined on a “pull” basis. Specifically, inputs are requested in the output projection. The output may be determined from a function parameter (e.g. <code>crs</code>), the <code>Map</code> in the Rstudio (which has a <a href="http://epsg.io/3857">maps mercator (EPSG:3857)</a> projection), or with a <code>reproject()</code> call. When you display images in the Rstudio, inputs are requested in <a href="http://epsg.io/3857">maps mercator</a>. Consider the following simple operation on a MODIS image, which has a <a href="http://spatialreference.org/ref/sr-org/6974/">sinusoidal</a> projection:</p>
<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The input image has a SR-ORG:6974 (sinusoidal) projection.</span>
<span class="va">image</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"MODIS/006/MOD13A1/2014_05_09"</span><span class="op">)</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>

<span class="co"># Normalize the image and add it to the map.</span>
<span class="va">rescaled</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="fu">unitScale</span><span class="op">(</span><span class="op">-</span><span class="fl">2000</span>, <span class="fl">10000</span><span class="op">)</span>
<span class="va">visParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">0.15</span>, max <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">rescaled</span>, <span class="va">visParams</span>, <span class="st">"Rescaled"</span><span class="op">)</span></code></pre></div>
<center>
<img src="images/chapter_04/figure_PRJ_code_01.png" width="95%">
</center>
<p>The order of operations for this code sample is diagrammed in Figure 1. Note that the projection of the input is determined by the output, specifically the <a href="http://epsg.io/3857">maps mercator</a> projection of the map display in the Rstudio. This projection propagates back through the sequence of operations such that the inputs are requested in maps mercator, at a scale determined by the zoom level of the map.</p>
<center>
<img src="images/chapter_04/figure_PRJ_01.png" width="60%">
</center>
<p>Figure 1. Flow chart of operations corresponding to the display of a MODIS image in the Rstudio map. Projections (left side of flow chart) of each operation are determined from the output. Curved lines indicate the flow of information to the reprojection: specifically, the output projection and scale.</p>
<p>In Earth Engine, projections are specified by a Coordinate Reference System (CRS or the <code>crs</code> parameter of many methods). You can check the projection of an image by calling <code>projection()</code> on it:</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">image</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"LANDSAT/LC08/C01/T1/LC08_044034_20140318"</span><span class="op">)</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>

<span class="co"># Projection, crs, and crs_transform</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">image</span><span class="op">$</span><span class="fu">projection</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Scale in meters:"</span>, <span class="va">image</span><span class="op">$</span><span class="fu">projection</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">nominalScale</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note that by calling <code>nominalScale()</code> on the <code>ee$Projection</code> returned by <code>projection()</code>, you can determine the native resolution of the image. The native resolution is the nominal pixel scale in meters of the lowest level of the <a href="https://r-earthengine.com/rgeebook/scale.html">image pyramid</a>. Because each band of an image can have a different scale and/or projection, if you call <code>projection()</code> on an image with at least one band that doesn’t have the same projection as the others, you may see an error like:</p>
<div id="the-default-projection" class="section level2 unnumbered">
<h2>The default projection<a class="anchor" aria-label="anchor" href="#the-default-projection"><i class="fas fa-link"></i></a>
</h2>
<p>Unless you need your computation to occur in a specific projection, there is generally no need to specify a projection. Only for output that’s ambiguous will Earth Engine require you to specify a projection and/or scale. Ambiguity can result from reducing an <code>ImageCollection</code> containing images with different projections (i.e. <a href="">creating a composite</a>). An image which is a composite or mosaic of input images with different projections will have the default projection, which is <a href="https://epsg.io/4326">WGS84</a> with 1-degree scale. For example:</p>
<div class="sourceCode" id="cb291"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">collection</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">ImageCollection</span><span class="op">(</span><span class="st">"LANDSAT/LC08/C01/T1"</span><span class="op">)</span>
<span class="va">mosaic</span> <span class="op">&lt;-</span> <span class="va">collection</span><span class="op">$</span><span class="fu">mosaic</span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">mosaic</span><span class="op">$</span><span class="fu">projection</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>If you try to use an image like this in a computation, you may see an error like:</p>
<p>Generally, an aggregation at 1-degree scale is not desired or intended, so Earth Engine gives this friendly reminder to provide a complete specification for the output.</p>
<p>Users often find this behavior confusing and worry about the “lost” projection information, but the pixels aren’t actually computed until they’re needed (<a href="https://r-earthengine.com/rgeebook/deferred-exacution.html">learn more</a>), and at that point, there’s always an output projection that accompanies the request that specified how to compute the composite.</p>
<p>In the vast majority of use cases, having no projection is not a problem and is actually a valuable optimization, as it allows previewing the results at any zoom level without having to wait for the full resolution computation to complete. But it does mean that the output can appear different at different zoom levels.</p>
<p>If the optimized display image somehow isn’t sufficient, computation in a specific projection can be forced by reprojecting the output as described in the following section.</p>
</div>
<div id="reprojecting" class="section level2 unnumbered">
<h2>Reprojecting<a class="anchor" aria-label="anchor" href="#reprojecting"><i class="fas fa-link"></i></a>
</h2>
<p>You can force operations to be performed in a specific projection with the <code>reproject()</code> method. Using <code>reproject()</code> results in the inputs being requested in the projection specified in the <code>reproject()</code> call. Computations in your code before the <code>reproject()</code> call will be done in the specified projection. For example, to force a composite to be produced in a specific projection:</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Some projection that is suitable for your area of interest.</span>
<span class="va">proj</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Projection</span><span class="op">(</span><span class="va">...</span><span class="op">)</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="va">collection</span><span class="op">$</span><span class="fu">reduce</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">$</span><span class="fu">reproject</span><span class="op">(</span><span class="va">proj</span><span class="op">)</span></code></pre></div>
<p>A few cases that require a fixed projection include:</p>
<ul>
<li>Computing gradients (e.g. <code>ee$Terrain$gradient</code> or <code>ee$Terrain$slope</code>).</li>
<li>
<code>reduceResolution</code>, for when you want to aggregate higher resolution pixels into lower resolution.</li>
</ul>
<p>There are several reasons you should avoid using <code>reproject()</code> unless you absolutely need to. Suppose, for example, you reproject something and add it to the map. If the scale you specified in the <code>reproject()</code> call is much smaller than the zoom level of the map, Earth Engine will request all the inputs at very small scale, over a very wide spatial extent. This can result in much too much data being requested at once and lead to an error.</p>
<p>If the eventual output is in a different projection from that specified in the <code>reproject()</code> call, that will result in another reprojection. This is another reason to be cautious about using <code>reproject()</code> in your code. Consider the following example, which forces the MODIS image to first be reprojected to <a href="https://epsg.io/4326">WGS84</a>, then reprojected to <a href="http://epsg.io/3857">maps mercator</a> for display in the Rstudio map:</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># The input image has a SR-ORG:6974 (sinusoidal) projection.</span>
<span class="va">image</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"MODIS/006/MOD13A1/2014_05_09"</span><span class="op">)</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>

<span class="co"># Operations *before* the reproject call will be done in the projection</span>
<span class="co"># specified by reproject().  The output results in another reprojection.</span>
<span class="va">reprojected</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span>
  <span class="fu">unitScale</span><span class="op">(</span><span class="op">-</span><span class="fl">2000</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">reproject</span><span class="op">(</span><span class="st">"EPSG:4326"</span>, <span class="cn">NULL</span>, <span class="fl">500</span><span class="op">)</span>

<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">reprojected</span>, <span class="va">visParams</span>, <span class="st">"Reprojected"</span><span class="op">)</span></code></pre></div>
<center>
<img src="images/chapter_04/figure_PRJ_code_02.png" width="95%">
</center>
<p>Figure diagrams the flow of operations corresponding to this simple reprojection example. Note that the first reprojection is explicit, as specified in the <code>reproject()</code> call. The second reprojection is implicit, performed by Earth Engine automatically in order to display the result on the map. Also observe that the information about what projection to use propagates back from the request to the input.</p>
<center>
<img src="images/chapter_04/figure_PRJ_02.png" width="60%">
</center>
<p>Figure: Flow chart of operations corresponding to the reprojection of a MODIS image in the Rstudio map. Curved lines indicate the flow of information to the reprojections: specifically, the output projection and scale.</p>

</div>
</div>



<div class="sourceCode" id="cb294"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/rgee/">rgee</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rgeeExtra</span><span class="op">)</span>

<span class="fu">ee_Initialize</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>This section requires the next libraries:</p>
<div class="sourceCode" id="cb295"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/rgee/">rgee</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rgeeExtra</span><span class="op">)</span>

<span class="fu">ee_Initialize</span><span class="op">(</span><span class="op">)</span>

<span class="va">`+`</span> <span class="op">&lt;-</span> <span class="va">paste0</span></code></pre></div>
<div class="chapter-nav">
<div class="prev"><a href="scale.html">Scale</a></div>
<div class="next"><a href="objects-and-methods-overview.html">Objects and Methods Overview</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#projections">Projections</a></li>
<li><a class="nav-link" href="#the-default-projection">The default projection</a></li>
<li><a class="nav-link" href="#reprojecting">Reprojecting</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/r-earthengine/rgeebook/blob/master/chapters/04_concepts.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/r-earthengine/rgeebook/edit/master/chapters/04_concepts.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Earth Engine with R</strong>" was written by rgee team. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
