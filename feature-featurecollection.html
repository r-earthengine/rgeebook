<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Feature &amp; FeatureCollection | Earth Engine with R</title>
<meta name="author" content="rgee team">
<meta name="generator" content="bookdown 0.25.2 with bs4_book()">
<meta property="og:title" content="Feature &amp; FeatureCollection | Earth Engine with R">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Feature &amp; FeatureCollection | Earth Engine with R">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-141212623-1"></script><script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-141212623-1');
  </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<meta name="description" content="This section requires the next libraries: library(rgee) library(rgeeExtra) ee_Initialize() Feature Overview A Feature in Earth Engine is defined as a GeoJSON Feature. Specifically, a Feature is an...">
<meta property="og:description" content="This section requires the next libraries: library(rgee) library(rgeeExtra) ee_Initialize() Feature Overview A Feature in Earth Engine is defined as a GeoJSON Feature. Specifically, a Feature is an...">
<meta name="twitter:description" content="This section requires the next libraries: library(rgee) library(rgeeExtra) ee_Initialize() Feature Overview A Feature in Earth Engine is defined as a GeoJSON Feature. Specifically, a Feature is an...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Earth Engine with R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="earthengine-examples.html">earthengine-examples</a></li>
<li><a class="" href="rgee-cheatsheet.html">rgee-cheatsheet</a></li>
<li class="book-part">R Guides</li>
<li><a class="" href="overview.html">Overview</a></li>
<li><a class="" href="rgeeextra.html">rgeeExtra</a></li>
<li><a class="" href="visualization.html">Visualization</a></li>
<li class="book-part">Get Started</li>
<li><a class="" href="r-quickstart.html">R Quickstart</a></li>
<li><a class="" href="coding-best-practices.html">Coding Best Practices</a></li>
<li><a class="" href="debugging.html">Debugging</a></li>
<li class="book-part">Development Environments</li>
<li><a class="" href="earth-engine-in-rstudio.html">Earth Engine in Rstudio</a></li>
<li><a class="" href="r-and-python-requirements.html">R and Python requirements</a></li>
<li><a class="" href="sync-gcs-and-rgee.html">sync GCS and rgee</a></li>
<li><a class="" href="integrate-rmarkdown-and-rgee.html">Integrate Rmarkdown and rgee</a></li>
<li><a class="" href="deploy-rgee-shiny-apps.html">Deploy rgee Shiny apps</a></li>
<li><a class="" href="comparing-rgee-vs-python-and-javascript.html">Comparing rgee vs Python and Javascript</a></li>
<li><a class="" href="extra-considerations.html">Extra considerations</a></li>
<li class="book-part">API Tutorials</li>
<li><a class="" href="overview-1.html">Overview</a></li>
<li><a class="" href="introduction-to-r-for-earth-engine.html">Introduction to R for Earth Engine</a></li>
<li><a class="" href="the-earth-engine-api.html">The Earth Engine API</a></li>
<li><a class="" href="global-forest-change.html">Global Forest Change</a></li>
<li><a class="" href="global-surface-water.html">Global Surface Water</a></li>
<li><a class="" href="video-tutorials-1.html">Video Tutorials</a></li>
<li class="book-part">Concepts</li>
<li><a class="" href="how-earth-engine-works.html">How Earth Engine works</a></li>
<li><a class="" href="client-vs-server.html">Client vs Server</a></li>
<li><a class="" href="deferred-exacution.html">Deferred exacution</a></li>
<li><a class="" href="scale.html">Scale</a></li>
<li><a class="" href="projections.html">Projections</a></li>
<li class="book-part">Objects and Methods</li>
<li><a class="" href="objects-and-methods-overview.html">Objects and Methods Overview</a></li>
<li><a class="" href="image.html">Image</a></li>
<li><a class="" href="imagecollection.html">ImageCollection</a></li>
<li><a class="" href="geometry.html">Geometry</a></li>
<li><a class="active" href="feature-featurecollection.html">Feature &amp; FeatureCollection</a></li>
<li><a class="" href="reducer.html">Reducer</a></li>
<li><a class="" href="join.html">Join</a></li>
<li><a class="" href="array.html">Array</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/r-earthengine/rgeebook">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="feature-featurecollection" class="section level1 unnumbered">
<h1>Feature &amp; FeatureCollection<a class="anchor" aria-label="anchor" href="#feature-featurecollection"><i class="fas fa-link"></i></a>
</h1>
<p>This section requires the next libraries:</p>
<div class="sourceCode" id="cb402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/rgee/">rgee</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rgeeExtra</span><span class="op">)</span>

<span class="fu">ee_Initialize</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div id="feature-overview" class="section level2 unnumbered">
<h2>Feature Overview<a class="anchor" aria-label="anchor" href="#feature-overview"><i class="fas fa-link"></i></a>
</h2>
<p>A <code>Feature</code> in Earth Engine is defined as a GeoJSON Feature. Specifically, a <code>Feature</code> is an object with a <code>geometry</code> property storing a <code>Geometry</code> object (or <strong>NULL</strong>) and a <code>properties</code> property storing a dictionary of other properties.</p>
<div id="creating-feature-objects" class="section level3 unnumbered">
<h3>Creating Feature objects<a class="anchor" aria-label="anchor" href="#creating-feature-objects"><i class="fas fa-link"></i></a>
</h3>
<p>To create a <code>Feature</code>, provide the constructor with a <code>Geometry</code> and (optionally) a dictionary of other properties. For example:</p>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create an ee$Geometry.</span>
<span class="va">polygon</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Polygon</span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">35</span>, <span class="op">-</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="op">-</span><span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">35</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">35</span>, <span class="op">-</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Create a Feature from the Geometry.</span>
<span class="va">polyFeature</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Feature</span><span class="op">(</span><span class="va">polygon</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">foo</span><span class="op">&lt;-</span> <span class="fl">42</span>, <span class="va">bar</span><span class="op">&lt;-</span> <span class="st">"tart"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>As with a <code>Geometry</code>, a <code>Feature</code> may be printed or added to the map for inspection and visualization:</p>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Feature</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">polyFeature</span><span class="op">)</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">polyFeature</span>,
  <span class="op">{</span><span class="op">}</span>,
  <span class="st">"feature"</span>
<span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_01.png" width="95%"><p>A Feature need not have a Geometry and may simply wrap a dictionary of properties. For example:</p>
<div class="sourceCode" id="cb405"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a dictionary of properties, some of which may be computed values.</span>
<span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">foo</span><span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Number</span><span class="op">(</span><span class="fl">8</span><span class="op">)</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="fl">88</span><span class="op">)</span>, <span class="va">bar</span><span class="op">&lt;-</span> <span class="st">"nihao"</span><span class="op">)</span>

<span class="co"># Create a NULL geometry feature with the dictionary of properties.</span>
<span class="va">nowhereFeature</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Feature</span><span class="op">(</span><span class="cn">NULL</span>, <span class="va">dict</span><span class="op">)</span></code></pre></div>
<p>In this example, note that the dictionary supplied to the <code>Feature</code> contains a computed value. Creating features in this manner is useful for exporting long-running computations with a <code>Dictionary</code> result (e.g. <code>image$reduceRegion()</code>). See the <a href="">FeatureCollections</a> and <a href="">Importing Table Data</a> or <a href="">Exporting</a> guides for details.</p>
<p>Each <code>Feature</code> has one primary <code>Geometry</code> stored in the <code>geometry</code> property. Additional geometries may be stored in other properties. <code>Geometry</code> methods such as intersection and buffer also exist on Feature as a convenience for getting the primary <code>Geometry</code>, applying the operation, and setting the result as the new primary <code>Geometry</code>. The result will retain all the other properties of the <code>Feature</code> on which the method is called. There are also methods for getting and setting the non-geometry properties of the <code>Feature</code>. For example:</p>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make a feature and set some properties.</span>
<span class="va">feature</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Feature</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Point</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">122.22599</span>, <span class="fl">37.17605</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">set</span><span class="op">(</span><span class="st">"genus"</span>, <span class="st">"Sequoia"</span><span class="op">)</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"sempervirens"</span><span class="op">)</span>

<span class="co"># Get a property from the feature.</span>
<span class="va">species</span> <span class="op">&lt;-</span> <span class="va">feature</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"species"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Feature</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Set a new property.</span>
<span class="va">feature</span> <span class="op">&lt;-</span> <span class="va">feature</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"presence"</span>, <span class="fl">1</span><span class="op">)</span>

<span class="co"># Overwrite the old properties with a new dictionary.</span>
<span class="va">newDict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">genus</span><span class="op">&lt;-</span> <span class="st">"Brachyramphus"</span>, <span class="va">species</span><span class="op">&lt;-</span> <span class="st">"marmoratus"</span><span class="op">)</span>
<span class="va">feature</span> <span class="op">&lt;-</span> <span class="va">feature</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="va">newDict</span><span class="op">)</span>

<span class="co"># Check the result.</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Feature</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">feature</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>In the previous example, note that properties can be set with either a key: value pair, or with a list as a r literal. Also note that <code>feature$set()</code> overwrites existing properties.</p>
</div>
</div>
<div id="featurecollection-overview" class="section level2 unnumbered">
<h2>FeatureCollection Overview<a class="anchor" aria-label="anchor" href="#featurecollection-overview"><i class="fas fa-link"></i></a>
</h2>
<p>Groups of related features can be combined into a <code>FeatureCollection</code>, to enable additional operations on the entire set such as filtering, sorting and rendering. Besides just simple features (geometry + properties), feature collections can also contain other collections.</p>
<div id="the-featurecollection-constructor" class="section level3 unnumbered">
<h3>The <code>FeatureCollection</code> constructor<a class="anchor" aria-label="anchor" href="#the-featurecollection-constructor"><i class="fas fa-link"></i></a>
</h3>
<p>One way to create a <code>FeatureCollection</code> is to provide the constructor with a list of features. The features do not need to have the same geometry type or the same properties. For example:</p>
<div class="sourceCode" id="cb407"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make a list of Features.</span>
<span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="va">ee</span><span class="op">$</span><span class="fu">Feature</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Rectangle</span><span class="op">(</span><span class="fl">30.01</span>, <span class="fl">59.80</span>, <span class="fl">30.59</span>, <span class="fl">60.15</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">name</span><span class="op">&lt;-</span> <span class="st">"Voronoi"</span><span class="op">)</span><span class="op">)</span>,
  <span class="va">ee</span><span class="op">$</span><span class="fu">Feature</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Point</span><span class="op">(</span><span class="op">-</span><span class="fl">73.96</span>, <span class="fl">40.781</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">name</span><span class="op">&lt;-</span> <span class="st">"Thiessen"</span><span class="op">)</span><span class="op">)</span>,
  <span class="va">ee</span><span class="op">$</span><span class="fu">Feature</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Point</span><span class="op">(</span><span class="fl">6.4806</span>, <span class="fl">50.8012</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">name</span><span class="op">&lt;-</span> <span class="st">"Dirichlet"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Create a FeatureCollection from the list and print it.</span>
<span class="va">fromList</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">FeatureCollection</span><span class="op">(</span><span class="va">features</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">FeatureCollection</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">fromList</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Individual geometries can also be turned into a <code>FeatureCollection</code> of just one <code>Feature</code>:</p>
<div class="sourceCode" id="cb408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a FeatureCollection from a single geometry and print it.</span>
<span class="va">fromGeom</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">FeatureCollection</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Point</span><span class="op">(</span><span class="fl">16.37</span>, <span class="fl">48.225</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">FeatureCollection</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">fromGeom</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="table-datasets" class="section level3 unnumbered">
<h3>Table Datasets<a class="anchor" aria-label="anchor" href="#table-datasets"><i class="fas fa-link"></i></a>
</h3>
<p>Earth Engine hosts a variety of table datasets. To load a table dataset, provide the table ID to the <code>FeatureCollection</code> constructor. For example, to load TIGER roads data:</p>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fc</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">FeatureCollection</span><span class="op">(</span><span class="st">"TIGER/2016/Roads"</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">setCenter</span><span class="op">(</span><span class="op">-</span><span class="fl">73.9596</span>, <span class="fl">40.7688</span>, <span class="fl">12</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">fc</span>,
  <span class="op">{</span><span class="op">}</span>,
  <span class="st">"Census roads"</span>
<span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_02.png" width="95%"><p>Note that as with image datasets, you can search for table datasets and import them into your script using the <a href="">Rstudio search tool</a> or discover them in the <a href="https:#developers.google.com/earth-engine/datasets">Earth Engine Data Catalog</a>.</p>
</div>
<div id="random-samples" class="section level3 unnumbered">
<h3>Random Samples<a class="anchor" aria-label="anchor" href="#random-samples"><i class="fas fa-link"></i></a>
</h3>
<p>To get a collection of random points in a specified region, you can use:</p>
<div class="sourceCode" id="cb410"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define an arbitrary region in which to compute random points.</span>
<span class="va">region</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Rectangle</span><span class="op">(</span><span class="op">-</span><span class="fl">119.224</span>, <span class="fl">34.669</span>, <span class="op">-</span><span class="fl">99.536</span>, <span class="fl">50.064</span><span class="op">)</span>

<span class="co"># Create 1000 random points in the region.</span>
<span class="va">randomPoints</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">FeatureCollection</span><span class="op">$</span><span class="fu">randomPoints</span><span class="op">(</span><span class="va">region</span><span class="op">)</span>

<span class="co"># Display the points.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">centerObject</span><span class="op">(</span><span class="va">randomPoints</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">randomPoints</span>,
  <span class="op">{</span><span class="op">}</span>,
  <span class="st">"random points"</span>
<span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_03.png" width="95%">
</div>
</div>
<div id="feature-and-featurecollection-visualization" class="section level2 unnumbered">
<h2>Feature and FeatureCollection Visualization<a class="anchor" aria-label="anchor" href="#feature-and-featurecollection-visualization"><i class="fas fa-link"></i></a>
</h2>
<p>As with images, geometries and features, feature collections can be added to the map directly with <code>Map$addLayer()</code>. The default visualization will display the vectors with solid black lines and semi-opaque black fill. To render the vectors in color, specify the <code>color</code> parameter. The following displays the ‘RESOLVE’ ecoregions (<a href="https:#academic.oup.com/bioscience/article/67/6/534/3102935">Dinerstein et al. 2017</a>) as the default visualization and in red:</p>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load a FeatureCollection from a table dataset: 'RESOLVE' ecoregions.</span>
<span class="va">ecoregions</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">FeatureCollection</span><span class="op">(</span><span class="st">"RESOLVE/ECOREGIONS/2017"</span><span class="op">)</span>

<span class="co"># Display as default and with a custom color.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">ecoregions</span>,
  <span class="op">{</span><span class="op">}</span>,
  <span class="st">"default display"</span>
<span class="op">)</span> <span class="op">|</span>
  <span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
    <span class="va">ecoregions</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">color</span><span class="op">&lt;-</span> <span class="st">"FF0000"</span><span class="op">)</span>,
    <span class="st">"colored"</span>
  <span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_04.png" width="95%"><p>For additional display options, use <code>featureCollection$draw()</code>. Specifically, parameters <code>pointRadius</code> and <code>strokeWidth</code> control the size of points and lines, respectively, in the rendered <code>FeatureCollection</code>:</p>
<div class="sourceCode" id="cb412"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">ecoregions</span><span class="op">$</span><span class="fu">draw</span><span class="op">(</span><span class="va">color</span><span class="op">&lt;-</span> <span class="st">"006600"</span>, <span class="va">strokeWidth</span><span class="op">&lt;-</span> <span class="fl">5</span><span class="op">)</span>,
  <span class="op">{</span><span class="op">}</span>,
  <span class="st">"drawn"</span>
<span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_05.png" width="95%"><p>The output of <code>draw()</code> is an image with red, green and blue bands set according to the specified <code>color</code> parameter.</p>
<p>For more control over how a <code>FeatureCollection</code> is displayed, use <code>image$paint()</code> with the <code>FeatureCollection</code> as an argument. Unlike <code>draw()</code>, which outputs a three-band, 8-bit display image, <code>image$paint()</code> outputs an image with the specified numeric value ‘painted’ into it. Alternatively, you can supply the name of a property in the <code>FeatureCollection</code> which contains the numbers to paint. The <code>width</code> parameter behaves the same way: it can be a constant or the name of a property with a number for the line width. For example:</p>
<div class="sourceCode" id="cb413"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create an empty image into which to paint the features, cast to byte.</span>
<span class="va">empty</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">byte</span><span class="op">(</span><span class="op">)</span>

<span class="co"># Paint all the polygon edges with the same number and width, display.</span>
<span class="va">outline</span> <span class="op">&lt;-</span> <span class="va">empty</span><span class="op">$</span><span class="fu">paint</span><span class="op">(</span>
  <span class="va">featureCollection</span><span class="op">&lt;-</span> <span class="va">ecoregions</span>,
  <span class="va">color</span><span class="op">&lt;-</span> <span class="fl">1</span>,
  <span class="va">width</span><span class="op">&lt;-</span> <span class="fl">3</span>
<span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">outline</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">palette</span><span class="op">&lt;-</span> <span class="st">"FF0000"</span><span class="op">)</span>,
  <span class="st">"edges"</span>
<span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_06.png" width="95%"><p>Note that the empty image into which you paint the features needs to be cast prior to painting. This is because a constant image behaves as a constant: it is clamped to the initialization value. To color the feature edges with values set from a property of the features, set the color parameter to the name of the property with numeric values:</p>
<div class="sourceCode" id="cb414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Paint the edges with different colors, display.</span>
<span class="va">outlines</span> <span class="op">&lt;-</span> <span class="va">empty</span><span class="op">$</span><span class="fu">paint</span><span class="op">(</span>
  <span class="va">featureCollection</span><span class="op">&lt;-</span> <span class="va">ecoregions</span>,
  <span class="va">color</span><span class="op">&lt;-</span> <span class="st">"BIOME_NUM"</span>,
  <span class="va">width</span><span class="op">&lt;-</span> <span class="fl">4</span>
<span class="op">)</span>

<span class="va">palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FF0000"</span>, <span class="st">"00FF00"</span>, <span class="st">"0000FF"</span><span class="op">)</span>

<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">outlines</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">palette</span><span class="op">&lt;-</span> <span class="va">palette</span>, <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">14</span><span class="op">)</span>,
  <span class="st">"different color edges"</span>
<span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_07.png" width="95%"><p>Both the color and width with which the boundaries are drawn can be set with properties. For example:</p>
<div class="sourceCode" id="cb415"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Paint the edges with different colors and widths.</span>
<span class="va">outlines</span> <span class="op">&lt;-</span> <span class="va">empty</span><span class="op">$</span><span class="fu">paint</span><span class="op">(</span>
  <span class="va">featureCollection</span><span class="op">&lt;-</span> <span class="va">ecoregions</span>,
  <span class="va">color</span><span class="op">&lt;-</span> <span class="st">"BIOME_NUM"</span>,
  <span class="va">width</span><span class="op">&lt;-</span> <span class="st">"NNH"</span>
<span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">outlines</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">palette</span><span class="op">&lt;-</span> <span class="va">palette</span>, <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">14</span><span class="op">)</span>,
  <span class="st">"different color, width edges"</span>
<span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_08.png" width="95%"><p>If the <code>width</code> parameter is not provided, the interior of the features is painted:</p>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Paint the interior of the polygons with different colors.</span>
<span class="va">fills</span> <span class="op">&lt;-</span> <span class="va">empty</span><span class="op">$</span><span class="fu">paint</span><span class="op">(</span>
  <span class="va">featureCollection</span><span class="op">&lt;-</span> <span class="va">ecoregions</span>,
  <span class="va">color</span><span class="op">&lt;-</span> <span class="st">"BIOME_NUM"</span>
<span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">fills</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">palette</span><span class="op">&lt;-</span> <span class="va">palette</span>, <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">14</span><span class="op">)</span>,
  <span class="st">"colored fills"</span>
<span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_09.png" width="95%"><p>To render both the interior and edges of the features, paint the empty image twice:</p>
<div class="sourceCode" id="cb417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Paint both the fill and the edges.</span>
<span class="va">filledOutlines</span> <span class="op">&lt;-</span> <span class="va">empty</span><span class="op">$</span><span class="fu">paint</span><span class="op">(</span><span class="va">ecoregions</span>, <span class="st">"BIOME_NUM"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">paint</span><span class="op">(</span><span class="va">ecoregions</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>

<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">filledOutlines</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="va">palette</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"000000"</span>, <span class="va">palette</span><span class="op">)</span>,
    <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">14</span>
  <span class="op">)</span>, <span class="st">"edges and fills"</span>
<span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_10.png" width="95%">
</div>
<div id="featurecollection-information-and-metadata" class="section level2 unnumbered">
<h2>FeatureCollection Information and Metadata<a class="anchor" aria-label="anchor" href="#featurecollection-information-and-metadata"><i class="fas fa-link"></i></a>
</h2>
<p>Methods for getting information from feature collection metadata are the same as those for image collections. See the <a href="">ImageCollection Information and Metadata section</a> for details.</p>
<div id="metadata-aggregation" class="section level3 unnumbered">
<h3>Metadata aggregation<a class="anchor" aria-label="anchor" href="#metadata-aggregation"><i class="fas fa-link"></i></a>
</h3>
<p>You can use the aggregation shortcuts to count the number of features or summarize an attribute:</p>
<div class="sourceCode" id="cb418"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load watersheds from a data table.</span>
<span class="va">sheds</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">FeatureCollection</span><span class="op">(</span><span class="st">"USGS/WBD/2017/HUC06"</span><span class="op">)</span><span class="op">$</span>
  <span class="co"># Filter to the continental US.</span>
  <span class="fu">filterBounds</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Rectangle</span><span class="op">(</span><span class="op">-</span><span class="fl">127.18</span>, <span class="fl">19.39</span>, <span class="op">-</span><span class="fl">62.75</span>, <span class="fl">51.29</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
  <span class="co"># Convert 'areasqkm' property from string to number.</span>
  <span class="fu">map</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">feature</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">num</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Number</span><span class="op">$</span><span class="fu">parse</span><span class="op">(</span><span class="va">feature</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"areasqkm"</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">feature</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"areasqkm"</span>, <span class="va">num</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="co"># Display the table and print its first element.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">sheds</span>,
  <span class="op">{</span><span class="op">}</span>,
  <span class="st">"watersheds"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"First watershed"</span>, <span class="va">ee</span><span class="op">$</span><span class="va">Number</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">sheds</span><span class="op">$</span><span class="fu">first</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Print the number of watersheds.</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Count: "</span>, <span class="va">ee</span><span class="op">$</span><span class="va">Number</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">sheds</span><span class="op">$</span><span class="fu">size</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Print stats for an area property.</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Area stats: "</span>, <span class="va">ee</span><span class="op">$</span><span class="va">Number</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">sheds</span><span class="op">$</span><span class="fu">aggregate_stats</span><span class="op">(</span><span class="st">"areasqkm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_11.png" width="95%">
</div>
<div id="column-information" class="section level3 unnumbered">
<h3>Column information<a class="anchor" aria-label="anchor" href="#column-information"><i class="fas fa-link"></i></a>
</h3>
<p>Knowing the names and dataypes of <code>FeatureCollection</code> columns can be helpful (e.g., <a href="">filtering a collection by metadata</a>). The following example prints column names and datatypes for a collection of point features representing protected areas.</p>
<div class="sourceCode" id="cb419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Import a protected areas point feature collection.</span>
<span class="va">wdpa</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">FeatureCollection</span><span class="op">(</span><span class="st">"WCMC/WDPA/current/points"</span><span class="op">)</span>

<span class="co"># Fetch collection metadata (`.limit(0)`) and the printed object is a</span>
<span class="co"># DataFrame where keys are column names and values are datatypes.</span>
<span class="va">wdpa</span><span class="op">$</span><span class="fu">limit</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">column</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>For more general purpose <code>FeatureCollection</code> aggregation tools, see the <a href="">Reducing a FeatureCollection</a> page.</p>
</div>
</div>
<div id="filtering-a-featurecollection" class="section level2 unnumbered">
<h2>Filtering a FeatureCollection<a class="anchor" aria-label="anchor" href="#filtering-a-featurecollection"><i class="fas fa-link"></i></a>
</h2>
<p>Filtering a <code>FeatureCollection</code> is analogous to filtering an <code>ImageCollection</code>. (See the <a href="">Filtering an ImageCollection section</a>). There are the <code>featureCollection$filterDate()</code>, and <code>featureCollection$filterBounds()</code> convenience methods and the <code>featureCollection$filter()</code> method for use with any applicable <code>ee$Filter</code>. For example:</p>
<div class="sourceCode" id="cb420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load watersheds from a data table.</span>
<span class="va">sheds</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">FeatureCollection</span><span class="op">(</span><span class="st">"USGS/WBD/2017/HUC06"</span><span class="op">)</span><span class="op">$</span>
  <span class="co"># Convert 'areasqkm' property from string to number.</span>
  <span class="fu">map</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">feature</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">num</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Number</span><span class="op">$</span><span class="fu">parse</span><span class="op">(</span><span class="va">feature</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"areasqkm"</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">feature</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"areasqkm"</span>, <span class="va">num</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="co"># Define a region roughly covering the continental US.</span>
<span class="va">continentalUS</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Rectangle</span><span class="op">(</span><span class="op">-</span><span class="fl">127.18</span>, <span class="fl">19.39</span>, <span class="op">-</span><span class="fl">62.75</span>, <span class="fl">51.29</span><span class="op">)</span>

<span class="co"># Filter the table geographically: only watersheds in the continental US.</span>
<span class="va">filtered</span> <span class="op">&lt;-</span> <span class="va">sheds</span><span class="op">$</span><span class="fu">filterBounds</span><span class="op">(</span><span class="va">continentalUS</span><span class="op">)</span>

<span class="co"># Check the number of watersheds after filtering for location.</span>
<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Count after filter:"</span>, <span class="va">ee</span><span class="op">$</span><span class="va">Number</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">filtered</span><span class="op">$</span><span class="fu">size</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Filter to get only larger continental US watersheds.</span>
<span class="va">largeSheds</span> <span class="op">&lt;-</span> <span class="va">filtered</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Filter</span><span class="op">$</span><span class="fu">gt</span><span class="op">(</span><span class="st">"areasqkm"</span>, <span class="fl">25000</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Check the number of watersheds after filtering for size and location.</span>
<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Count after filtering by size:"</span>, <span class="va">ee</span><span class="op">$</span><span class="va">Number</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">largeSheds</span><span class="op">$</span><span class="fu">size</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="mapping-over-a-featurecollection" class="section level2 unnumbered">
<h2>Mapping over a FeatureCollection<a class="anchor" aria-label="anchor" href="#mapping-over-a-featurecollection"><i class="fas fa-link"></i></a>
</h2>
<p>To apply the same operation to every <code>Feature</code> in a <code>FeatureCollection</code>, use <code>featureCollection$map()</code>. For example, to add another area attribute to every feature in a watersheds <code>FeatureCollection</code>, use:</p>
<div class="sourceCode" id="cb421"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load watersheds from a data table.</span>
<span class="va">sheds</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">FeatureCollection</span><span class="op">(</span><span class="st">"USGS/WBD/2017/HUC06"</span><span class="op">)</span>

<span class="co"># This function computes the feature's geometry area and adds it as a property.</span>
<span class="va">addArea</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">feature</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">feature</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">lareaHa</span><span class="op">&lt;-</span> <span class="va">feature</span><span class="op">$</span><span class="fu">geometry</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">area</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">divide</span><span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Map the area getting function over the FeatureCollection.</span>
<span class="va">areaAdded</span> <span class="op">&lt;-</span> <span class="va">sheds</span><span class="op">$</span><span class="fu">map</span><span class="op">(</span><span class="va">addArea</span><span class="op">)</span>

<span class="co"># Print the first feature from the collection with the added property.</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Element</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">areaAdded</span><span class="op">$</span><span class="fu">first</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>In the previous example, note that a new property is set based on a computation with the feature’s geometry. Properties can also be set using a computation involving existing properties.</p>
<p>An entirely new <code>FeatureCollection</code> can be generated with <code>map()</code>. The following example converts the watersheds to centroids:</p>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># This function creates a new feature from the centroid of the geometry.</span>
<span class="va">getCentroid</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">feature</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Keep this list of properties.</span>
  <span class="va">keepProperties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"huc6"</span>, <span class="st">"tnmid"</span>, <span class="st">"areasqkm"</span><span class="op">)</span>
  <span class="co"># Get the centroid of the feature's geometry.</span>
  <span class="va">centroid</span> <span class="op">&lt;-</span> <span class="va">feature</span><span class="op">$</span><span class="fu">geometry</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">centroid</span><span class="op">(</span><span class="op">)</span>
  <span class="co"># Return a new Feature, copying properties from the old Feature.</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="fu">Feature</span><span class="op">(</span><span class="va">centroid</span><span class="op">)</span><span class="op">$</span><span class="fu">copyProperties</span><span class="op">(</span><span class="va">feature</span>, <span class="va">keepProperties</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Map the centroid getting function over the features.</span>
<span class="va">centroids</span> <span class="op">&lt;-</span> <span class="va">sheds</span><span class="op">$</span><span class="fu">map</span><span class="op">(</span><span class="va">getCentroid</span><span class="op">)</span>

<span class="co"># Display the results.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">centroids</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">color</span><span class="op">&lt;-</span> <span class="st">"FF0000"</span><span class="op">)</span>, <span class="st">"centroids"</span><span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_12.png" width="95%"><p>Note that only a subset of properties is propagated to the features in the new collection.</p>
</div>
<div id="reducing-a-featurecollection" class="section level2 unnumbered">
<h2>Reducing a FeatureCollection<a class="anchor" aria-label="anchor" href="#reducing-a-featurecollection"><i class="fas fa-link"></i></a>
</h2>
<p>To aggregate data in the properties of a <code>FeatureCollection</code>, use <code>featureCollection$reduceColumns()</code>. For example, to check the area properties in the watersheds <code>FeatureCollection</code>, this code computes the Root Mean Square Error (RMSE) relative to the Earth Engine computed area:</p>
<div class="sourceCode" id="cb423"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load watersheds from a data table and filter to the continental US.</span>
<span class="va">sheds</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">FeatureCollection</span><span class="op">(</span><span class="st">"USGS/WBD/2017/HUC06"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">filterBounds</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Rectangle</span><span class="op">(</span><span class="op">-</span><span class="fl">127.18</span>, <span class="fl">19.39</span>, <span class="op">-</span><span class="fl">62.75</span>, <span class="fl">51.29</span><span class="op">)</span><span class="op">)</span>

<span class="co"># This function computes the squared difference between an area property</span>
<span class="co"># and area computed directly from the feature's geometry.</span>
<span class="va">areaDiff</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">feature</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Compute area in sq. km directly from the geometry.</span>
  <span class="va">area</span> <span class="op">&lt;-</span> <span class="va">feature</span><span class="op">$</span><span class="fu">geometry</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">area</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">divide</span><span class="op">(</span><span class="fl">1000</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span>
  <span class="co"># Compute the differece between computed area and the area property.</span>
  <span class="va">diff</span> <span class="op">&lt;-</span> <span class="va">area</span><span class="op">$</span><span class="fu">subtract</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Number</span><span class="op">$</span><span class="fu">parse</span><span class="op">(</span><span class="va">feature</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"areasqkm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="co"># Return the feature with the squared difference set to the 'diff' property.</span>
  <span class="va">feature</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"diff"</span>, <span class="va">diff</span><span class="op">$</span><span class="fu">pow</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>


<span class="co"># Calculate RMSE for population of difference pairs.</span>
<span class="va">rmse</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Number</span><span class="op">(</span>
  <span class="co"># Map the difference function over the collection.</span>
  <span class="va">sheds</span><span class="op">$</span><span class="fu">map</span><span class="op">(</span><span class="va">areaDiff</span><span class="op">)</span><span class="op">$</span>
    <span class="co"># Reduce to get the mean squared difference.</span>
    <span class="fu">reduceColumns</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Reducer</span><span class="op">$</span><span class="fu">mean</span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"diff"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
    <span class="fu">get</span><span class="op">(</span><span class="st">"mean"</span><span class="op">)</span>
<span class="op">)</span><span class="op">$</span>
  <span class="co"># Compute the square root of the mean square to get RMSE.</span>
  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Print the result.</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"RMSE="</span>, <span class="va">ee</span><span class="op">$</span><span class="va">Number</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">rmse</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>In this example, note that the return value of <code>reduceColumns()</code> is a dictionary with key <code>‘mean’</code>. To get the mean, cast the result of <code>dictionary$get()</code> to a number with <code>ee$Number()</code> before trying to call <code><a href="https://rdrr.io/r/base/MathFun.html">sqrt()</a></code> on it. For more information about ancillary data structures in Earth Engine, see <a href="">this tutorial</a>.</p>
<p>To overlay features on imagery, use <code>featureCollection$reduceRegions()</code>. For example, to compute the volume of precipitation in continental US watersheds, use <code>reduceRegions()</code> followed by a <code>map()</code>:</p>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load an image of daily precipitation in mm/day.</span>
<span class="va">precip</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="fu">ImageCollection</span><span class="op">(</span><span class="st">"NASA/ORNL/DAYMET_V3"</span><span class="op">)</span><span class="op">$</span><span class="fu">first</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Load watersheds from a data table and filter to the continental US.</span>
<span class="va">sheds</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">FeatureCollection</span><span class="op">(</span><span class="st">"USGS/WBD/2017/HUC06"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">filterBounds</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Rectangle</span><span class="op">(</span><span class="op">-</span><span class="fl">127.18</span>, <span class="fl">19.39</span>, <span class="op">-</span><span class="fl">62.75</span>, <span class="fl">51.29</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Add the mean of each image as new properties of each feature.</span>
<span class="va">withPrecip</span> <span class="op">&lt;-</span> <span class="va">precip</span><span class="op">$</span><span class="fu">reduceRegions</span><span class="op">(</span><span class="va">sheds</span>, <span class="va">ee</span><span class="op">$</span><span class="va">Reducer</span><span class="op">$</span><span class="fu">mean</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">filter</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Filter</span><span class="op">$</span><span class="fu">notNull</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"prcp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># This function computes total rainfall in cubic meters.</span>
<span class="va">prcpVolume</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">feature</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Precipitation in mm/day -&gt; meters -&gt; sq. meters.</span>
  <span class="va">volume</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Number</span><span class="op">(</span><span class="va">feature</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"prcp"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
    <span class="fu">divide</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">$</span><span class="fu">multiply</span><span class="op">(</span><span class="va">feature</span><span class="op">$</span><span class="fu">geometry</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">area</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">feature</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"volume"</span>, <span class="va">volume</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">highVolume</span> <span class="op">&lt;-</span> <span class="va">withPrecip</span><span class="op">$</span>
  <span class="co"># Map the function over the collection.</span>
  <span class="fu">map</span><span class="op">(</span><span class="va">prcpVolume</span><span class="op">)</span><span class="op">$</span>
  <span class="co"># Sort descending.</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="st">"volume"</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span>
  <span class="co"># Get only the 5 highest volume watersheds.</span>
  <span class="fu">limit</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">$</span>
  <span class="co"># Extract the names to a list.</span>
  <span class="fu">reduceColumns</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Reducer</span><span class="op">$</span><span class="fu">toList</span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"name"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"list"</span><span class="op">)</span>

<span class="co"># Print the resulting FeatureCollection.</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">ComputedObject</span><span class="op">$</span><span class="fu">getInfo</span><span class="op">(</span><span class="va">highVolume</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>For more information about reducing feature collections, see <a href="">Statistics of FeatureCollection Columns</a> and <a href="">Vector to Raster Conversion</a>.</p>
</div>
<div id="vector-to-raster-interpolation" class="section level2 unnumbered">
<h2>Vector to Raster Interpolation<a class="anchor" aria-label="anchor" href="#vector-to-raster-interpolation"><i class="fas fa-link"></i></a>
</h2>
<p>Interpolation from vector to raster in Earth Engine creates an <code>Image</code> from a <code>FeatureCollection</code>. Specifically, Earth Engine uses numeric data stored in a property of the features to interpolate values at new locations outside of the features. The interpolation results in a continuous <code>Image</code> of interpolated values up to the distance specified.</p>
<div id="inverse-distance-weighted-interpolation" class="section level3 unnumbered">
<h3>Inverse Distance Weighted Interpolation<a class="anchor" aria-label="anchor" href="#inverse-distance-weighted-interpolation"><i class="fas fa-link"></i></a>
</h3>
<p>The inverse distance weighting (IDW) function in Earth Engine is based on the method described by <a href="https:#ieeexplore.ieee.org/abstract/document/805606">Basso et al. (1999)</a>. An additional control parameter is added in the form of a decay factor (<code>gamma</code>) on the inverse distance. Other parameters include the mean and standard deviation of the property to interpolate and the maximum range distance over which to interpolate. The following example creates an interpolated surface of <a href="https:#developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S5P_OFFL_L3_CH4">methane concentration</a> to fill spatial gaps in the original raster dataset. The <code>FeatureCollection</code> is generated by sampling a two-week methane composite.</p>
<div class="sourceCode" id="cb425"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Import two weeks of S5P methane and composite by mean.</span>
<span class="va">ch4</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">ImageCollection</span><span class="op">(</span><span class="st">"COPERNICUS/S5P/OFFL/L3_CH4"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">select</span><span class="op">(</span><span class="st">"CH4_column_volume_mixing_ratio_dry_air"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">filterDate</span><span class="op">(</span><span class="st">"2019-08-01"</span>, <span class="st">"2019-08-15"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">mean</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">rename</span><span class="op">(</span><span class="st">"ch4"</span><span class="op">)</span>

<span class="co"># Define an area to perform interpolation over.</span>
<span class="va">aoi</span> <span class="op">&lt;-</span>
  <span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Polygon</span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">95.68487605978851</span>, <span class="fl">43.09844605027055</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">95.68487605978851</span>, <span class="fl">37.39358590079781</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">87.96148738791351</span>, <span class="fl">37.39358590079781</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">87.96148738791351</span>, <span class="fl">43.09844605027055</span><span class="op">)</span>
    <span class="op">)</span>, <span class="cn">NULL</span>, <span class="cn">FALSE</span>
  <span class="op">)</span>

<span class="co"># Sample the methane composite to generate a FeatureCollection.</span>
<span class="va">samples</span> <span class="op">&lt;-</span> <span class="va">ch4</span><span class="op">$</span><span class="fu">addBands</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Image</span><span class="op">$</span><span class="fu">pixelLonLat</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">sample</span><span class="op">(</span>
  <span class="va">region</span><span class="op">&lt;-</span> <span class="va">aoi</span>, <span class="va">numPixels</span><span class="op">&lt;-</span> <span class="fl">1500</span>,
  <span class="va">scale</span><span class="op">&lt;-</span> <span class="fl">1000</span>, <span class="va">projection</span><span class="op">&lt;-</span> <span class="st">"EPSG:4326"</span>
<span class="op">)</span><span class="op">$</span>
  <span class="fu">map</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">sample</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">lat</span> <span class="op">&lt;-</span> <span class="va">sample</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span>
  <span class="va">lon</span> <span class="op">&lt;-</span> <span class="va">sample</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span>
  <span class="va">ch4</span> <span class="op">&lt;-</span> <span class="va">sample</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"ch4"</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="fu">Feature</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Point</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">ch4</span><span class="op">&lt;-</span> <span class="va">ch4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="co"># Combine mean and standard deviation reducers for efficiency.</span>
<span class="va">combinedReducer</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Reducer</span><span class="op">$</span><span class="fu">mean</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">combine</span><span class="op">(</span>
  <span class="va">reducer2</span><span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Reducer</span><span class="op">$</span><span class="fu">stdDev</span><span class="op">(</span><span class="op">)</span>,
  <span class="va">sharedInputs</span><span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co"># Estimate global mean and standard deviation from the points.</span>
<span class="va">stats</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">$</span><span class="fu">reduceColumns</span><span class="op">(</span>
  <span class="va">reducer</span><span class="op">&lt;-</span> <span class="va">combinedReducer</span>,
  <span class="va">selectors</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"ch4"</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Do the interpolation, valid to 70 kilometers.</span>
<span class="va">interpolated</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">$</span><span class="fu">inverseDistance</span><span class="op">(</span>
  <span class="va">range</span><span class="op">&lt;-</span> <span class="fl">7e4</span>,
  <span class="va">propertyName</span><span class="op">&lt;-</span> <span class="st">"ch4"</span>,
  <span class="va">mean</span><span class="op">&lt;-</span> <span class="va">stats</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"mean"</span><span class="op">)</span>,
  <span class="va">stdDev</span><span class="op">&lt;-</span> <span class="va">stats</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"stdDev"</span><span class="op">)</span>,
  <span class="va">gamma</span><span class="op">&lt;-</span> <span class="fl">0.3</span>
<span class="op">)</span>

<span class="co"># Define visualization arguments.</span>
<span class="va">band_viz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">min</span><span class="op">&lt;-</span> <span class="fl">1800</span>,
  <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">1900</span>,
  <span class="va">palette</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"0D0887"</span>, <span class="st">"5B02A3"</span>, <span class="st">"9A179B"</span>, <span class="st">"CB4678"</span>,
    <span class="st">"EB7852"</span>, <span class="st">"FBB32F"</span>, <span class="st">"F0F921"</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="co"># Display to map.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">centerObject</span><span class="op">(</span><span class="va">aoi</span>, <span class="fl">7</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">ch4</span>, <span class="va">band_viz</span>, <span class="st">"CH4"</span><span class="op">)</span> <span class="op">|</span>
  <span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">interpolated</span>, <span class="va">band_viz</span>, <span class="st">"CH4 Interpolated"</span><span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_13.png" width="95%"><p>Note that, as specified by the <code>range</code> parameter, the interpolation only exists up to 70 kilometers from the nearest measurement station.</p>
</div>
<div id="kriging" class="section level3 unnumbered">
<h3>Kriging<a class="anchor" aria-label="anchor" href="#kriging"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https:#en.wikipedia.org/wiki/Kriging">Kriging</a> is an interpolation method that uses a modeled estimate of <a href="https:#en.wikipedia.org/wiki/Semivariance">semi-variance</a> to create an image of interpolated values that is an optimal combination of the values at known locations. The Kriging estimator requires parameters that describe the shape of a <a href="https:#en.wikipedia.org/wiki/Variogram">semi-variogram</a> fit to the known data points. These parameters are illustrated by Figure 1.</p>
<center>
<img src="images/chapter_05/figure_fea_01.png" width="95%">
</center>
<p>Figure 1. The <code>nugget</code>, <code>sill</code> and <code>range</code> parameters illustrated on a idealized variogram function.</p>
<p>The following example samples a sea surface temperature (SST) image at random locations, then interpolates SST from the sample using Kriging:</p>
<div class="sourceCode" id="cb426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load an image of sea surface temperature (SST).</span>
<span class="va">sst</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"NOAA/AVHRR_Pathfinder_V52_L3/20120802025048"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">select</span><span class="op">(</span><span class="st">"sea_surface_temperature"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">rename</span><span class="op">(</span><span class="st">"sst"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">divide</span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>

<span class="co"># Define a geometry in which to sample points</span>
<span class="va">geometry</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Rectangle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">65.60</span>, <span class="fl">31.75</span>, <span class="op">-</span><span class="fl">52.18</span>, <span class="fl">43.12</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Sample the SST image at 1000 random locations.</span>
<span class="va">samples</span> <span class="op">&lt;-</span> <span class="va">sst</span><span class="op">$</span><span class="fu">addBands</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Image</span><span class="op">$</span><span class="fu">pixelLonLat</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">sample</span><span class="op">(</span><span class="va">region</span><span class="op">&lt;-</span> <span class="va">geometry</span>, <span class="va">numPixels</span><span class="op">&lt;-</span> <span class="fl">1000</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">map</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">sample</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">lat</span> <span class="op">&lt;-</span> <span class="va">sample</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span>
  <span class="va">lon</span> <span class="op">&lt;-</span> <span class="va">sample</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span>
  <span class="va">sst</span> <span class="op">&lt;-</span> <span class="va">sample</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">"sst"</span><span class="op">)</span>
  <span class="va">ee</span><span class="op">$</span><span class="fu">Feature</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Point</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">sst</span><span class="op">&lt;-</span> <span class="va">sst</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="co"># Interpolate SST from the sampled points.</span>
<span class="va">interpolated</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">$</span><span class="fu">kriging</span><span class="op">(</span>
  <span class="va">propertyName</span><span class="op">&lt;-</span> <span class="st">"sst"</span>,
  <span class="va">shape</span><span class="op">&lt;-</span> <span class="st">"exponential"</span>,
  <span class="va">range</span><span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="fl">1000</span>,
  <span class="va">sill</span><span class="op">&lt;-</span> <span class="fl">1.0</span>,
  <span class="va">nugget</span><span class="op">&lt;-</span> <span class="fl">0.1</span>,
  <span class="va">maxDistance</span><span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="fl">1000</span>,
  <span class="va">reducer</span><span class="op">&lt;-</span> <span class="st">"mean"</span>
<span class="op">)</span>

<span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"00007F"</span>, <span class="st">"0000FF"</span>, <span class="st">"0074FF"</span>,
  <span class="st">"0DFFEA"</span>, <span class="st">"8CFF41"</span>, <span class="st">"FFDD00"</span>,
  <span class="st">"FF3700"</span>, <span class="st">"C30000"</span>, <span class="st">"790000"</span>
<span class="op">)</span>

<span class="va">vis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">min</span><span class="op">&lt;-</span> <span class="op">-</span><span class="fl">3</span>, <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">40</span>, <span class="va">palette</span><span class="op">&lt;-</span> <span class="va">colors</span><span class="op">)</span>

<span class="va">Map</span><span class="op">$</span><span class="fu">setCenter</span><span class="op">(</span><span class="op">-</span><span class="fl">60.029</span>, <span class="fl">36.457</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">interpolated</span>, <span class="va">vis</span>, <span class="st">"Interpolated"</span><span class="op">)</span> <span class="op">|</span>
  <span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">sst</span>, <span class="va">vis</span>, <span class="st">"Raw SST"</span><span class="op">)</span> <span class="op">+</span>
    <span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
      <span class="va">samples</span>,
      <span class="op">{</span><span class="op">}</span>,
      <span class="st">"Samples"</span>,
      <span class="cn">FALSE</span>
    <span class="op">)</span></code></pre></div>

<img src="images/chapter_05/figure_fea_code_14.png" width="95%"><p>The size of the neighborhood in which to perform the interpolation is specified by the maxDistance parameter. Larger sizes will result in smoother output but slower computations.</p>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="geometry.html">Geometry</a></div>
<div class="next"><a href="reducer.html">Reducer</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#feature-featurecollection">Feature &amp; FeatureCollection</a></li>
<li>
<a class="nav-link" href="#feature-overview">Feature Overview</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#creating-feature-objects">Creating Feature objects</a></li></ul>
</li>
<li>
<a class="nav-link" href="#featurecollection-overview">FeatureCollection Overview</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-featurecollection-constructor">The FeatureCollection constructor</a></li>
<li><a class="nav-link" href="#table-datasets">Table Datasets</a></li>
<li><a class="nav-link" href="#random-samples">Random Samples</a></li>
</ul>
</li>
<li><a class="nav-link" href="#feature-and-featurecollection-visualization">Feature and FeatureCollection Visualization</a></li>
<li>
<a class="nav-link" href="#featurecollection-information-and-metadata">FeatureCollection Information and Metadata</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#metadata-aggregation">Metadata aggregation</a></li>
<li><a class="nav-link" href="#column-information">Column information</a></li>
</ul>
</li>
<li><a class="nav-link" href="#filtering-a-featurecollection">Filtering a FeatureCollection</a></li>
<li><a class="nav-link" href="#mapping-over-a-featurecollection">Mapping over a FeatureCollection</a></li>
<li><a class="nav-link" href="#reducing-a-featurecollection">Reducing a FeatureCollection</a></li>
<li>
<a class="nav-link" href="#vector-to-raster-interpolation">Vector to Raster Interpolation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#inverse-distance-weighted-interpolation">Inverse Distance Weighted Interpolation</a></li>
<li><a class="nav-link" href="#kriging">Kriging</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/r-earthengine/rgeebook/blob/master/chapters/05_object_methods.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/r-earthengine/rgeebook/edit/master/chapters/05_object_methods.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Earth Engine with R</strong>" was written by rgee team. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
