<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Image | Earth Engine with R</title>
<meta name="author" content="rgee team">
<meta name="generator" content="bookdown 0.25.2 with bs4_book()">
<meta property="og:title" content="Image | Earth Engine with R">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Image | Earth Engine with R">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1.9000/transition.js"></script><script src="libs/bs3compat-0.3.1.9000/tabs.js"></script><script src="libs/bs3compat-0.3.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-141212623-1"></script><script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-141212623-1');
  </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<meta name="description" content="Image Overview As mentioned in the Get Started doc, raster data are represented as Image objects in Earth Engine. Images are composed of one or more bands and each band has its own name, data...">
<meta property="og:description" content="Image Overview As mentioned in the Get Started doc, raster data are represented as Image objects in Earth Engine. Images are composed of one or more bands and each band has its own name, data...">
<meta name="twitter:description" content="Image Overview As mentioned in the Get Started doc, raster data are represented as Image objects in Earth Engine. Images are composed of one or more bands and each band has its own name, data...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Earth Engine with R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="earthengine-examples.html">earthengine-examples</a></li>
<li><a class="" href="rgee-cheatsheet.html">rgee-cheatsheet</a></li>
<li class="book-part">R Guides</li>
<li><a class="" href="overview.html">Overview</a></li>
<li><a class="" href="rgeeextra.html">rgeeExtra</a></li>
<li><a class="" href="visualization.html">Visualization</a></li>
<li class="book-part">Get Started</li>
<li><a class="" href="r-quickstart.html">R Quickstart</a></li>
<li><a class="" href="coding-best-practices.html">Coding Best Practices</a></li>
<li><a class="" href="debugging.html">Debugging</a></li>
<li class="book-part">Development Environments</li>
<li><a class="" href="earth-engine-in-rstudio.html">Earth Engine in Rstudio</a></li>
<li><a class="" href="r-and-python-requirements.html">R and Python requirements</a></li>
<li><a class="" href="sync-gcs-and-rgee.html">sync GCS and rgee</a></li>
<li><a class="" href="integrate-rmarkdown-and-rgee.html">Integrate Rmarkdown and rgee</a></li>
<li><a class="" href="deploy-rgee-shiny-apps.html">Deploy rgee Shiny apps</a></li>
<li><a class="" href="comparing-rgee-vs-python-and-javascript.html">Comparing rgee vs Python and Javascript</a></li>
<li><a class="" href="extra-considerations.html">Extra considerations</a></li>
<li class="book-part">API Tutorials</li>
<li><a class="" href="overview-1.html">Overview</a></li>
<li><a class="" href="introduction-to-r-for-earth-engine.html">Introduction to R for Earth Engine</a></li>
<li><a class="" href="the-earth-engine-api.html">The Earth Engine API</a></li>
<li><a class="" href="global-forest-change.html">Global Forest Change</a></li>
<li><a class="" href="global-surface-water.html">Global Surface Water</a></li>
<li><a class="" href="video-tutorials-1.html">Video Tutorials</a></li>
<li class="book-part">Concepts</li>
<li><a class="" href="how-earth-engine-works.html">How Earth Engine works</a></li>
<li><a class="" href="client-vs-server.html">Client vs Server</a></li>
<li><a class="" href="deferred-exacution.html">Deferred exacution</a></li>
<li><a class="" href="scale.html">Scale</a></li>
<li><a class="" href="projections.html">Projections</a></li>
<li class="book-part">Objects and Methods</li>
<li><a class="" href="objects-and-methods-overview.html">Objects and Methods Overview</a></li>
<li><a class="active" href="image.html">Image</a></li>
<li><a class="" href="imagecollection.html">ImageCollection</a></li>
<li><a class="" href="geometry.html">Geometry</a></li>
<li><a class="" href="feature-featurecollection.html">Feature &amp; FeatureCollection</a></li>
<li><a class="" href="reducer.html">Reducer</a></li>
<li><a class="" href="join.html">Join</a></li>
<li><a class="" href="array.html">Array</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/r-earthengine/rgeebook">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="image" class="section level1 unnumbered">
<h1>Image<a class="anchor" aria-label="anchor" href="#image"><i class="fas fa-link"></i></a>
</h1>
<div id="image-overview" class="section level2 unnumbered">
<h2>Image Overview<a class="anchor" aria-label="anchor" href="#image-overview"><i class="fas fa-link"></i></a>
</h2>
<p>As mentioned in the <a href="">Get Started</a> doc, raster data are represented as Image objects in Earth Engine. Images are composed of one or more bands and each band has its own name, data type, scale, mask and projection. Each image has metadata stored as a set of properties.</p>
<div id="eeimage-constructor" class="section level3 unnumbered">
<h3>
<code>ee$Image</code> constructor<a class="anchor" aria-label="anchor" href="#eeimage-constructor"><i class="fas fa-link"></i></a>
</h3>
<p>Images can be loaded by pasting an Earth Engine asset ID into the <code>ee$Image</code> constructor. You can find image IDs in the <a href="https:#developers.google.com/earth-engine/datasets">data catalog</a>. For example, to load <a href="https:#developers.google.com/earth-engine/datasets/catalog/JAXA_ALOS_AW3D30_V3_2">JAXA’s ALOS DSM</a>:</p>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loadedImage</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">'JAXA/ALOS/AW3D30/V2_2'</span><span class="op">)</span></code></pre></div>
<p>Note that finding an image through the Rstudio search tool is equivalent. When you import the asset, the image construction code is written for you in the imports section of the Rstudio. You can also use a personal asset ID as shown in this doc.</p>
</div>
<div id="get-an-eeimage-from-an-eeimagecollection" class="section level3 unnumbered">
<h3>Get an <code>ee$Image</code> from an <code>ee$ImageCollection</code><a class="anchor" aria-label="anchor" href="#get-an-eeimage-from-an-eeimagecollection"><i class="fas fa-link"></i></a>
</h3>
<p>The standard way to get an image out of a collection is to filter the collection, with filters in order of decreasing specificity. For example, to get an image out of the <a href="https:#developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2_SR">Sentinel-2 surface reflectance collection</a>:</p>
<div class="sourceCode" id="cb297"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ee_geom</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Point</span><span class="op">(</span><span class="op">-</span><span class="fl">70.48</span>, <span class="fl">43.3631</span><span class="op">)</span>
<span class="va">first</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">ImageCollection</span><span class="op">(</span><span class="st">"COPERNICUS/S2_SR"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">ee</span><span class="op">$</span><span class="va">ImageCollection</span><span class="op">$</span><span class="fu">filterBounds</span><span class="op">(</span><span class="va">ee_geom</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">ee</span><span class="op">$</span><span class="va">ImageCollection</span><span class="op">$</span><span class="fu">filterDate</span><span class="op">(</span><span class="st">"2019-01-01"</span>, <span class="st">"2019-12-31"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="va">ee</span><span class="op">$</span><span class="va">ImageCollection</span><span class="op">$</span><span class="fu">sort</span><span class="op">(</span><span class="st">"CLOUDY_PIXEL_PERCENTAGE"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">first</span><span class="op">(</span><span class="op">)</span>
<span class="va">vizParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">bands</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B4"</span>, <span class="st">"B3"</span>, <span class="st">"B2"</span><span class="op">)</span>,
  <span class="va">min</span><span class="op">&lt;-</span> <span class="fl">0</span>,
  <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">2000</span>
<span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">centerObject</span><span class="op">(</span><span class="va">first</span>, <span class="fl">11</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">first</span>, <span class="va">vizParams</span>, <span class="st">"first"</span><span class="op">)</span></code></pre></div>
<center>
<div class="inline-figure"><img src="../images/chapter_05/figure_csaybar_01.png" width="670"></div>
<p>Note that the <code>sort</code> is <em>after</em> the filters. Avoid sorting the entire collection.</p>
</center>
</div>
<div id="images-from-cloud-geotiffs" class="section level3 unnumbered">
<h3>Images from Cloud GeoTIFFs<a class="anchor" aria-label="anchor" href="#images-from-cloud-geotiffs"><i class="fas fa-link"></i></a>
</h3>
<p>You can use <code>ee$Image$loadGeoTIFF()</code> to load images from Cloud Optimized GeoTIFFs in Google Cloud Storage. For example, the <a href="https:#console.cloud.google.com/marketplace/details/usgs-public-data/landast">public Landsat dataset</a> hosted in Google Cloud contains <a href="https:#console.cloud.google.com/storage/browser/_details/gcp-public-data-landsat/LC08/01/001/002/LC08_L1GT_001002_20160817_20170322_01_T2/LC08_L1GT_001002_20160817_20170322_01_T2_B5.TIF">this GeoTIFF</a>, corresponding to band 5 from a Landsat 8 scene. You can load this image from Cloud Storage using <code>ee$Image$loadGeoTIFF()</code>:</p>
<div class="sourceCode" id="cb298"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">uri</span> <span class="op">&lt;-</span> <span class="st">'gs:#gcp-public-data-landsat/LC08/01/001/002/'</span> <span class="op">+</span>
    <span class="st">'LC08_L1GT_001002_20160817_20170322_01_T2/'</span> <span class="op">+</span>
    <span class="st">'LC08_L1GT_001002_20160817_20170322_01_T2_B5.TIF'</span>
<span class="va">cloudImage</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Image</span><span class="op">$</span><span class="fu">loadGeoTIFF</span><span class="op">(</span><span class="va">uri</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cloudImage</span><span class="op">)</span></code></pre></div>
<p>Note that if you want to reload a Cloud Optimized GeoTIFF that you <a href="">export from Earth Engine to Cloud Storage</a>, when you do the export, set <code>cloudOptimized</code> to <code>true</code> as described <a href="">here</a>.</p>
</div>
<div id="constant-images" class="section level3 unnumbered">
<h3>Constant images<a class="anchor" aria-label="anchor" href="#constant-images"><i class="fas fa-link"></i></a>
</h3>
<p>In addition to loading images by ID, you can also create images from constants, lists or other suitable Earth Engine objects. The following illustrates methods for creating images, getting band subsets, and manipulating bands:</p>
<div class="sourceCode" id="cb299"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a constant image.</span>
<span class="va">image1</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">image1</span><span class="op">)</span>

<span class="co"># Concatenate two images into one multi-band image.</span>
<span class="va">image2</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">image3</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Image</span><span class="op">$</span><span class="fu">cat</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">image1</span>, <span class="va">image2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">image3</span><span class="op">)</span>

<span class="co"># Create a multi-band image from a list of constants.</span>
<span class="va">multiband</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">multiband</span><span class="op">)</span>

<span class="co"># Select and (optionally) rename bands.</span>
<span class="va">renamed</span><span class="op">&lt;-</span> <span class="va">multiband</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'constant'</span>, <span class="st">'constant_1'</span>, <span class="st">'constant_2'</span><span class="op">)</span>, <span class="co">## old names</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'band1'</span>, <span class="st">'band2'</span>, <span class="st">'band3'</span><span class="op">)</span>               <span class="co">## new names</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">renamed</span><span class="op">)</span>

<span class="co"># Add bands to an image.</span>
<span class="va">image4</span> <span class="op">&lt;-</span> <span class="va">image3</span><span class="op">$</span><span class="fu">addBands</span><span class="op">(</span><span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="fl">42</span><span class="op">)</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">image4</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="image-visualization" class="section level2 unnumbered">
<h2>Image Visualization<a class="anchor" aria-label="anchor" href="#image-visualization"><i class="fas fa-link"></i></a>
</h2>
<p>The are a number of <code>ee$Image</code> methods that produce RGB visual representations of image data, for example: <code>visualize()</code>, <code>getThumbURL()</code>, <code>getMap()</code>, <code>getMapId()</code> (used in Colab Folium map display) and, <code>Map$addLayer()</code> (used in Rstudio map display, not available for Python). By default these methods assign the first three bands to red, green and blue, respectively. The default stretch is based on the type of data in the bands (e.g. floats are stretched in [0, 1], 16-bit data are stretched to the full range of possible values), which may or may not be suitable. To achieve desired visualization effects, you can provide visualization parameters:</p>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="28%">
<col width="42%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th>Parameter</th>
<th align="left">Description</th>
<th>Type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><em>bands</em></td>
<td align="left">Comma-delimited list of three band names to be mapped to RGB</td>
<td>list</td>
</tr>
<tr class="even">
<td><em>min</em></td>
<td align="left">Value(s) to map to 0</td>
<td>number or list of three numbers, one for each band</td>
</tr>
<tr class="odd">
<td><em>max</em></td>
<td align="left">Value(s) to map to 255</td>
<td>number or list of three numbers, one for each band</td>
</tr>
<tr class="even">
<td><em>gain</em></td>
<td align="left">Value(s) by which to multiply each pixel value</td>
<td>number or list of three numbers, one for each band</td>
</tr>
<tr class="odd">
<td><em>bias</em></td>
<td align="left">Value(s) to add to each DN</td>
<td>number or list of three numbers, one for each band</td>
</tr>
<tr class="even">
<td><em>gamma</em></td>
<td align="left">Gamma correction factor(s)</td>
<td>number or list of three numbers, one for each band</td>
</tr>
<tr class="odd">
<td><em>palette</em></td>
<td align="left">List of CSS-style color strings (single-band images only)</td>
<td>comma-separated list of hex strings</td>
</tr>
<tr class="even">
<td><em>opacity</em></td>
<td align="left">The opacity of the layer (0.0 is fully transparent and 1.0 is fully opaque)</td>
<td>number</td>
</tr>
<tr class="odd">
<td><em>format</em></td>
<td align="left">Either “jpg” or “png”</td>
<td>string</td>
</tr>
</tbody>
</table></div>
<div id="rgb-composites-1" class="section level3 unnumbered">
<h3>RGB composites<a class="anchor" aria-label="anchor" href="#rgb-composites-1"><i class="fas fa-link"></i></a>
</h3>
<p>The following illustrates the use of parameters to style a Landsat 8 image as a false-color composite:</p>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load an image.</span>
<span class="va">image</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">'LANDSAT/LC08/C01/T1_TOA/LC08_044034_20140318'</span><span class="op">)</span>

<span class="co"># Define the visualization parameters.</span>
<span class="va">vizParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">bands</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'B5'</span>, <span class="st">'B4'</span>, <span class="st">'B3'</span><span class="op">)</span>,
  <span class="va">min</span><span class="op">&lt;-</span> <span class="fl">0</span>,
  <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">0.5</span>,
  <span class="va">gamma</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">1.1</span>, <span class="fl">1</span><span class="op">)</span>
<span class="op">)</span>
<span class="co"># Center the map and display the image.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">setCenter</span><span class="op">(</span><span class="op">-</span><span class="fl">122.1899</span>, <span class="fl">37.5010</span>, <span class="fl">10</span><span class="op">)</span>; <span class="co">## San Francisco Bay</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">image</span>, <span class="va">vizParams</span>, <span class="st">'false color composite'</span><span class="op">)</span></code></pre></div>
In this example, band <code>'B5'</code> is assigned to red, <code>'B4'</code> is assigned to green, and <code>'B3'</code> is assigned to blue.
<center>
<div class="figure">
<img src="../images/chapter_05/figure_01.png" width="670" alt=""><p class="caption">Figure 1. Landsat 8 false color composite of San Francisco bay area, California, USA.</p>
</div>
</center>
</div>
<div id="color-palettes-1" class="section level3 unnumbered">
<h3>Color palettes<a class="anchor" aria-label="anchor" href="#color-palettes-1"><i class="fas fa-link"></i></a>
</h3>
<p>To display a single band of an image in color, set the palette parameter with a color ramp represented by a list of CSS-style color strings. (See this reference for more information). The following example illustrates how to use colors from cyan (‘00FFFF’) to blue (‘0000FF’) to render a Normalized Difference Water Index (NDWI) image:</p>
<div class="sourceCode" id="cb301"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load an image.</span>
<span class="va">image</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">'LANDSAT/LC08/C01/T1_TOA/LC08_044034_20140318'</span><span class="op">)</span>

<span class="co"># Create an NDWI image, define visualization parameters and display.</span>
<span class="va">ndwi</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="fu">normalizedDifference</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'B3'</span>, <span class="st">'B5'</span><span class="op">)</span><span class="op">)</span>
<span class="va">ndwiViz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">min</span><span class="op">&lt;-</span> <span class="fl">0.5</span>, 
  <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">1</span>, 
  <span class="va">palette</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'00FFFF'</span>, <span class="st">'0000FF'</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">ndwi</span>, <span class="va">ndwiViz</span>, <span class="st">'NDWI'</span><span class="op">)</span></code></pre></div>
<p>In this example, note that the min and max parameters indicate the range of pixel values to which the palette should be applied. Intermediate values are linearly stretched.</p>
<center>
<div class="figure">
<img src="../images/chapter_05/figure_02.png" width="670" alt=""><p class="caption">Figure 2. Landsat 8 NDWI, San Francisco bay area, USA. Cyan are low values, blue are high values.</p>
</div>
</center>
</div>
<div id="masking-4" class="section level3 unnumbered">
<h3>Masking<a class="anchor" aria-label="anchor" href="#masking-4"><i class="fas fa-link"></i></a>
</h3>
<p>You can use <code>image$updateMask()</code> to set the opacity of individual pixels based on where pixels in a mask image are non-zero. Pixels equal to zero in the mask are excluded from computations and the opacity is set to 0 for display. The following example uses an NDWI threshold (see the <a href="">Relational Operations section</a> for information on thresholds) to update the mask on the NDWI layer created previously:</p>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mask the non-watery parts of the image, where NDWI &lt; 0.4.</span>
<span class="va">ndwiMasked</span> <span class="op">&lt;-</span> <span class="va">ndwi</span><span class="op">$</span><span class="fu">updateMask</span><span class="op">(</span><span class="va">ndwi</span><span class="op">$</span><span class="fu">gte</span><span class="op">(</span><span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">ndwiMasked</span>, <span class="va">ndwiViz</span>, <span class="st">'NDWI masked'</span><span class="op">)</span></code></pre></div>
</div>
<div id="visualization-images-1" class="section level3 unnumbered">
<h3>Visualization images<a class="anchor" aria-label="anchor" href="#visualization-images-1"><i class="fas fa-link"></i></a>
</h3>
<p>Use the <code>image.visualize()</code> method to convert an image into an 8-bit RGB image for display or export. For example, to convert the false-color composite and NDWI to 3-band display images, use:</p>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create visualization layers.</span>
<span class="va">imageRGB</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="fu">visualize</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">bands</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'B5'</span>, <span class="st">'B4'</span>, <span class="st">'B3'</span><span class="op">)</span>, 
  <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">0.5</span>
<span class="op">)</span><span class="op">)</span>

<span class="va">ndwiRGB</span> <span class="op">&lt;-</span> <span class="va">ndwiMasked</span><span class="op">$</span><span class="fu">visualize</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">min</span><span class="op">&lt;-</span> <span class="fl">0.5</span>,
  <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">1</span>,
  <span class="va">palette</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'00FFFF'</span>, <span class="st">'0000FF'</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="mosaicking-2" class="section level3 unnumbered">
<h3>Mosaicking<a class="anchor" aria-label="anchor" href="#mosaicking-2"><i class="fas fa-link"></i></a>
</h3>
<p>You can use masking and <code>imageCollection.mosaic()</code> (see the Mosaicking section for information on mosaicking) to achieve various cartographic effects. The <code>mosaic()</code> method renders layers in the output image according to their order in the input collection. The following example uses <code>mosaic()</code> to combine the masked NDWI and the false color composite and obtain a new visualization:</p>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mosaic the visualization layers and display (or export).</span>
<span class="va">mosaic</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">ImageCollection</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">imageRGB</span>, <span class="va">ndwiRGB</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">mosaic</span><span class="op">(</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">mosaic</span>, <span class="op">{</span><span class="op">}</span>, <span class="st">'mosaic'</span><span class="op">)</span></code></pre></div>
In this example, observe that a list of the two visualization images is provided to the <code>ImageCollection</code> constructor. The order of the list determines the order in which the images are rendered on the map.
<center>
<img src="../images/chapter_05/figure_03.png" title="fig:" width="670" alt="Figure 3. Mosaic of a Landsat 8 false color composite and NDWI. San Francisco bay area, USA.">
</center>
</div>
<div id="clipping" class="section level3 unnumbered">
<h3>Clipping<a class="anchor" aria-label="anchor" href="#clipping"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>image$clip()</code> method is useful for achieving cartographic effects. The following example clips the mosaic created previously to an arbitrary buffer zone around the city of San Francisco:</p>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a circle by drawing a 20000 meter buffer around a point.</span>
<span class="va">roi</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Point</span><span class="op">(</span><span class="op">-</span><span class="fl">122.4481</span>, <span class="fl">37.7599</span><span class="op">)</span><span class="op">$</span><span class="fu">buffer</span><span class="op">(</span><span class="fl">20000</span><span class="op">)</span>;

<span class="co"># Display a clipped version of the mosaic.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">mosaic</span><span class="op">$</span><span class="fu">clip</span><span class="op">(</span><span class="va">roi</span><span class="op">)</span><span class="op">)</span></code></pre></div>
In the previous example, note that the coordinates are provided to the <code>Geometry</code> constructor and the buffer length is specified as 20,000 meters. Learn more about geometries on the <a href="">Geometries page</a>.
<center>
<img src="../images/chapter_05/figure_04.png" title="fig:" width="670" alt="Figure 2. The mosaic shown above, clipped to a buffer around San Francisco, California, USA.">
</center>
</div>
<div id="rendering-categorical-maps" class="section level3 unnumbered">
<h3>Rendering categorical maps<a class="anchor" aria-label="anchor" href="#rendering-categorical-maps"><i class="fas fa-link"></i></a>
</h3>
<p>Palettes are also useful for rendering discrete valued maps, for example a land cover map. In the case of multiple classes, use the palette to supply a different color for each class. (The <code>image$remap()</code> method may be useful in this context, to convert arbitrary labels to consecutive integers). The following example uses a palette to render land cover categories:</p>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load 2012 MODIS land cover and select the IGBP classification.</span>
<span class="va">cover</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"MODIS/051/MCD12Q1/2012_01_01"</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">select</span><span class="op">(</span><span class="st">"Land_Cover_Type_1"</span><span class="op">)</span>

<span class="co"># Define a palette for the 18 distinct land cover classes.</span>
<span class="va">igbpPalette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="st">"aec3d4"</span>, <span class="co">## water</span>
  <span class="st">"152106"</span>, <span class="st">"225129"</span>, <span class="st">"369b47"</span>, <span class="st">"30eb5b"</span>, <span class="st">"387242"</span>, <span class="co">## forest</span>
  <span class="st">"6a2325"</span>, <span class="st">"c3aa69"</span>, <span class="st">"b76031"</span>, <span class="st">"d9903d"</span>, <span class="st">"91af40"</span>, <span class="co">## shrub, grass</span>
  <span class="st">"111149"</span>, <span class="co">## wetlands</span>
  <span class="st">"cdb33b"</span>, <span class="co">## croplands</span>
  <span class="st">"cc0013"</span>, <span class="co">## urban</span>
  <span class="st">"33280d"</span>, <span class="co">## crop mosaic</span>
  <span class="st">"d7cdcc"</span>, <span class="co">## snow and ice</span>
  <span class="st">"f7e084"</span>, <span class="co">## barren</span>
  <span class="st">"6f6f6f"</span> <span class="co">## tundra</span>
<span class="op">)</span>

<span class="co"># Specify the min and max labels and the color palette matching the labels.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">setCenter</span><span class="op">(</span><span class="op">-</span><span class="fl">99.229</span>, <span class="fl">40.413</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">cover</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">17</span>, palette <span class="op">=</span> <span class="va">igbpPalette</span><span class="op">)</span>,
  <span class="st">"IGBP classification"</span>
<span class="op">)</span></code></pre></div>
<center>
<img src="../images/chapter_05/figure_03.png" title="fig:" width="670" alt="Figure 4. MODIS 2012 land cover using the IGBP classification..">
</center>
</div>
<div id="styled-layer-descriptors" class="section level3 unnumbered">
<h3>Styled Layer Descriptors<a class="anchor" aria-label="anchor" href="#styled-layer-descriptors"><i class="fas fa-link"></i></a>
</h3>
<p>You can use a Styled Layer Descriptor (<a href="">SLD</a>) to render imagery for display. Provide <code>image$sldStyle()</code> with an XML description of the symbolization and coloring of the image, specifically the <code>RasterSymbolizer</code> element. Learn more about the <code>RasterSymbolizer</code> element <a href="">here</a>. For example, to render the land cover map described in the Rendering categorical maps section with an SLD, use:</p>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cover</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"MODIS/051/MCD12Q1/2012_01_01"</span><span class="op">)</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">"Land_Cover_Type_1"</span><span class="op">)</span>

<span class="co"># Define an SLD style of discrete intervals to apply to the image.</span>
<span class="va">sld_intervals</span> <span class="op">&lt;-</span>
  <span class="st">"&lt;RasterSymbolizer&gt;"</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMap type="intervals" extended="false"&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#aec3d4" quantity="0" label="Water"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#152106" quantity="1" label="Evergreen Needleleaf Forest"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#225129" quantity="2" label="Evergreen Broadleaf Forest"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#369b47" quantity="3" label="Deciduous Needleleaf Forest"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#30eb5b" quantity="4" label="Deciduous Broadleaf Forest"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#387242" quantity="5" label="Mixed Deciduous Forest"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#6a2325" quantity="6" label="Closed Shrubland"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#c3aa69" quantity="7" label="Open Shrubland"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#b76031" quantity="8" label="Woody Savanna"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#d9903d" quantity="9" label="Savanna"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#91af40" quantity="10" label="Grassland"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#111149" quantity="11" label="Permanent Wetland"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#cdb33b" quantity="12" label="Cropland"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#cc0013" quantity="13" label="Urban"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#33280d" quantity="14" label="Crop, Natural Veg. Mosaic"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#d7cdcc" quantity="15" label="Permanent Snow, Ice"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#f7e084" quantity="16" label="Barren, Desert"/&gt;'</span> <span class="op">+</span>
  <span class="st">'&lt;ColorMapEntry color="#6f6f6f" quantity="17" label="Tundra"/&gt;'</span> <span class="op">+</span>
  <span class="st">"&lt;/ColorMap&gt;"</span> <span class="op">+</span>
  <span class="st">"&lt;/RasterSymbolizer&gt;"</span>

<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">cover</span><span class="op">$</span><span class="fu">sldStyle</span><span class="op">(</span><span class="va">sld_intervals</span><span class="op">)</span>,
  <span class="op">{</span><span class="op">}</span>,
  <span class="st">"IGBP classification styled"</span>
<span class="op">)</span></code></pre></div>
<p>To create a visualization image with a color ramp, set the type of the ColorMap to ‘ramp’. The following example compares the ‘interval’ and ‘ramp’ types for rendering a DEM:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="image.html#cb308-1"></a><span class="co"># Load SRTM Digital Elevation Model data.</span></span>
<span id="cb308-2"><a href="image.html#cb308-2"></a>image &lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Image</span>(<span class="st">"CGIAR/SRTM90_V4"</span>)</span>
<span id="cb308-3"><a href="image.html#cb308-3"></a></span>
<span id="cb308-4"><a href="image.html#cb308-4"></a><span class="co"># Define an SLD style of discrete intervals to apply to the image.</span></span>
<span id="cb308-5"><a href="image.html#cb308-5"></a>sld_intervals &lt;-</span>
<span id="cb308-6"><a href="image.html#cb308-6"></a><span class="er">&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="st"> </span>HEAD</span>
<span id="cb308-7"><a href="image.html#cb308-7"></a>  <span class="st">"&lt;RasterSymbolizer&gt;"</span> <span class="op">+</span></span>
<span id="cb308-8"><a href="image.html#cb308-8"></a><span class="st">  '&lt;ColorMap type="intervals" extended="false" &gt;'</span> <span class="op">+</span></span>
<span id="cb308-9"><a href="image.html#cb308-9"></a><span class="st">  '&lt;ColorMapEntry color="#0000ff" quantity="0" label="0"/&gt;'</span> <span class="op">+</span></span>
<span id="cb308-10"><a href="image.html#cb308-10"></a><span class="st">  '&lt;ColorMapEntry color="#00ff00" quantity="100" label="1-100" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-11"><a href="image.html#cb308-11"></a><span class="st">  '&lt;ColorMapEntry color="#007f30" quantity="200" label="110-200" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-12"><a href="image.html#cb308-12"></a><span class="st">  '&lt;ColorMapEntry color="#30b855" quantity="300" label="210-300" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-13"><a href="image.html#cb308-13"></a><span class="st">  '&lt;ColorMapEntry color="#ff0000" quantity="400" label="310-400" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-14"><a href="image.html#cb308-14"></a><span class="st">  '&lt;ColorMapEntry color="#ffff00" quantity="1000" label="410-1000" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-15"><a href="image.html#cb308-15"></a><span class="st">  "&lt;/ColorMap&gt;"</span> <span class="op">+</span></span>
<span id="cb308-16"><a href="image.html#cb308-16"></a><span class="st">  "&lt;/RasterSymbolizer&gt;"</span></span>
<span id="cb308-17"><a href="image.html#cb308-17"></a><span class="op">==</span><span class="er">=====</span></span>
<span id="cb308-18"><a href="image.html#cb308-18"></a><span class="st">  '&lt;RasterSymbolizer&gt;'</span> <span class="op">+</span></span>
<span id="cb308-19"><a href="image.html#cb308-19"></a><span class="st">    '&lt;ColorMap type="intervals" extended="false" &gt;'</span> <span class="op">+</span></span>
<span id="cb308-20"><a href="image.html#cb308-20"></a><span class="st">      '&lt;ColorMapEntry color="#0000ff" quantity="0" label="0"/&gt;'</span> <span class="op">+</span></span>
<span id="cb308-21"><a href="image.html#cb308-21"></a><span class="st">      '&lt;ColorMapEntry color="#00ff00" quantity="100" label="1-100" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-22"><a href="image.html#cb308-22"></a><span class="st">      '&lt;ColorMapEntry color="#007f30" quantity="200" label="110-200" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-23"><a href="image.html#cb308-23"></a><span class="st">      '&lt;ColorMapEntry color="#30b855" quantity="300" label="210-300" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-24"><a href="image.html#cb308-24"></a><span class="st">      '&lt;ColorMapEntry color="#ff0000" quantity="400" label="310-400" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-25"><a href="image.html#cb308-25"></a><span class="st">      '&lt;ColorMapEntry color="#ffff00" quantity="1000" label="410-1000" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-26"><a href="image.html#cb308-26"></a><span class="st">    '&lt;/ColorMap&gt;'</span> <span class="op">+</span></span>
<span id="cb308-27"><a href="image.html#cb308-27"></a><span class="st">  '&lt;/RasterSymbolizer&gt;'</span></span>
<span id="cb308-28"><a href="image.html#cb308-28"></a><span class="op">&gt;</span><span class="er">&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="st"> </span>master</span>
<span id="cb308-29"><a href="image.html#cb308-29"></a></span>
<span id="cb308-30"><a href="image.html#cb308-30"></a><span class="co"># Define an sld style color ramp to apply to the image.</span></span>
<span id="cb308-31"><a href="image.html#cb308-31"></a>sld_ramp &lt;-</span>
<span id="cb308-32"><a href="image.html#cb308-32"></a><span class="st">  "&lt;RasterSymbolizer&gt;"</span> <span class="op">+</span></span>
<span id="cb308-33"><a href="image.html#cb308-33"></a><span class="st">  '&lt;ColorMap type="ramp" extended="false" &gt;'</span> <span class="op">+</span></span>
<span id="cb308-34"><a href="image.html#cb308-34"></a><span class="st">  '&lt;ColorMapEntry color="#0000ff" quantity="0" label="0"/&gt;'</span> <span class="op">+</span></span>
<span id="cb308-35"><a href="image.html#cb308-35"></a><span class="st">  '&lt;ColorMapEntry color="#00ff00" quantity="100" label="100" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-36"><a href="image.html#cb308-36"></a><span class="st">  '&lt;ColorMapEntry color="#007f30" quantity="200" label="200" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-37"><a href="image.html#cb308-37"></a><span class="st">  '&lt;ColorMapEntry color="#30b855" quantity="300" label="300" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-38"><a href="image.html#cb308-38"></a><span class="st">  '&lt;ColorMapEntry color="#ff0000" quantity="400" label="400" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-39"><a href="image.html#cb308-39"></a><span class="st">  '&lt;ColorMapEntry color="#ffff00" quantity="500" label="500" /&gt;'</span> <span class="op">+</span></span>
<span id="cb308-40"><a href="image.html#cb308-40"></a><span class="st">  "&lt;/ColorMap&gt;"</span> <span class="op">+</span></span>
<span id="cb308-41"><a href="image.html#cb308-41"></a><span class="st">  "&lt;/RasterSymbolizer&gt;"</span></span>
<span id="cb308-42"><a href="image.html#cb308-42"></a></span>
<span id="cb308-43"><a href="image.html#cb308-43"></a><span class="co"># Add the image to the map using both the color ramp and interval schemes.</span></span>
<span id="cb308-44"><a href="image.html#cb308-44"></a>Map<span class="op">$</span><span class="kw">setCenter</span>(<span class="op">-</span><span class="fl">76.8054</span>, <span class="fl">42.0289</span>, <span class="dv">8</span>)</span>
<span id="cb308-45"><a href="image.html#cb308-45"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(</span>
<span id="cb308-46"><a href="image.html#cb308-46"></a>  image<span class="op">$</span><span class="kw">sldStyle</span>(sld_intervals),</span>
<span id="cb308-47"><a href="image.html#cb308-47"></a>  {},</span>
<span id="cb308-48"><a href="image.html#cb308-48"></a>  <span class="st">"SLD intervals"</span></span>
<span id="cb308-49"><a href="image.html#cb308-49"></a>)</span>
<span id="cb308-50"><a href="image.html#cb308-50"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(</span>
<span id="cb308-51"><a href="image.html#cb308-51"></a>  image<span class="op">$</span><span class="kw">sldStyle</span>(sld_ramp),</span>
<span id="cb308-52"><a href="image.html#cb308-52"></a>  {},</span>
<span id="cb308-53"><a href="image.html#cb308-53"></a>  <span class="st">"SLD ramp"</span></span>
<span id="cb308-54"><a href="image.html#cb308-54"></a>)</span></code></pre></div>
<p>SLDs are also useful for stretching pixel values to improve visualizations of continuous data. For example, the following code compares the results of an arbitrary linear stretch with a min-max ‘Normalization’ and a ‘Histogram’ equalization:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="image.html#cb309-1"></a><span class="co"># Load a Landsat 8 raw image.</span></span>
<span id="cb309-2"><a href="image.html#cb309-2"></a><span class="op">&lt;</span><span class="er">&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="st"> </span>HEAD</span>
<span id="cb309-3"><a href="image.html#cb309-3"></a>image &lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Image</span>(<span class="st">"LANDSAT/LC08/C01/T1/LC08_044034_20140318"</span>)</span>
<span id="cb309-4"><a href="image.html#cb309-4"></a><span class="op">==</span><span class="er">=====</span></span>
<span id="cb309-5"><a href="image.html#cb309-5"></a>image&lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Image</span>(<span class="st">'LANDSAT/LC08/C01/T1/LC08_044034_20140318'</span>)</span>
<span id="cb309-6"><a href="image.html#cb309-6"></a><span class="op">&gt;</span><span class="er">&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="st"> </span>master</span>
<span id="cb309-7"><a href="image.html#cb309-7"></a></span>
<span id="cb309-8"><a href="image.html#cb309-8"></a><span class="co"># Define a RasterSymbolizer element with '_enhance_' for a placeholder.</span></span>
<span id="cb309-9"><a href="image.html#cb309-9"></a>template_sld &lt;-</span>
<span id="cb309-10"><a href="image.html#cb309-10"></a><span class="st">  "&lt;RasterSymbolizer&gt;"</span> <span class="op">+</span></span>
<span id="cb309-11"><a href="image.html#cb309-11"></a><span class="st">  "&lt;ContrastEnhancement&gt;&lt;_enhance_/&gt;&lt;/ContrastEnhancement&gt;"</span> <span class="op">+</span></span>
<span id="cb309-12"><a href="image.html#cb309-12"></a><span class="st">  "&lt;ChannelSelection&gt;"</span> <span class="op">+</span></span>
<span id="cb309-13"><a href="image.html#cb309-13"></a><span class="st">  "&lt;RedChannel&gt;"</span> <span class="op">+</span></span>
<span id="cb309-14"><a href="image.html#cb309-14"></a><span class="st">  "&lt;SourceChannelName&gt;B5&lt;/SourceChannelName&gt;"</span> <span class="op">+</span></span>
<span id="cb309-15"><a href="image.html#cb309-15"></a><span class="st">  "&lt;/RedChannel&gt;"</span> <span class="op">+</span></span>
<span id="cb309-16"><a href="image.html#cb309-16"></a><span class="st">  "&lt;GreenChannel&gt;"</span> <span class="op">+</span></span>
<span id="cb309-17"><a href="image.html#cb309-17"></a><span class="st">  "&lt;SourceChannelName&gt;B4&lt;/SourceChannelName&gt;"</span> <span class="op">+</span></span>
<span id="cb309-18"><a href="image.html#cb309-18"></a><span class="st">  "&lt;/GreenChannel&gt;"</span> <span class="op">+</span></span>
<span id="cb309-19"><a href="image.html#cb309-19"></a><span class="st">  "&lt;BlueChannel&gt;"</span> <span class="op">+</span></span>
<span id="cb309-20"><a href="image.html#cb309-20"></a><span class="st">  "&lt;SourceChannelName&gt;B3&lt;/SourceChannelName&gt;"</span> <span class="op">+</span></span>
<span id="cb309-21"><a href="image.html#cb309-21"></a><span class="st">  "&lt;/BlueChannel&gt;"</span> <span class="op">+</span></span>
<span id="cb309-22"><a href="image.html#cb309-22"></a><span class="st">  "&lt;/ChannelSelection&gt;"</span> <span class="op">+</span></span>
<span id="cb309-23"><a href="image.html#cb309-23"></a><span class="st">  "&lt;/RasterSymbolizer&gt;"</span></span>
<span id="cb309-24"><a href="image.html#cb309-24"></a></span>
<span id="cb309-25"><a href="image.html#cb309-25"></a><span class="co"># Get SLDs with different enhancements.</span></span>
<span id="cb309-26"><a href="image.html#cb309-26"></a>equalize_sld &lt;-<span class="st"> </span><span class="kw">template_sld.replace</span>(<span class="st">"_enhance_"</span>, <span class="st">"Histogram"</span>)</span>
<span id="cb309-27"><a href="image.html#cb309-27"></a>normalize_sld &lt;-<span class="st"> </span><span class="kw">template_sld.replace</span>(<span class="st">"_enhance_"</span>, <span class="st">"Normalize"</span>)</span>
<span id="cb309-28"><a href="image.html#cb309-28"></a></span>
<span id="cb309-29"><a href="image.html#cb309-29"></a><span class="co"># Display the results.</span></span>
<span id="cb309-30"><a href="image.html#cb309-30"></a>Map<span class="op">$</span><span class="kw">centerObject</span>(image, <span class="dv">10</span>)</span>
<span id="cb309-31"><a href="image.html#cb309-31"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(image, <span class="kw">list</span>(<span class="dt">bands =</span> <span class="kw">c</span>(<span class="st">"B5"</span>, <span class="st">"B4"</span>, <span class="st">"B3"</span>), <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">15000</span>), <span class="st">"Linear"</span>)</span>
<span id="cb309-32"><a href="image.html#cb309-32"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(</span>
<span id="cb309-33"><a href="image.html#cb309-33"></a>  <span class="kw">image.sldStyle</span>(equalize_sld),</span>
<span id="cb309-34"><a href="image.html#cb309-34"></a>  {},</span>
<span id="cb309-35"><a href="image.html#cb309-35"></a>  <span class="st">"Equalized"</span></span>
<span id="cb309-36"><a href="image.html#cb309-36"></a>)</span>
<span id="cb309-37"><a href="image.html#cb309-37"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(</span>
<span id="cb309-38"><a href="image.html#cb309-38"></a>  <span class="kw">image.sldStyle</span>(normalize_sld),</span>
<span id="cb309-39"><a href="image.html#cb309-39"></a>  {},</span>
<span id="cb309-40"><a href="image.html#cb309-40"></a>  <span class="st">"Normalized"</span></span>
<span id="cb309-41"><a href="image.html#cb309-41"></a>)</span></code></pre></div>
<p>Points of note in reference to using SLDs in Earth Engine:</p>
<ul>
<li>OGC SLD 1.0 and OGC SE 1.1 are supported.</li>
<li>The XML document passed in can be complete, or just the RasterSymbolizer element and down.</li>
<li>Bands may be selected by their Earth Engine names or index (‘1’, ‘2’, …).</li>
<li>The Histogram and Normalize contrast stretch mechanisms are not supported for floating point imagery.</li>
<li>Opacity is only taken into account when it is 0.0 (transparent). Non-zero opacity values are treated as completely opaque.</li>
<li>The OverlapBehavior definition is currently ignored.</li>
<li>The ShadedRelief mechanism is not currently supported.</li>
<li>The ImageOutline mechanism is not currently supported.</li>
<li>The Geometry element is ignored.</li>
<li>The output image will have histogram_bandname metadata if histogram equalization or normalization is requested.</li>
</ul>
</div>
<div id="thumbnail-images" class="section level3 unnumbered">
<h3>Thumbnail images<a class="anchor" aria-label="anchor" href="#thumbnail-images"><i class="fas fa-link"></i></a>
</h3>
<p>Use the <code>ee$Image.getThumbURL()</code> method to generate a PNG or JPEG thumbnail image for an <code>ee$Image</code> object. Printing the outcome of an expression ending with a call to <code>getThumbURL()</code> results in a URL being printed. Visiting the URL sets Earth Engine servers to work on generating the requested thumbnail on-the-fly. The image is displayed in a browser when processing completes. It can be downloaded by selecting appropriate options from the image’s right-click context menu.</p>
-<code>Note</code>: <em>The authorization token to process the thumbnail lasts 2 hours. Until it expires, anyone with the authorization token can generate the image.</em>
<center>
<img src="../images/chapter_05/figure_05.png" title="fig:" width="670" alt="Figure 5. SRTM digital elevation model displayed as a PNG thumbnail in a browser.">
</center>
<p>The <code>getThumbURL()</code> method includes parameters, described in the visualization parameters table above. Additionally, it takes optional <code>dimensions</code>, <code>region</code>, and <code>crs</code> arguments that control the spatial extent, size, and display projection of the thumbnail.</p>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="28%">
<col width="42%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th>Parameter</th>
<th align="left">Description</th>
<th>Type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><em>dimensions</em></td>
<td align="left">Thumbnail dimensions in pixel units. If a single integer is provided, it defines the size of the image’s larger aspect dimension and scales the smaller dimension proportionally. Defaults to 512 pixels for the larger image aspect dimension.</td>
<td>A single integer or string in the format: ‘WIDTHxHEIGHT’</td>
</tr>
<tr class="even">
<td><em>region</em></td>
<td align="left">The geospatial region of the image to render. The whole image by default, or the bounds of a provided geometry.</td>
<td>GeoJSON or a 2-D list of at least three point coordinates that define a linear ring</td>
</tr>
<tr class="odd">
<td><em>crs</em></td>
<td align="left">The target projection e.g. ‘EPSG:3857’. Defaults to WGS84 (‘EPSG:4326’).</td>
<td>String</td>
</tr>
<tr class="even">
<td><em>format</em></td>
<td align="left">Defines thumbnail format as either PNG or JPEG. The default PNG format is implemented as RGBA, where the alpha channel represents valid and invalid pixels, defined by the image’s mask(). Invalid pixels are transparent. The optional JPEG format is implemented as RGB, where invalid image pixels are zero filled across RGB channels.</td>
<td>String; either ‘png’ or ‘jpg’</td>
</tr>
</tbody>
</table></div>
<p><em>Caution</em>: <code>The *'WIDTHxHEIGHT'* dimensions argument can alter the original aspect ratio of the data or region extent.</code></p>
<p>A single-band image will default to grayscale unless a <code>palette</code> argument is supplied. A multi-band image will default to RGB visualization of the first three bands, unless a <code>bands</code> argument is supplied. If only two bands are provided, the first band will map to red, the second to blue, and the green channel will be zero filled.</p>
<p>The following are a series of examples demonstrating various combinations of <code>getThumbURL()</code> parameter arguments. Click on the URLs printed when you run this script to view the thumbnails.</p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fetch a digital elevation model.</span>
<span class="va">image</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"CGIAR/SRTM90_V4"</span><span class="op">)</span>

<span class="co"># Request a default thumbnail of the DEM with defined linear stretch.</span>
<span class="co"># Set masked pixels (ocean) to 1000 so they map as gray.</span>
<span class="va">thumbnail1</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="fu">unmask</span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">$</span><span class="fu">getThumbURL</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="st">"min"</span> <span class="op">=</span> <span class="fl">0</span>,
  <span class="st">"max"</span> <span class="op">=</span> <span class="fl">3000</span>,
  <span class="st">"dimensions"</span> <span class="op">=</span> <span class="fl">500</span>
<span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Default extent:"</span>, <span class="va">thumbnail1</span><span class="op">)</span>

<span class="co"># Specify region by rectangle, define palette, set larger aspect dimension size.</span>
<span class="va">thumbnail2</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="fu">getThumbURL</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="st">"min"</span> <span class="op">=</span> <span class="fl">0</span>,
  <span class="st">"max"</span> <span class="op">=</span> <span class="fl">3000</span>,
  <span class="st">"palette"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"00A600"</span>, <span class="st">"63C600"</span>, <span class="st">"E6E600"</span>, <span class="st">"E9BD3A"</span>, <span class="st">"ECB176"</span>, <span class="st">"EFC2B3"</span>, <span class="st">"F2F2F2"</span><span class="op">)</span>,
  <span class="st">"dimensions"</span> <span class="op">=</span> <span class="fl">500</span>,
  <span class="st">"region"</span> <span class="op">=</span> <span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Rectangle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">84.6</span>, <span class="op">-</span><span class="fl">55.9</span>, <span class="op">-</span><span class="fl">32.9</span>, <span class="fl">15.7</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Rectangle region and palette:"</span>, <span class="va">thumbnail2</span><span class="op">)</span>
<span class="co"># Specify region by a linear ring and set display CRS as Web Mercator.</span>
<span class="va">thumbnail3</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="fu">getThumbURL</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="st">"min"</span> <span class="op">=</span> <span class="fl">0</span>,
  <span class="st">"max"</span> <span class="op">=</span> <span class="fl">3000</span>,
  <span class="st">"palette"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"00A600"</span>, <span class="st">"63C600"</span>, <span class="st">"E6E600"</span>, <span class="st">"E9BD3A"</span>, <span class="st">"ECB176"</span>, <span class="st">"EFC2B3"</span>, <span class="st">"F2F2F2"</span><span class="op">)</span>,
  <span class="st">"region"</span> <span class="op">=</span> <span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">LinearRing</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">84.6</span>, <span class="fl">15.7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">84.6</span>, <span class="op">-</span><span class="fl">55.9</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">32.9</span>, <span class="op">-</span><span class="fl">55.9</span><span class="op">)</span><span class="op">)</span>,
  <span class="st">"dimensions"</span> <span class="op">=</span> <span class="fl">500</span>,
  <span class="st">"crs"</span> <span class="op">=</span> <span class="st">"EPSG:3857"</span>
<span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="st">"Linear ring region and specified crs"</span>, <span class="va">thumbnail3</span><span class="op">)</span></code></pre></div>
<ul>
<li><p><code>Note</code>: Thumbnail images are also available as UI elements (Rstudio only), see: <a href=""><em>ui.Thumbnail</em></a>.*</p></li>
<li><p><code>Note</code>: <code>getThumbURL</code> is intended as a method for producing preview images you might include in presentations, websites, and social media posts. Its size limitation is 100,000,000 pixels and the browser can timeout for complicated requests. If you want a large image or have a complex process, see the <a href="">Exporting Data page</a>.</p></li>
</ul>
</div>
</div>
<div id="image-information-and-metadata" class="section level2 unnumbered">
<h2>Image Information and Metadata<a class="anchor" aria-label="anchor" href="#image-information-and-metadata"><i class="fas fa-link"></i></a>
</h2>
<p>Print image objects to explore band names, projection information, properties, and other metadata. The following examples demonstrate printing the entire set of image metadata as well as requesting specific metadata elements programmatically.</p>
<div id="getting-metadata" class="section level3 unnumbered">
<h3>Getting metadata<a class="anchor" aria-label="anchor" href="#getting-metadata"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="image.html#cb311-1"></a><span class="co"># Load an image.</span></span>
<span id="cb311-2"><a href="image.html#cb311-2"></a>image &lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Image</span>(<span class="st">"LANDSAT/LC08/C01/T1/LC08_044034_20140318"</span>)</span>
<span id="cb311-3"><a href="image.html#cb311-3"></a></span>
<span id="cb311-4"><a href="image.html#cb311-4"></a><span class="co"># Display all metadata.</span></span>
<span id="cb311-5"><a href="image.html#cb311-5"></a><span class="kw">print</span>(<span class="st">"All metadata:"</span>, image)</span>
<span id="cb311-6"><a href="image.html#cb311-6"></a></span>
<span id="cb311-7"><a href="image.html#cb311-7"></a><span class="co"># Get information about the bands as a list.</span></span>
<span id="cb311-8"><a href="image.html#cb311-8"></a>bandNames &lt;-<span class="st"> </span>image<span class="op">$</span><span class="kw">bandNames</span>()</span>
<span id="cb311-9"><a href="image.html#cb311-9"></a><span class="op">&lt;</span><span class="er">&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="st"> </span>HEAD</span>
<span id="cb311-10"><a href="image.html#cb311-10"></a><span class="kw">print</span>(<span class="st">"Band names:"</span>, bandNames)  <span class="co">## ee$List of band names</span></span>
<span id="cb311-11"><a href="image.html#cb311-11"></a><span class="op">==</span><span class="er">=====</span></span>
<span id="cb311-12"><a href="image.html#cb311-12"></a><span class="kw">print</span>(<span class="st">'Band names:'</span>, bandNames)  <span class="co">## ee$List of band names</span></span>
<span id="cb311-13"><a href="image.html#cb311-13"></a><span class="op">&gt;</span><span class="er">&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="st"> </span>master</span>
<span id="cb311-14"><a href="image.html#cb311-14"></a></span>
<span id="cb311-15"><a href="image.html#cb311-15"></a><span class="co"># Get projection information from band 1.</span></span>
<span id="cb311-16"><a href="image.html#cb311-16"></a>b1proj &lt;-<span class="st"> </span>image<span class="op">$</span><span class="kw">select</span>(<span class="st">"B1"</span>)<span class="op">$</span><span class="kw">projection</span>()</span>
<span id="cb311-17"><a href="image.html#cb311-17"></a><span class="kw">print</span>(<span class="st">"Band 1 projection:"</span>, b1proj)  <span class="co">## ee$Projection object</span></span>
<span id="cb311-18"><a href="image.html#cb311-18"></a></span>
<span id="cb311-19"><a href="image.html#cb311-19"></a><span class="co"># Get scale (in meters) information from band 1.</span></span>
<span id="cb311-20"><a href="image.html#cb311-20"></a>b1scale &lt;-<span class="st"> </span>image<span class="op">$</span><span class="kw">select</span>(<span class="st">"B1"</span>)<span class="op">$</span><span class="kw">projection</span>()<span class="op">$</span><span class="kw">nominalScale</span>()</span>
<span id="cb311-21"><a href="image.html#cb311-21"></a><span class="kw">print</span>(<span class="st">"Band 1 scale:"</span>, b1scale)  <span class="co">## ee$Number</span></span>
<span id="cb311-22"><a href="image.html#cb311-22"></a></span>
<span id="cb311-23"><a href="image.html#cb311-23"></a><span class="co">## Note that different bands can have different projections and scale.</span></span>
<span id="cb311-24"><a href="image.html#cb311-24"></a>b8scale &lt;-<span class="st"> </span>image<span class="op">$</span><span class="kw">select</span>(<span class="st">"B8"</span>)<span class="op">$</span><span class="kw">projection</span>()<span class="op">$</span><span class="kw">nominalScale</span>()</span>
<span id="cb311-25"><a href="image.html#cb311-25"></a><span class="kw">print</span>(<span class="st">"Band 8 scale:"</span>, b8scale) <span class="co">## ee$Number</span></span>
<span id="cb311-26"><a href="image.html#cb311-26"></a></span>
<span id="cb311-27"><a href="image.html#cb311-27"></a><span class="co"># Get a list of all metadata properties.</span></span>
<span id="cb311-28"><a href="image.html#cb311-28"></a>properties &lt;-<span class="st"> </span>image<span class="op">$</span><span class="kw">propertyNames</span>()</span>
<span id="cb311-29"><a href="image.html#cb311-29"></a><span class="kw">print</span>(<span class="st">"Metadata properties:"</span>, properties) <span class="co">## ee$List of metadata properties</span></span>
<span id="cb311-30"><a href="image.html#cb311-30"></a></span>
<span id="cb311-31"><a href="image.html#cb311-31"></a><span class="co"># Get a specific metadata property.</span></span>
<span id="cb311-32"><a href="image.html#cb311-32"></a>cloudiness &lt;-<span class="st"> </span>image<span class="op">$</span><span class="kw">get</span>(<span class="st">"CLOUD_COVER"</span>)</span>
<span id="cb311-33"><a href="image.html#cb311-33"></a><span class="kw">print</span>(<span class="st">"CLOUD_COVER:"</span>, cloudiness)  <span class="co">## ee$Number</span></span>
<span id="cb311-34"><a href="image.html#cb311-34"></a></span>
<span id="cb311-35"><a href="image.html#cb311-35"></a><span class="co"># Get version number (ingestion timestamp as microseconds since Unix epoch).</span></span>
<span id="cb311-36"><a href="image.html#cb311-36"></a>version &lt;-<span class="st"> </span>image<span class="op">$</span><span class="kw">get</span>(<span class="st">"system:version"</span>)</span>
<span id="cb311-37"><a href="image.html#cb311-37"></a><span class="kw">print</span>(<span class="st">"Version:"</span>, version) <span class="co">## ee$Number</span></span>
<span id="cb311-38"><a href="image.html#cb311-38"></a><span class="kw">print</span>(</span>
<span id="cb311-39"><a href="image.html#cb311-39"></a>  <span class="st">"Version (as ingestion date):"</span>,</span>
<span id="cb311-40"><a href="image.html#cb311-40"></a>  ee<span class="op">$</span><span class="kw">Date</span>(ee<span class="op">$</span><span class="kw">Number</span>(version)<span class="op">$</span><span class="kw">divide</span>(<span class="dv">1000</span>))</span>
<span id="cb311-41"><a href="image.html#cb311-41"></a>) <span class="co">## ee$Date</span></span>
<span id="cb311-42"><a href="image.html#cb311-42"></a></span>
<span id="cb311-43"><a href="image.html#cb311-43"></a><span class="co"># Get the timestamp and convert it to a date.</span></span>
<span id="cb311-44"><a href="image.html#cb311-44"></a>date &lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Date</span>(image<span class="op">$</span><span class="kw">get</span>(<span class="st">"system:time_start"</span>))</span>
<span id="cb311-45"><a href="image.html#cb311-45"></a><span class="kw">print</span>(<span class="st">"Timestamp:"</span>, date) <span class="co">## ee$Date</span></span></code></pre></div>
</div>
</div>
<div id="mathematical-operations" class="section level2 unnumbered">
<h2>Mathematical Operations<a class="anchor" aria-label="anchor" href="#mathematical-operations"><i class="fas fa-link"></i></a>
</h2>
<p>Image math can be performed using operators like <code>add()</code> and <code>subtract()</code>, but for complex computations with more than a couple of terms, the expression() function provides a good alternative. See the following sections for more information on <a href="">operators</a> and <a href="">expressions</a>.</p>
<div id="operators" class="section level3 unnumbered">
<h3>Operators<a class="anchor" aria-label="anchor" href="#operators"><i class="fas fa-link"></i></a>
</h3>
<p>Math operators perform basic arithmetic operations on image bands. They take two inputs: either two images or one image and a constant term, which is interpreted as a single-band constant image with no masked pixels. Operations are performed per pixel for each band.</p>
<p>As a simple example, consider the task of calculating the Normalized Difference Vegetation Index (NDVI) using Landsat imagery, where <code>add()</code>, <code>subtract()</code>, and <code>divide()</code> operators are used:</p>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load a 5-year Landsat 7 composite 1999-2003.</span>
<span class="va">landsat1999</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"LANDSAT/LE7_TOA_5YEAR/1999_2003"</span><span class="op">)</span>

<span class="co"># Compute NDVI.</span>
<span class="va">ndvi1999</span> <span class="op">&lt;-</span> <span class="va">landsat1999</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">"B4"</span><span class="op">)</span><span class="op">$</span><span class="fu">subtract</span><span class="op">(</span><span class="va">landsat1999</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">"B3"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">divide</span><span class="op">(</span><span class="va">landsat1999</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">"B4"</span><span class="op">)</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">landsat1999</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">"B3"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><code>Note</code>: the normalized difference operation is available as a shortcut method: <a href=""><code>normalizedDifference()</code></a>.</p>
<p>Only the intersection of unmasked pixels between the two inputs are considered and returned as unmasked, all else are masked. In general, if either input has only one band, then it is used against all the bands in the other input. If the inputs have the same number of bands, but not the same names, they’re used pairwise in the natural order. The output bands are named for the longer of the two inputs, or if they’re equal in length, in the first input’s order. The type of the output pixels is the union of the input types.</p>
<p>The following example of multi-band image subtraction demonstrates how bands are matched automatically, resulting in a “change vector” for each pixel for each co-occurring band.</p>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load a 5-year Landsat 7 composite 2008-2012.</span>
<span class="va">landsat2008</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"LANDSAT/LE7_TOA_5YEAR/2008_2012"</span><span class="op">)</span>

<span class="co"># Compute multi-band difference between the 2008-2012 composite and the</span>
<span class="co"># previously loaded 1999-2003 composite.</span>
<span class="va">diff</span> <span class="op">&lt;-</span> <span class="va">landsat2008</span><span class="op">$</span><span class="fu">subtract</span><span class="op">(</span><span class="va">landsat1999</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">diff</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B4"</span>, <span class="st">"B3"</span>, <span class="st">"B2"</span><span class="op">)</span>,
    min <span class="op">=</span> <span class="op">-</span><span class="fl">32</span>,
    max <span class="op">=</span> <span class="fl">32</span>
  <span class="op">)</span>,
  <span class="st">"difference"</span>
<span class="op">)</span>

<span class="co"># Compute the squared difference in each band.</span>
<span class="va">squaredDifference</span> <span class="op">&lt;-</span> <span class="va">diff</span><span class="op">$</span><span class="fu">pow</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">squaredDifference</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">bands</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B4"</span>, <span class="st">"B3"</span>, <span class="st">"B2"</span><span class="op">)</span>, max <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>, <span class="st">"squared diff"</span>
<span class="op">)</span></code></pre></div>
<p>In the second part of this example, the squared difference is computed using image.pow(2). For the complete list of mathematical operators handling basic arithmetic, trigonometry, exponentiation, rounding, casting, bitwise operations and more, see the <a href="">API documentation</a>.</p>
</div>
<div id="expresions" class="section level3 unnumbered">
<h3>Expresions<a class="anchor" aria-label="anchor" href="#expresions"><i class="fas fa-link"></i></a>
</h3>
<p>To implement more complex mathematical expressions, consider using image.expression(), which parses a text representation of a math operation. The following example uses expression() to compute the Enhanced Vegetation Index (EVI):</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="image.html#cb314-1"></a><span class="co"># Load a Landsat 8 image.</span></span>
<span id="cb314-2"><a href="image.html#cb314-2"></a>image &lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Image</span>(<span class="st">"LANDSAT/LC08/C01/T1_TOA/LC08_044034_20140318"</span>)</span>
<span id="cb314-3"><a href="image.html#cb314-3"></a></span>
<span id="cb314-4"><a href="image.html#cb314-4"></a><span class="co"># Compute the EVI using an expression.</span></span>
<span id="cb314-5"><a href="image.html#cb314-5"></a>evi &lt;-<span class="st"> </span><span class="kw">image.expression</span>(</span>
<span id="cb314-6"><a href="image.html#cb314-6"></a>    <span class="st">'2.5 * ((NIR - RED) / (NIR + 6 * RED - 7.5 * BLUE + 1))'</span>, {</span>
<span id="cb314-7"><a href="image.html#cb314-7"></a>      <span class="st">'NIR'</span><span class="op">:</span><span class="st"> </span><span class="kw">image.select</span>(<span class="st">'B5'</span>),</span>
<span id="cb314-8"><a href="image.html#cb314-8"></a>      <span class="st">'RED'</span><span class="op">:</span><span class="st"> </span><span class="kw">image.select</span>(<span class="st">'B4'</span>),</span>
<span id="cb314-9"><a href="image.html#cb314-9"></a>      <span class="st">'BLUE'</span><span class="op">:</span><span class="st"> </span><span class="kw">image.select</span>(<span class="st">'B2'</span>)</span>
<span id="cb314-10"><a href="image.html#cb314-10"></a>})</span>
<span id="cb314-11"><a href="image.html#cb314-11"></a></span>
<span id="cb314-12"><a href="image.html#cb314-12"></a>Map<span class="op">$</span><span class="kw">centerObject</span>(image, <span class="dv">9</span>)</span>
<span id="cb314-13"><a href="image.html#cb314-13"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(evi, <span class="kw">list</span>(<span class="dt">min =</span> <span class="dv">-1</span>, <span class="dt">max =</span> <span class="dv">1</span>, <span class="dt">palette =</span> <span class="kw">c</span>(<span class="st">"FF0000"</span>, <span class="st">"00FF00"</span>)), <span class="st">"EVI"</span>)</span></code></pre></div>
<p>Observe that the first argument to <code><a href="https://rdrr.io/r/base/expression.html">expression()</a></code> is the textual representation of the math operation, the second argument is a dictionary where the keys are variable names used in the expression and the values are the image bands to which the variables should be mapped. Bands in the image may be referred to as <code>b("band name")</code> or <code>b(index)</code>, for example <code>b(0)</code>, instead of providing the dictionary. Bands can be defined from images other than the input when using the band map dictionary. Note that <code><a href="https://rdrr.io/r/base/expression.html">expression()</a></code> uses “floor division”, which discards the remainder and returns an integer when two integers are divided. For example <code>10 / 20&lt;- 0</code>. To change this behavior, multiply one of the operands by <code>1.0: 10 * 1.0 / 20&lt;- 0.5</code>. Only the intersection of unmasked pixels are considered and returned as unmasked when bands from more than one source image are evaluated. Supported expression operators are listed in the following table.</p>
<p><strong>Operators for expression()</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Type</th>
<th align="left">Symbol</th>
<th>Name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><em>Arithmetic</em></td>
<td align="left">+ - * / % **</td>
<td>Add, Subtract, Multiply, Divide, Modulus, Exponent</td>
</tr>
<tr class="even">
<td><em>Relational</em></td>
<td align="left">== != &lt; &gt; &lt;= &gt;=</td>
<td>Equal, Not Equal, Less Than, Greater than, etc.</td>
</tr>
<tr class="odd">
<td><em>Logical</em></td>
<td align="left">&amp;&amp; <code>||</code> ! ^</td>
<td>And, Or, Not, Xor</td>
</tr>
<tr class="even">
<td><em>Ternary</em></td>
<td align="left">? :</td>
<td>If then else</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="relational-conditional-and-boolean-operations" class="section level2 unnumbered">
<h2>Relational, Conditional, and Boolean Operations<a class="anchor" aria-label="anchor" href="#relational-conditional-and-boolean-operations"><i class="fas fa-link"></i></a>
</h2>
<p><code>ee$Image</code> objects have a set of relational, conditional, and boolean methods for constructing decision-making expressions. The results of these methods are useful for limiting analysis to certain pixels or regions through masking, developing classified maps, and value reassignment.</p>
<div id="relational-and-boolean-operators" class="section level3 unnumbered">
<h3>Relational and boolean operators<a class="anchor" aria-label="anchor" href="#relational-and-boolean-operators"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li><p><strong>Relational</strong> methods include:
<code>eq()</code>, <code>gt()</code>, <code>gte()</code>, <code>lt()</code>, and <code>lte()</code>.</p></li>
<li><p><strong>Boolean</strong> methods include:
<code>and()</code>,<code>or()</code>, and <code>not()</code>.</p></li>
</ul>
<p>To perform per-pixel comparisons between images, use relational operators. To extract urbanized areas in an image, this example uses relational operators to threshold spectral indices, combining the thresholds with the and operator:</p>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load a Landsat 8 image.</span>
<span class="va">image</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"LANDSAT/LC08/C01/T1_TOA/LC08_044034_20140318"</span><span class="op">)</span>

<span class="co"># Create NDVI and NDWI spectral indices.</span>
<span class="va">ndvi</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="fu">normalizedDifference</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B5"</span>, <span class="st">"B4"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ndwi</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="fu">normalizedDifference</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B3"</span>, <span class="st">"B5"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Create a binary layer using logical operations.</span>
<span class="va">bare</span> <span class="op">&lt;-</span> <span class="va">ndvi</span><span class="op">$</span><span class="fu">lt</span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span><span class="op">$</span><span class="fu">and</span><span class="op">(</span><span class="va">ndwi</span><span class="op">$</span><span class="fu">lt</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Mask and display the binary layer.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">setCenter</span><span class="op">(</span><span class="op">-</span><span class="fl">122.3578</span>, <span class="fl">37.7726</span>, <span class="fl">12</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">setOptions</span><span class="op">(</span><span class="st">"satellite"</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">bare</span><span class="op">$</span><span class="fu">selfMask</span><span class="op">(</span><span class="op">)</span>,
  <span class="op">{</span><span class="op">}</span>,
  <span class="st">"bare"</span>
<span class="op">)</span></code></pre></div>
<p>As illustrated by this example, the output of relational and boolean operators is either true (1) or false (0). To mask the 0’s, you can mask the resultant binary image with itself using <code>selfMask()</code>.</p>
<center>
<img src="../images/chapter_05/figure_06.png" title="fig:" width="670" alt="Figure 6. Low NDVI and low NDWI (white) from Landsat 8, San Francisco, California, USA.">
</center>
<p>The binary images that are returned by relational and boolean operators can be used with mathematical operators. This example creates zones of urbanization in a nighttime lights image using relational operators and <code>add()</code>:</p>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load a 2012 nightlights image.</span>
<span class="va">nl2012</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"NOAA/DMSP-OLS/NIGHTTIME_LIGHTS/F182012"</span><span class="op">)</span>
<span class="va">lights</span> <span class="op">&lt;-</span> <span class="va">nl2012</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">"stable_lights"</span><span class="op">)</span>

<span class="co"># Define arbitrary thresholds on the 6-bit stable lights band.</span>
<span class="va">zones</span> <span class="op">&lt;-</span> <span class="va">lights</span><span class="op">$</span><span class="fu">gt</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">lights</span><span class="op">$</span><span class="fu">gt</span><span class="op">(</span><span class="fl">55</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">lights</span><span class="op">$</span><span class="fu">gt</span><span class="op">(</span><span class="fl">62</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Display the thresholded image as three distinct zones near Paris.</span>
<span class="va">palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"000000"</span>, <span class="st">"0000FF"</span>, <span class="st">"00FF00"</span>, <span class="st">"FF0000"</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">setCenter</span><span class="op">(</span><span class="fl">2.373</span>, <span class="fl">48.8683</span>, <span class="fl">8</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">zones</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">3</span>, palette <span class="op">=</span> <span class="va">palette</span><span class="op">)</span>, <span class="st">"development zones"</span><span class="op">)</span></code></pre></div>
</div>
<div id="conditional-operators" class="section level3 unnumbered">
<h3>Conditional operators<a class="anchor" aria-label="anchor" href="#conditional-operators"><i class="fas fa-link"></i></a>
</h3>
<p>Note that the code in the previous example is equivalent to using a <a href="">ternary operator</a> implemented by <code><a href="https://rdrr.io/r/base/expression.html">expression()</a></code>:</p>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create zones using an expression, display.</span>
<span class="va">zonesExp</span> <span class="op">&lt;-</span> <span class="fu">nl2012.expression</span><span class="op">(</span>
  <span class="st">"(b('stable_lights') &gt; 62) ? 3"</span> <span class="op">+</span>
    <span class="st">": (b('stable_lights') &gt; 55) ? 2"</span> <span class="op">+</span>
    <span class="st">": (b('stable_lights') &gt; 30) ? 1"</span> <span class="op">+</span>
    <span class="st">": 0"</span>
<span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">zonesExp</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">3</span>, palette <span class="op">=</span> <span class="va">palette</span><span class="op">)</span>,
  <span class="st">"development zones (ternary)"</span>
<span class="op">)</span></code></pre></div>
<p>Observe that in the previous expression example, the band of interest is referenced using the b() function, rather than a dictionary of variable names. Learn more about image expressions on <a href="">this page</a>. Using either mathematical operators or an expression will produce the same result.</p>
<center>
<img src="../images/chapter_05/figure_07.png" title="fig:" width="670" alt="Figure 7. Arbitrary zones of 2012 nightlights imagery for Paris, France.">
</center>
<p>Another way to implement conditional operations on images is with the <code>where()</code> operator. Consider the need to replace masked pixels with some other data. In the following example, cloudy pixels are replaced by pixels from a cloud-free image using <code>where()</code>:</p>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load a cloudy Landsat 8 image.</span>
<span class="va">image</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"LANDSAT/LC08/C01/T1_TOA/LC08_044034_20130603"</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">image</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B5"</span>, <span class="st">"B4"</span>, <span class="st">"B3"</span><span class="op">)</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
  <span class="st">"original image"</span>
<span class="op">)</span>

<span class="co"># Load another image to replace the cloudy pixels.</span>
<span class="va">replacement</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">"LANDSAT/LC08/C01/T1_TOA/LC08_044034_20130416"</span><span class="op">)</span>

<span class="co"># Compute a cloud score band.</span>
<span class="va">cloud</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Algorithms</span><span class="op">$</span><span class="va">Landsat</span><span class="op">$</span><span class="fu">simpleCloudScore</span><span class="op">(</span><span class="va">image</span><span class="op">)</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">"cloud"</span><span class="op">)</span>

<span class="co"># Set cloudy pixels to the other image.</span>
<span class="va">replaced</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="fu">where</span><span class="op">(</span><span class="va">cloud</span><span class="op">$</span><span class="fu">gt</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, <span class="va">replacement</span><span class="op">)</span>

<span class="co"># Display the result.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">centerObject</span><span class="op">(</span><span class="va">image</span>, <span class="fl">9</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">replaced</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B5"</span>, <span class="st">"B4"</span>, <span class="st">"B3"</span><span class="op">)</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,
  <span class="st">"clouds replaced"</span>
<span class="op">)</span></code></pre></div>
<p>In this example, observe the use of the <code>simpleCloudScore()</code> algorithm. This algorithm ranks pixels by cloudiness on a scale of 0-100, with 100 most cloudy. Learn more about <code>simpleCloudScore()</code> on the <a href="">Landsat Algorithms page</a>.</p>
</div>
</div>
<div id="convolutions" class="section level2 unnumbered">
<h2>Convolutions<a class="anchor" aria-label="anchor" href="#convolutions"><i class="fas fa-link"></i></a>
</h2>
<p>To perform linear convolutions on images, use <code>image.convolve()</code>. The only argument to convolve is an ee.Kernel which is specified by a shape and the weights in the kernel. Each pixel of the image output by <code><a href="https://rdrr.io/r/stats/convolve.html">convolve()</a></code> is the linear combination of the kernel values and the input image pixels covered by the kernel. The kernels are applied to each band individually. For example, you might want to use a low-pass (smoothing) kernel to remove high-frequency information. The following illustrates a 15x15 low-pass kernel applied to a Landsat 8 image:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="image.html#cb319-1"></a><span class="co"># Load and display an image.</span></span>
<span id="cb319-2"><a href="image.html#cb319-2"></a><span class="op">&lt;</span><span class="er">&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="st"> </span>HEAD</span>
<span id="cb319-3"><a href="image.html#cb319-3"></a>image &lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Image</span>(<span class="st">"LANDSAT/LC08/C01/T1_TOA/LC08_044034_20140318"</span>)</span>
<span id="cb319-4"><a href="image.html#cb319-4"></a>vizParams &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb319-5"><a href="image.html#cb319-5"></a>  <span class="dt">bands =</span> <span class="kw">c</span>(<span class="st">"B5"</span>, <span class="st">"B4"</span>, <span class="st">"B3"</span>),</span>
<span id="cb319-6"><a href="image.html#cb319-6"></a>  <span class="dt">max =</span> <span class="fl">0.5</span></span>
<span id="cb319-7"><a href="image.html#cb319-7"></a>)</span>
<span id="cb319-8"><a href="image.html#cb319-8"></a><span class="op">==</span><span class="er">=====</span></span>
<span id="cb319-9"><a href="image.html#cb319-9"></a>image &lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Image</span>(<span class="st">'LANDSAT/LC08/C01/T1_TOA/LC08_044034_20140318'</span>)</span>
<span id="cb319-10"><a href="image.html#cb319-10"></a>vizParams &lt;-<span class="st"> </span><span class="kw">list</span>(bands&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'B5'</span>, <span class="st">'B4'</span>, <span class="st">'B3'</span>),</span>
<span id="cb319-11"><a href="image.html#cb319-11"></a>                  max&lt;-<span class="st"> </span><span class="fl">0.5</span>)</span>
<span id="cb319-12"><a href="image.html#cb319-12"></a><span class="op">&gt;</span><span class="er">&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="st"> </span>master</span>
<span id="cb319-13"><a href="image.html#cb319-13"></a>Map<span class="op">$</span><span class="kw">setCenter</span>(<span class="op">-</span><span class="fl">121.9785</span>, <span class="fl">37.8694</span>, <span class="dv">11</span>)</span>
<span id="cb319-14"><a href="image.html#cb319-14"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(image, vizParams, <span class="st">"input image"</span>)</span>
<span id="cb319-15"><a href="image.html#cb319-15"></a></span>
<span id="cb319-16"><a href="image.html#cb319-16"></a><span class="co"># Define a boxcar or low-pass kernel.</span></span>
<span id="cb319-17"><a href="image.html#cb319-17"></a>boxcar &lt;-<span class="st"> </span>ee<span class="op">$</span>Kernel<span class="op">$</span><span class="kw">square</span>(<span class="kw">list</span>(</span>
<span id="cb319-18"><a href="image.html#cb319-18"></a><span class="op">&lt;</span><span class="er">&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="st"> </span>HEAD</span>
<span id="cb319-19"><a href="image.html#cb319-19"></a>  <span class="dt">radius =</span> <span class="dv">7</span>,</span>
<span id="cb319-20"><a href="image.html#cb319-20"></a>  <span class="dt">units =</span> <span class="st">"pixels"</span>,</span>
<span id="cb319-21"><a href="image.html#cb319-21"></a>  <span class="dt">normalize =</span> <span class="ot">TRUE</span></span>
<span id="cb319-22"><a href="image.html#cb319-22"></a><span class="op">==</span><span class="er">=====</span></span>
<span id="cb319-23"><a href="image.html#cb319-23"></a><span class="st">  </span>radius&lt;-<span class="st"> </span><span class="dv">7</span>,</span>
<span id="cb319-24"><a href="image.html#cb319-24"></a>  units&lt;-<span class="st"> 'pixels'</span>, </span>
<span id="cb319-25"><a href="image.html#cb319-25"></a>  normalize&lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb319-26"><a href="image.html#cb319-26"></a><span class="op">&gt;</span><span class="er">&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="st"> </span>master</span>
<span id="cb319-27"><a href="image.html#cb319-27"></a>))</span>
<span id="cb319-28"><a href="image.html#cb319-28"></a></span>
<span id="cb319-29"><a href="image.html#cb319-29"></a><span class="co"># Smooth the image by convolving with the boxcar kernel.</span></span>
<span id="cb319-30"><a href="image.html#cb319-30"></a>smooth &lt;-<span class="st"> </span>image<span class="op">$</span><span class="kw">convolve</span>(boxcar)</span>
<span id="cb319-31"><a href="image.html#cb319-31"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(smooth, <span class="kw">list</span>(<span class="dt">bands =</span> <span class="kw">c</span>(<span class="st">"B5"</span>, <span class="st">"B4"</span>, <span class="st">"B3"</span>), <span class="dt">max =</span> <span class="fl">0.5</span>), <span class="st">"smoothed"</span>)</span></code></pre></div>
<p>The output of convolution with the low-pass filter should look something like Figure 8. Observe that the arguments to the kernel determine its size and coefficients. Specifically, with the <code>units</code> parameter set to pixels, the radius parameter specifies the number of pixels from the center that the kernel will cover. If <code>normalize</code> is set to <code>true</code>, the kernel coefficients will sum to one. If the <code>magnitude</code> parameter is set, the kernel coefficients will be multiplied by the magnitude (if <code>normalize</code> is also true, the coefficients will sum to <code>magnitude</code>). If there is a negative value in any of the kernel coefficients, setting <code>normalize</code> to true will make the coefficients sum to zero.</p>
<center>
<img src="../images/chapter_05/figure_08.png" title="fig:" width="670" alt="Figure 8. Landsat 8 image convolved with a smoothing kernel. San Francisco Bay area, California, USA.">
</center>
<p>Use other kernels to achieve the desired image processing effect. This example uses a Laplacian kernel for isotropic edge detection:</p>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Define a Laplacian, or edge-detection kernel.</span>
<span class="va">laplacian</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Kernel</span><span class="op">$</span><span class="fu">laplacian8</span><span class="op">(</span><span class="op">{</span>
  <span class="va">normalize</span><span class="op">:</span><span class="va">false</span>
<span class="op">}</span><span class="op">)</span>

<span class="co"># Apply the edge-detection kernel.</span>
<span class="va">edgy</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="fu">convolve</span><span class="op">(</span><span class="va">laplacian</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">edgy</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B5"</span>, <span class="st">"B4"</span>, <span class="st">"B3"</span><span class="op">)</span>, max <span class="op">=</span> <span class="fl">0.5</span>, format <span class="op">=</span> <span class="st">"png"</span><span class="op">)</span>,
  <span class="st">"edges"</span>
<span class="op">)</span></code></pre></div>
<p>Note the format specifier in the visualization parameters. Earth Engine sends display tiles to the Rstudio in JPEG format for efficiency, however edge tiles are sent in PNG format to handle transparency of pixels outside the image boundary. When a visual discontinuity results, setting the format to PNG results in a consistent display. The result of convolving with the Laplacian edge detection kernel should look something like Figure 9.</p>
<center>
<img src="../images/chapter_05/figure_09.png" title="fig:" width="670" alt="Figure 9. Landsat 8 image convolved with a Laplacian edge detection kernel. San Francisco Bay area, California,USA.">
</center>
<p>There are also anisotropic edge detection kernels (e.g. Sobel, Prewitt, Roberts), the direction of which can be changed with <code>kernel$rotate()</code>. Other low pass kernels include a Gaussian kernel and kernels of various shape with uniform weights. To create kernels with arbitrarily defined weights and shape, use <code>ee$Kernel$fixed()</code>. For example, this code creates a 9x9 kernel of 1’s with a zero in the middle:</p>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a list of weights for a 9x9 kernel.</span>
<span class="va">row</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>

<span class="co"># The center of the kernel is zero.</span>
<span class="va">centerRow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>

<span class="co"># Assemble a list of lists: the 9x9 kernel weights as a 2-D matrix.</span>
<span class="va">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">row</span>, <span class="va">row</span>, <span class="va">row</span>, <span class="va">row</span>, <span class="va">centerRow</span>, <span class="va">row</span>, <span class="va">row</span>, <span class="va">row</span>, <span class="va">row</span><span class="op">)</span>

<span class="co"># Create the kernel from the weights.</span>
<span class="va">kernel</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Kernel</span><span class="op">$</span><span class="fu">fixed</span><span class="op">(</span><span class="fl">9</span>, <span class="fl">9</span>, <span class="va">rows</span>, <span class="op">-</span><span class="fl">4</span>, <span class="op">-</span><span class="fl">4</span>, <span class="va">false</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">kernel</span><span class="op">)</span></code></pre></div>
</div>
<div id="morphological-operations" class="section level2 unnumbered">
<h2>Morphological Operations<a class="anchor" aria-label="anchor" href="#morphological-operations"><i class="fas fa-link"></i></a>
</h2>
<p>Earth Engine implements morphological operations as focal operations, specifically <code>focalMax()</code>, <code>focalMin()</code>, <code>focalMedian()</code>, and <code>focalMode()</code> instance methods in the <code>Image</code> class. (These are shortcuts for the more general reduceNeighborhood(), which can input the pixels in a kernel to any reducer with a numeric output. See this <a href="">page</a> for more information on reducing neighborhoods). The morphological operators are useful for performing operations such as erosion, dilation, opening and closing. For example, to perform an <a href="">opening operation</a>, use <code>focalMin()</code> followed by <code>focalMax()</code>:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="image.html#cb322-1"></a><span class="co"># Load a Landsat 8 image, select the NIR band, threshold, display.</span></span>
<span id="cb322-2"><a href="image.html#cb322-2"></a>image &lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Image</span>(<span class="st">"LANDSAT/LC08/C01/T1_TOA/LC08_044034_20140318"</span>)<span class="op">$</span></span>
<span id="cb322-3"><a href="image.html#cb322-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="dv">4</span>)<span class="op">$</span><span class="kw">gt</span>(<span class="fl">0.2</span>)</span>
<span id="cb322-4"><a href="image.html#cb322-4"></a>Map<span class="op">$</span><span class="kw">setCenter</span>(<span class="op">-</span><span class="fl">122.1899</span>, <span class="fl">37.5010</span>, <span class="dv">13</span>)</span>
<span id="cb322-5"><a href="image.html#cb322-5"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(</span>
<span id="cb322-6"><a href="image.html#cb322-6"></a>  image,</span>
<span id="cb322-7"><a href="image.html#cb322-7"></a>  {},</span>
<span id="cb322-8"><a href="image.html#cb322-8"></a>  <span class="st">"NIR threshold"</span></span>
<span id="cb322-9"><a href="image.html#cb322-9"></a>)</span>
<span id="cb322-10"><a href="image.html#cb322-10"></a></span>
<span id="cb322-11"><a href="image.html#cb322-11"></a><span class="co"># Define a kernel.</span></span>
<span id="cb322-12"><a href="image.html#cb322-12"></a>kernel &lt;-<span class="st"> </span>ee<span class="op">$</span>Kernel<span class="op">$</span><span class="kw">circle</span>(radius&lt;-<span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb322-13"><a href="image.html#cb322-13"></a></span>
<span id="cb322-14"><a href="image.html#cb322-14"></a><span class="co"># Perform an erosion followed by a dilation, display.</span></span>
<span id="cb322-15"><a href="image.html#cb322-15"></a>opened &lt;-<span class="st"> </span>image<span class="op">$</span></span>
<span id="cb322-16"><a href="image.html#cb322-16"></a><span class="st">  </span><span class="kw">focalMin</span>({kernel<span class="op">:</span><span class="st"> </span>kernel, iterations<span class="op">:</span><span class="st"> </span><span class="dv">2</span>})<span class="op">$</span></span>
<span id="cb322-17"><a href="image.html#cb322-17"></a><span class="st">  </span><span class="kw">focalMax</span>({kernel<span class="op">:</span><span class="st"> </span>kernel, iterations<span class="op">:</span><span class="st"> </span><span class="dv">2</span>})</span>
<span id="cb322-18"><a href="image.html#cb322-18"></a><span class="kw">Map.addLayer</span>(opened, {}, <span class="st">'opened'</span>)</span></code></pre></div>
<p>Note that in the previous example, a kernel argument is provided to the morphological operator. The pixels covered by non-zero elements of the kernel are used in the computation. The iterations argument indicates how many times to apply the operator.</p>
</div>
<div id="gradients" class="section level2 unnumbered">
<h2>Gradients<a class="anchor" aria-label="anchor" href="#gradients"><i class="fas fa-link"></i></a>
</h2>
<p>You can compute the gradient of each band of an image with <code>image.gradient()</code>. For example, the following code computes the gradient magnitude and direction of the Landsat 8 panchromatic band:</p>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load a Landsat 8 image and select the panchromatic band.</span>
<span class="va">image</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">'LANDSAT/LC08/C01/T1/LC08_044034_20140318'</span><span class="op">)</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'B8'</span><span class="op">)</span>

<span class="co"># Compute the image gradient in the X and Y directions.</span>
<span class="va">xyGrad</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="fu">gradient</span><span class="op">(</span><span class="op">)</span>

<span class="co"># Compute the magnitude of the gradient.</span>
<span class="va">gradient</span> <span class="op">&lt;-</span> <span class="va">xyGrad</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'x'</span><span class="op">)</span><span class="op">$</span><span class="fu">pow</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">add</span><span class="op">(</span><span class="va">xyGrad</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'y'</span><span class="op">)</span><span class="op">$</span><span class="fu">pow</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="fu">sqrt</span><span class="op">(</span><span class="op">)</span>

<span class="co"># Compute the direction of the gradient.</span>
<span class="va">direction</span> <span class="op">&lt;-</span> <span class="va">xyGrad</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'y'</span><span class="op">)</span><span class="op">$</span><span class="fu">atan2</span><span class="op">(</span><span class="va">xyGrad</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'x'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Display the results.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">setCenter</span><span class="op">(</span><span class="op">-</span><span class="fl">122.054</span>, <span class="fl">37.7295</span>, <span class="fl">10</span><span class="op">)</span>;
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">direction</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">min</span><span class="op">:</span> <span class="op">-</span><span class="fl">2</span>, <span class="va">max</span><span class="op">:</span> <span class="fl">2</span>, <span class="va">format</span><span class="op">:</span> <span class="st">'png'</span><span class="op">)</span>, <span class="st">'direction'</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">gradient</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">min</span><span class="op">:</span> <span class="op">-</span><span class="fl">7</span>, <span class="va">max</span><span class="op">:</span> <span class="fl">7</span>, <span class="va">format</span><span class="op">:</span> <span class="st">'png'</span><span class="op">)</span>, <span class="st">'gradient'</span><span class="op">)</span></code></pre></div>
Note that <code>gradient()</code> outputs two bands: the gradient in the X-direction and the gradient in the Y-direction. As shown in the example, the two directions can be combined to get gradient magnitude and direction. The magnitude should look something like Figure 10.
<center>
<img src="../images/chapter_05/figure_10.png" title="fig:" width="670" alt="Figure 10. Panchromatic gradient magnitude for the Landsat 8 imagery over the San Francisco Bay area, California, USA.">
</center>
</div>
<div id="edge-detection" class="section level2 unnumbered">
<h2>Edge detection<a class="anchor" aria-label="anchor" href="#edge-detection"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https:#en.wikipedia.org/wiki/Edge_detection">Edge detection</a> is applicable to a wide range of image processing tasks. In addition to the edge detection kernels described in the <a href="">convolutions section</a>, there are several specialized edge detection algorithms in Earth Engine. The Canny edge detection algorithm (<a href="https:#ieeexplore.ieee.org/document/">Canny 1986</a>) uses four separate filters to identify the diagonal, vertical, and horizontal edges. The calculation extracts the first derivative value for the horizontal and vertical directions and computes the gradient magnitude. Gradients of smaller magnitude are suppressed. To eliminate high-frequency noise, optionally pre-filter the image with a Gaussian kernel. For example:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="image.html#cb324-1"></a><span class="co"># Load a Landsat 8 image, select the panchromatic band.</span></span>
<span id="cb324-2"><a href="image.html#cb324-2"></a>image &lt;-<span class="st"> </span>ee.<span class="op">$</span><span class="kw">Image</span>(<span class="st">"LANDSAT/LC08/C01/T1/LC08_044034_20140318"</span>)<span class="op">$</span><span class="kw">select</span>(<span class="st">"B8"</span>)</span>
<span id="cb324-3"><a href="image.html#cb324-3"></a></span>
<span id="cb324-4"><a href="image.html#cb324-4"></a><span class="co"># Perform Canny edge detection and display the result.</span></span>
<span id="cb324-5"><a href="image.html#cb324-5"></a>canny &lt;-<span class="st"> </span>ee<span class="op">$</span>Algorithms<span class="op">$</span><span class="kw">CannyEdgeDetector</span>(<span class="kw">list</span>(</span>
<span id="cb324-6"><a href="image.html#cb324-6"></a><span class="op">&lt;</span><span class="er">&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="st"> </span>HEAD</span>
<span id="cb324-7"><a href="image.html#cb324-7"></a>  <span class="dt">image =</span> image,</span>
<span id="cb324-8"><a href="image.html#cb324-8"></a>  <span class="dt">threshold =</span> <span class="dv">10</span>,</span>
<span id="cb324-9"><a href="image.html#cb324-9"></a>  <span class="dt">sigma =</span> <span class="dv">1</span></span>
<span id="cb324-10"><a href="image.html#cb324-10"></a>))</span>
<span id="cb324-11"><a href="image.html#cb324-11"></a><span class="op">==</span><span class="er">=====</span></span>
<span id="cb324-12"><a href="image.html#cb324-12"></a><span class="st">  </span>image&lt;-<span class="st"> </span>image, </span>
<span id="cb324-13"><a href="image.html#cb324-13"></a>  threshold&lt;-<span class="st"> </span><span class="dv">10</span>, </span>
<span id="cb324-14"><a href="image.html#cb324-14"></a>  sigma&lt;-<span class="st"> </span><span class="dv">1</span><span class="er">)</span></span>
<span id="cb324-15"><a href="image.html#cb324-15"></a>  <span class="er">)</span></span>
<span id="cb324-16"><a href="image.html#cb324-16"></a><span class="op">&gt;</span><span class="er">&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="st"> </span>master</span>
<span id="cb324-17"><a href="image.html#cb324-17"></a>Map<span class="op">$</span><span class="kw">setCenter</span>(<span class="op">-</span><span class="fl">122.054</span>, <span class="fl">37.7295</span>, <span class="dv">10</span>)</span>
<span id="cb324-18"><a href="image.html#cb324-18"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(</span>
<span id="cb324-19"><a href="image.html#cb324-19"></a>  canny,</span>
<span id="cb324-20"><a href="image.html#cb324-20"></a>  {},</span>
<span id="cb324-21"><a href="image.html#cb324-21"></a>  <span class="st">"canny"</span></span>
<span id="cb324-22"><a href="image.html#cb324-22"></a>)</span></code></pre></div>
<p>Note that the <code>threshold</code> parameter determines the minimum gradient magnitude and the <code>sigma</code> parameter is the standard deviation (SD) of a Gaussian pre-filter to remove high-frequency noise. For line extraction from an edge detector, Earth Engine implements the Hough transform (<a href="https:#dl.acm.org/doi/10.1145/361237.361242">Duda and Hart 1972</a>). Continuing the previous example, extract lines from the Canny detector with:</p>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Perform Hough transform of the Canny result and display.</span>
<span class="va">hough</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Algorithms</span><span class="op">$</span><span class="fu">HoughTransform</span><span class="op">(</span><span class="va">canny</span>, <span class="fl">256</span>, <span class="fl">600</span>, <span class="fl">100</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">hough</span>,
  <span class="op">{</span><span class="op">}</span>,
  <span class="st">"hough"</span>
<span class="op">)</span></code></pre></div>
<p>Another specialized algorithm in Earth Engine is <code>zeroCrossing()</code>. A zero-crossing is defined as any pixel where the right, bottom, or diagonal bottom-right pixel has the opposite sign. If any of these pixels is of opposite sign, the current pixel is set to 1 (zero-crossing); otherwise it’s set to zero. To detect edges, the zero-crossings algorithm can be applied to an estimate of the image second derivative. The following demonstrates using <code>zeroCrossing()</code> for edge detection:</p>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load a Landsat 8 image, select the panchromatic band.</span>
<span class="va">image</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">'LANDSAT/LC08/C01/T1/LC08_044034_20140318'</span><span class="op">)</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'B8'</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">image</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">max</span><span class="op">:</span> <span class="fl">12000</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Define a "fat" Gaussian kernel.</span>
<span class="va">fat</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Kernel</span><span class="op">$</span><span class="fu">gaussian</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">radius</span><span class="op">&lt;-</span> <span class="fl">3</span>,
  <span class="va">sigma</span><span class="op">&lt;-</span> <span class="fl">3</span>,
  <span class="va">units</span><span class="op">&lt;-</span> <span class="st">'pixels'</span>,
  <span class="va">normalize</span><span class="op">&lt;-</span> <span class="va">true</span>,
  <span class="va">magnitude</span><span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Define a "skinny" Gaussian kernel.</span>
<span class="va">skinny</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Kernel</span><span class="op">$</span><span class="fu">gaussian</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">radius</span><span class="op">&lt;-</span> <span class="fl">3</span>,
  <span class="va">sigma</span><span class="op">&lt;-</span> <span class="fl">1</span>,
  <span class="va">units</span><span class="op">&lt;-</span> <span class="st">'pixels'</span>,
  <span class="va">normalize</span><span class="op">&lt;-</span> <span class="va">true</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Compute a difference-of-Gaussians (DOG) kernel.</span>
<span class="va">dog</span> <span class="op">&lt;-</span> <span class="va">fat</span><span class="op">$</span><span class="fu">add</span><span class="op">(</span><span class="va">skinny</span><span class="op">)</span>

<span class="co"># Compute the zero crossings of the second derivative, display.</span>
<span class="va">zeroXings</span> <span class="op">&lt;-</span> <span class="va">image</span><span class="op">$</span><span class="fu">convolve</span><span class="op">(</span><span class="va">dog</span><span class="op">)</span><span class="op">$</span><span class="fu">zeroCrossing</span><span class="op">(</span><span class="op">)</span>
<span class="fu">Map.setCenter</span><span class="op">(</span><span class="op">-</span><span class="fl">122.054</span>, <span class="fl">37.7295</span>, <span class="fl">10</span><span class="op">)</span>
<span class="fu">Map.addLayer</span><span class="op">(</span><span class="va">zeroXings</span><span class="op">$</span><span class="fu">selfMask</span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">palette</span><span class="op">&lt;-</span> <span class="st">'FF0000'</span><span class="op">)</span>, <span class="st">'zero crossings'</span><span class="op">)</span></code></pre></div>
<p>The zero-crossings output for an area near the San Francisco, CA airport should look something like Figure 11.</p>
<center>
<div class="figure">
<img src="../images/chapter_05/figure_11.png" width="670" alt=""><p class="caption">Figure 11. Zero-crossings output (red) with the Landsat 8 panchromatic band in the background for an area near the San Francisco, California airport (right).</p>
</div>
</center>
</div>
<div id="spectral-transformations" class="section level2 unnumbered">
<h2>Spectral transformations<a class="anchor" aria-label="anchor" href="#spectral-transformations"><i class="fas fa-link"></i></a>
</h2>
<p>There are several spectral transformation methods in Earth Engine. These include instance methods on images such as <code>normalizedDifference()</code>, <code>unmix()</code>, <code>rgbToHsv()</code> and <code>hsvToRgb()</code>.</p>
<div id="pan-sharpening" class="section level3 unnumbered">
<h3>Pan sharpening<a class="anchor" aria-label="anchor" href="#pan-sharpening"><i class="fas fa-link"></i></a>
</h3>
<p>Pan sharpening improves the resolution of a multiband image through enhancement provided by a corresponding panchromatic image with finer resolution. The <code>rgbToHsv()</code> and <code>hsvToRgb()</code> methods are useful for pan sharpening.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="image.html#cb327-1"></a><span class="co"># Load a Landsat 8 top-of-atmosphere reflectance image.</span></span>
<span id="cb327-2"><a href="image.html#cb327-2"></a>image &lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Image</span>(<span class="st">"LANDSAT/LC08/C01/T1_TOA/LC08_044034_20140318"</span>)</span>
<span id="cb327-3"><a href="image.html#cb327-3"></a></span>
<span id="cb327-4"><a href="image.html#cb327-4"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(</span>
<span id="cb327-5"><a href="image.html#cb327-5"></a><span class="op">&lt;</span><span class="er">&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="st"> </span>HEAD</span>
<span id="cb327-6"><a href="image.html#cb327-6"></a>  image,</span>
<span id="cb327-7"><a href="image.html#cb327-7"></a>  <span class="kw">list</span>(<span class="dt">bands =</span> <span class="kw">c</span>(<span class="st">"B4"</span>, <span class="st">"B3"</span>, <span class="st">"B2"</span>), <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="fl">0.25</span>, <span class="dt">gamma =</span> <span class="kw">c</span>(<span class="fl">1.1</span>, <span class="fl">1.1</span>, <span class="dv">1</span>)),</span>
<span id="cb327-8"><a href="image.html#cb327-8"></a>  <span class="st">"rgb"</span></span>
<span id="cb327-9"><a href="image.html#cb327-9"></a>)</span>
<span id="cb327-10"><a href="image.html#cb327-10"></a><span class="op">==</span><span class="er">=====</span></span>
<span id="cb327-11"><a href="image.html#cb327-11"></a><span class="st">    </span>image,</span>
<span id="cb327-12"><a href="image.html#cb327-12"></a>    <span class="kw">list</span>(bands&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'B4'</span>, <span class="st">'B3'</span>, <span class="st">'B2'</span>), min&lt;-<span class="st"> </span><span class="dv">0</span>, max&lt;-<span class="st"> </span><span class="fl">0.25</span>, gamma&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.1</span>, <span class="fl">1.1</span>, <span class="dv">1</span>)),</span>
<span id="cb327-13"><a href="image.html#cb327-13"></a>    <span class="st">'rgb'</span><span class="er">)</span></span>
<span id="cb327-14"><a href="image.html#cb327-14"></a><span class="op">&gt;</span><span class="er">&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="st"> </span>master</span>
<span id="cb327-15"><a href="image.html#cb327-15"></a></span>
<span id="cb327-16"><a href="image.html#cb327-16"></a><span class="co"># Convert the RGB bands to the HSV color space.</span></span>
<span id="cb327-17"><a href="image.html#cb327-17"></a>hsv &lt;-<span class="st"> </span>image<span class="op">$</span><span class="kw">select</span>(<span class="kw">c</span>(<span class="st">"B4"</span>, <span class="st">"B3"</span>, <span class="st">"B2"</span>))<span class="op">$</span><span class="kw">rgbToHsv</span>()</span>
<span id="cb327-18"><a href="image.html#cb327-18"></a></span>
<span id="cb327-19"><a href="image.html#cb327-19"></a><span class="co"># Swap in the panchromatic band and convert back to RGB.</span></span>
<span id="cb327-20"><a href="image.html#cb327-20"></a>sharpened &lt;-<span class="st"> </span>ee<span class="op">$</span>Image<span class="op">$</span><span class="kw">cat</span>(<span class="kw">list</span>(hsv<span class="op">$</span><span class="kw">select</span>(<span class="st">'hue'</span>), hsv<span class="op">$</span><span class="kw">select</span>(<span class="st">'saturation'</span>),image<span class="op">$</span><span class="kw">select</span>(<span class="st">'B8'</span>)))</span>
<span id="cb327-21"><a href="image.html#cb327-21"></a><span class="op">$</span><span class="kw">hsvToRgb</span>()</span>
<span id="cb327-22"><a href="image.html#cb327-22"></a></span>
<span id="cb327-23"><a href="image.html#cb327-23"></a><span class="co"># Display the pan-sharpened result.</span></span>
<span id="cb327-24"><a href="image.html#cb327-24"></a>Map<span class="op">$</span><span class="kw">setCenter</span>(<span class="op">-</span><span class="fl">122.44829</span>, <span class="fl">37.76664</span>, <span class="dv">13</span>);</span>
<span id="cb327-25"><a href="image.html#cb327-25"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(sharpened,</span>
<span id="cb327-26"><a href="image.html#cb327-26"></a>             <span class="kw">list</span>(min&lt;-<span class="st"> </span><span class="dv">0</span>, max&lt;-<span class="st"> </span><span class="fl">0.25</span>, gamma&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.3</span>, <span class="fl">1.3</span>, <span class="fl">1.3</span>)),</span>
<span id="cb327-27"><a href="image.html#cb327-27"></a>             <span class="st">'pan-sharpened'</span>)</span></code></pre></div>
</div>
<div id="spectral-unmixing" class="section level3 unnumbered">
<h3>Spectral unmixing<a class="anchor" aria-label="anchor" href="#spectral-unmixing"><i class="fas fa-link"></i></a>
</h3>
<p>Spectral unmixing is implemented in Earth Engine as the <code>image.unmix()</code> method. (For more flexible methods, see the <a href="">Array Transformations page</a>). The following is an example of unmixing Landsat 5 with predetermined urban, vegetation and water endmembers:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="image.html#cb328-1"></a><span class="co"># Load a Landsat 5 image and select the bands we want to unmix.</span></span>
<span id="cb328-2"><a href="image.html#cb328-2"></a>bands &lt;-<span class="st"> </span><span class="kw">C</span>(<span class="st">"B1"</span>, <span class="st">"B2"</span>, <span class="st">"B3"</span>, <span class="st">"B4"</span>, <span class="st">"B5"</span>, <span class="st">"B6"</span>, <span class="st">"B7"</span>)</span>
<span id="cb328-3"><a href="image.html#cb328-3"></a>image &lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Image</span>(<span class="st">"LANDSAT/LT05/C01/T1/LT05_044034_20080214"</span>)<span class="op">$</span></span>
<span id="cb328-4"><a href="image.html#cb328-4"></a><span class="st">  </span><span class="kw">select</span>(bands)</span>
<span id="cb328-5"><a href="image.html#cb328-5"></a><span class="op">&lt;</span><span class="er">&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="st"> </span>HEAD</span>
<span id="cb328-6"><a href="image.html#cb328-6"></a>Map<span class="op">$</span><span class="kw">setCenter</span>(<span class="op">-</span><span class="fl">122.1899</span>, <span class="fl">37.5010</span>, <span class="dv">10</span>)</span>
<span id="cb328-7"><a href="image.html#cb328-7"></a><span class="co">## San Francisco Bay</span></span>
<span id="cb328-8"><a href="image.html#cb328-8"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(image, <span class="kw">list</span>(<span class="dt">bands =</span> <span class="kw">c</span>(<span class="st">"B4"</span>, <span class="st">"B3"</span>, <span class="st">"B2"</span>), <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">128</span>), <span class="st">"image"</span>)</span>
<span id="cb328-9"><a href="image.html#cb328-9"></a><span class="op">==</span><span class="er">=====</span></span>
<span id="cb328-10"><a href="image.html#cb328-10"></a>Map<span class="op">$</span><span class="kw">setCenter</span>(<span class="op">-</span><span class="fl">122.1899</span>, <span class="fl">37.5010</span>, <span class="dv">10</span>); <span class="co">## San Francisco Bay</span></span>
<span id="cb328-11"><a href="image.html#cb328-11"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(image, <span class="kw">list</span>(bands&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'B4'</span>, <span class="st">'B3'</span>, <span class="st">'B2'</span>), min&lt;-<span class="st"> </span><span class="dv">0</span>, max&lt;-<span class="st"> </span><span class="dv">128</span>), <span class="st">'image'</span>)</span>
<span id="cb328-12"><a href="image.html#cb328-12"></a><span class="op">&gt;</span><span class="er">&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="st"> </span>master</span>
<span id="cb328-13"><a href="image.html#cb328-13"></a></span>
<span id="cb328-14"><a href="image.html#cb328-14"></a><span class="co"># Define spectral endmembers.</span></span>
<span id="cb328-15"><a href="image.html#cb328-15"></a>urban &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">88</span>, <span class="dv">42</span>, <span class="dv">48</span>, <span class="dv">38</span>, <span class="dv">86</span>, <span class="dv">115</span>, <span class="dv">59</span>)</span>
<span id="cb328-16"><a href="image.html#cb328-16"></a>veg &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">21</span>, <span class="dv">20</span>, <span class="dv">35</span>, <span class="dv">50</span>, <span class="dv">110</span>, <span class="dv">23</span>)</span>
<span id="cb328-17"><a href="image.html#cb328-17"></a>water &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">51</span>, <span class="dv">20</span>, <span class="dv">14</span>, <span class="dv">9</span>, <span class="dv">7</span>, <span class="dv">116</span>, <span class="dv">4</span>)</span>
<span id="cb328-18"><a href="image.html#cb328-18"></a></span>
<span id="cb328-19"><a href="image.html#cb328-19"></a><span class="co"># Unmix the image.</span></span>
<span id="cb328-20"><a href="image.html#cb328-20"></a>fractions &lt;-<span class="st"> </span>image<span class="op">$</span><span class="kw">unmix</span>(<span class="kw">c</span>(urban, veg, water))</span>
<span id="cb328-21"><a href="image.html#cb328-21"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(</span>
<span id="cb328-22"><a href="image.html#cb328-22"></a>  fractions,</span>
<span id="cb328-23"><a href="image.html#cb328-23"></a>  {},</span>
<span id="cb328-24"><a href="image.html#cb328-24"></a>  <span class="st">"unmixed"</span></span>
<span id="cb328-25"><a href="image.html#cb328-25"></a>)</span></code></pre></div>
<center>
<div class="figure">
<img src="../images/chapter_05/figure_12.png" width="670" alt=""><p class="caption">Figure 12. Landsat 5 imagery unmixed to urban (red), vegetation (green) and water (blue) fractions. San Francisco bay area, California, USA.</p>
</div>
</center>
</div>
</div>
<div id="texture" class="section level2 unnumbered">
<h2>Texture<a class="anchor" aria-label="anchor" href="#texture"><i class="fas fa-link"></i></a>
</h2>
<p>Earth Engine has several special methods for estimating spatial texture. When the image is discrete valued (not floating point), you can use <code>image$entropy()</code> to compute the <a href="http:#en.wikipedia.org/wiki/Entropy_(information_theory)">entropy</a> in a neighborhood:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="image.html#cb329-1"></a><span class="co"># Load a high-resolution NAIP image.</span></span>
<span id="cb329-2"><a href="image.html#cb329-2"></a>image &lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Image</span>(<span class="st">'USDA/NAIP/DOQQ/m_3712213_sw_10_1_20140613'</span>)</span>
<span id="cb329-3"><a href="image.html#cb329-3"></a></span>
<span id="cb329-4"><a href="image.html#cb329-4"></a><span class="co"># Zoom to San Francisco, display.</span></span>
<span id="cb329-5"><a href="image.html#cb329-5"></a>Map<span class="op">$</span><span class="kw">setCenter</span>(<span class="op">-</span><span class="fl">122.466123</span>, <span class="fl">37.769833</span>, <span class="dv">17</span>)</span>
<span id="cb329-6"><a href="image.html#cb329-6"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(image, <span class="kw">list</span>(<span class="dt">max =</span> <span class="dv">255</span>), <span class="st">'image'</span>)</span>
<span id="cb329-7"><a href="image.html#cb329-7"></a></span>
<span id="cb329-8"><a href="image.html#cb329-8"></a><span class="co"># Get the NIR band.</span></span>
<span id="cb329-9"><a href="image.html#cb329-9"></a>nir &lt;-<span class="st"> </span>image<span class="op">$</span><span class="kw">select</span>(<span class="st">'N'</span>)</span>
<span id="cb329-10"><a href="image.html#cb329-10"></a></span>
<span id="cb329-11"><a href="image.html#cb329-11"></a><span class="co"># Define a neighborhood with a kernel.</span></span>
<span id="cb329-12"><a href="image.html#cb329-12"></a>square &lt;-<span class="st"> </span>ee<span class="op">$</span>Kernel<span class="op">$</span><span class="kw">square</span>(radius&lt;-<span class="st"> </span><span class="dv">4</span>)</span>
<span id="cb329-13"><a href="image.html#cb329-13"></a></span>
<span id="cb329-14"><a href="image.html#cb329-14"></a><span class="co"># Compute entropy and display.</span></span>
<span id="cb329-15"><a href="image.html#cb329-15"></a>entropy &lt;-<span class="st"> </span>nir<span class="op">$</span><span class="kw">entropy</span>(square)</span>
<span id="cb329-16"><a href="image.html#cb329-16"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(entropy,</span>
<span id="cb329-17"><a href="image.html#cb329-17"></a><span class="op">&lt;</span><span class="er">&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="st"> </span>HEAD</span>
<span id="cb329-18"><a href="image.html#cb329-18"></a>             <span class="kw">list</span>(<span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">5</span>, <span class="dt">palette =</span> <span class="kw">c</span>(<span class="st">'0000CC'</span>, <span class="st">'CC0000'</span>)),</span>
<span id="cb329-19"><a href="image.html#cb329-19"></a><span class="op">==</span><span class="er">=====</span></span>
<span id="cb329-20"><a href="image.html#cb329-20"></a><span class="st">             </span><span class="kw">list</span>(min&lt;-<span class="st"> </span><span class="dv">1</span>, max&lt;-<span class="st"> </span><span class="dv">5</span>, palette&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'0000CC'</span>, <span class="st">'CC0000'</span>) ),</span>
<span id="cb329-21"><a href="image.html#cb329-21"></a><span class="op">&gt;</span><span class="er">&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="st"> </span>master</span>
<span id="cb329-22"><a href="image.html#cb329-22"></a>             <span class="st">'entropy'</span>)</span></code></pre></div>
<p>Note that the NIR band is scaled to 8-bits prior to calling <code>entropy()</code> since the entropy computation takes discrete valued inputs. The non-zero elements in the kernel specify the neighborhood.</p>
<p>Another way to measure texture is with a gray-level co-occurrence matrix (GLCM). Using the image and kernel from the previous example, compute the GLCM-based contrast as follows:</p>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compute the gray-level co-occurrence matrix (GLCM), get contrast.</span>
<span class="va">glcm</span> <span class="op">&lt;-</span> <span class="va">nir</span><span class="op">$</span><span class="fu">glcmTexture</span><span class="op">(</span><span class="va">size</span><span class="op">&lt;-</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">contrast</span> <span class="op">&lt;-</span> <span class="va">glcm</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'N_contrast'</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">contrast</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">min</span><span class="op">&lt;-</span> <span class="fl">0</span>, <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">1500</span>, <span class="va">palette</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'0000CC'</span>, <span class="st">'CC0000'</span><span class="op">)</span><span class="op">)</span>,
             <span class="st">'contrast'</span><span class="op">)</span></code></pre></div>
<p>Many measures of texture are output by <code>image$glcm()</code>. For a complete reference on the outputs, see <a href="https:#ieeexplore.ieee.org/document/4309314">Haralick et al. (1973)</a> and <a href="https:#www.sciencedirect.com/science/article/abs/pii/0734189X8490197X">Conners et al. (1984)</a>.</p>
<p>Local measures of spatial association such as Geary’s C (Anselin 1995) can be computed in Earth Engine using <code>image$neighborhoodToBands()</code>. Using the image from the previous example:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="image.html#cb331-1"></a><span class="co"># Create a list of weights for a 9x9 kernel.</span></span>
<span id="cb331-2"><a href="image.html#cb331-2"></a>row &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb331-3"><a href="image.html#cb331-3"></a><span class="co"># The center of the kernel is zero.</span></span>
<span id="cb331-4"><a href="image.html#cb331-4"></a>centerRow&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb331-5"><a href="image.html#cb331-5"></a><span class="co"># Assemble a list of lists: the 9x9 kernel weights as a 2-D matrix.</span></span>
<span id="cb331-6"><a href="image.html#cb331-6"></a>rows &lt;-<span class="st"> </span><span class="kw">c</span>(row, row, row, row, centerRow, row, row, row, row)</span>
<span id="cb331-7"><a href="image.html#cb331-7"></a><span class="co"># Create the kernel from the weights.</span></span>
<span id="cb331-8"><a href="image.html#cb331-8"></a><span class="co"># Non-zero weights represent the spatial neighborhood.</span></span>
<span id="cb331-9"><a href="image.html#cb331-9"></a>kernel &lt;-<span class="st"> </span>ee<span class="op">$</span>Kernel<span class="op">$</span><span class="kw">fixed</span>(<span class="dv">9</span>, <span class="dv">9</span>, rows, <span class="dv">-4</span>, <span class="dv">-4</span>, false)</span>
<span id="cb331-10"><a href="image.html#cb331-10"></a></span>
<span id="cb331-11"><a href="image.html#cb331-11"></a><span class="co"># Convert the neighborhood into multiple bands.</span></span>
<span id="cb331-12"><a href="image.html#cb331-12"></a>neighs &lt;-<span class="st"> </span>nir<span class="op">$</span><span class="kw">neighborhoodToBands</span>(kernel)</span>
<span id="cb331-13"><a href="image.html#cb331-13"></a></span>
<span id="cb331-14"><a href="image.html#cb331-14"></a><span class="co"># Compute local Geary's C, a measure of spatial association.</span></span>
<span id="cb331-15"><a href="image.html#cb331-15"></a>gearys &lt;-<span class="st"> </span>nir<span class="op">$</span><span class="kw">subtract</span>(neighs)<span class="op">$</span><span class="kw">pow</span>(<span class="dv">2</span>)<span class="op">$</span><span class="kw">reduce</span>(ee<span class="op">$</span>Reducer<span class="op">$</span><span class="kw">sum</span>())</span>
<span id="cb331-16"><a href="image.html#cb331-16"></a>             <span class="op">$</span><span class="kw">divide</span>(Math<span class="op">$</span><span class="kw">pow</span>(<span class="dv">9</span>, <span class="dv">2</span>))</span>
<span id="cb331-17"><a href="image.html#cb331-17"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(gearys,</span>
<span id="cb331-18"><a href="image.html#cb331-18"></a>             <span class="kw">list</span>(min&lt;-<span class="st"> </span><span class="dv">20</span>, max&lt;-<span class="st"> </span><span class="dv">2500</span>, palette&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'0000CC'</span>, <span class="st">'CC0000'</span>)),</span>
<span id="cb331-19"><a href="image.html#cb331-19"></a>             <span class="st">"Geary's C"</span>)</span></code></pre></div>
<p>For an example of using neighborhood standard deviation to compute image texture, see the <a href="">Statistics of Image Neighborhoods page</a>.</p>
</div>
<div id="object-based-methods" class="section level2 unnumbered">
<h2>Object-based methods<a class="anchor" aria-label="anchor" href="#object-based-methods"><i class="fas fa-link"></i></a>
</h2>
<p>Image objects are sets of connected pixels having the same integer value. Categorical, binned, and boolean image data are suitable for object analysis.</p>
<p>Earth Engine offers methods for labeling each object with a unique ID, counting the number of pixels composing objects, and computing statistics for values of pixels that intersect objects.</p>
<ul>
<li>
<code>connectedComponents()</code>: label each object with a unique identifier.</li>
<li>
<code>connectedPixelCount()</code>: compute the number of pixels in each object.</li>
<li>
<code>reduceConnectedComponents()</code>: compute a statistic for pixels in each object.</li>
</ul>
<p><strong>Caution</strong>: results of object-based methods depend on scale, which is determined by:</p>
<ul>
<li>the requested scale of an output (e.g., <code>Export.image.toAsset()</code> or <code>Export.image.toDrive()</code>).</li>
<li>functions that require a scale of analysis (e.g., <code>reduceRegions()</code> or <code>reduceToVectors()</code>).</li>
<li>Map zoom level.</li>
</ul>
<p>Take special note of scale determined by Map zoom level. Results of object-based methods will vary when viewing or inspecting image layers in the Map, as each pyramid layer has a different scale. To force a desired scale of analysis in Map exploration, use <code>reproject()</code>. However, it is strongly recommended that you <code>NOT</code> use <code>reproject()</code> because the entire area visible in the Map will be requested at the set scale and projection. At large extents this can cause too much data to be requested, often triggering errors. Within the image pyramid-based architecture of Earth Engine, scale and projection need only be set for operations that provide scale and crs as parameters. See <a href="">Scale of Analysis</a> and <a href="">Reprojecting</a> for more information.</p>
<div id="thermal-hotspots" class="section level3 unnumbered">
<h3>Thermal hotspots<a class="anchor" aria-label="anchor" href="#thermal-hotspots"><i class="fas fa-link"></i></a>
</h3>
<p>The following sections provide examples of object-based methods applied to Landsat 8 surface temperature with each section building on the former. Run the next snippet to generate the base image: thermal hotspots (&gt; 303 degrees Kelvin) for a small region of San Francisco.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="image.html#cb332-1"></a><span class="co"># Make an area of interest geometry centered on San Francisco.</span></span>
<span id="cb332-2"><a href="image.html#cb332-2"></a>point &lt;-<span class="st"> </span>ee<span class="op">$</span>Geometry<span class="op">$</span><span class="kw">Point</span>(<span class="op">-</span><span class="fl">122.1899</span>, <span class="fl">37.5010</span>)</span>
<span id="cb332-3"><a href="image.html#cb332-3"></a>aoi &lt;-<span class="st"> </span>point<span class="op">$</span><span class="kw">buffer</span>(<span class="dv">10000</span>)</span>
<span id="cb332-4"><a href="image.html#cb332-4"></a></span>
<span id="cb332-5"><a href="image.html#cb332-5"></a><span class="co"># Import a Landsat 8 image, subset the thermal band, and clip to the</span></span>
<span id="cb332-6"><a href="image.html#cb332-6"></a><span class="co"># area of interest.</span></span>
<span id="cb332-7"><a href="image.html#cb332-7"></a><span class="op">&lt;</span><span class="er">&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="st"> </span>HEAD</span>
<span id="cb332-8"><a href="image.html#cb332-8"></a>kelvin &lt;-<span class="st"> </span>ee<span class="op">$</span><span class="kw">Image</span>(<span class="st">"LANDSAT/LC08/C01/T1_TOA/LC08_044034_20140318"</span>)<span class="op">$</span></span>
<span id="cb332-9"><a href="image.html#cb332-9"></a><span class="st">  </span><span class="kw">select</span>(<span class="st">"B10"</span>, <span class="st">"kelvin"</span>)<span class="op">$</span></span>
<span id="cb332-10"><a href="image.html#cb332-10"></a><span class="st">  </span><span class="kw">clip</span>(aoi)</span>
<span id="cb332-11"><a href="image.html#cb332-11"></a></span>
<span id="cb332-12"><a href="image.html#cb332-12"></a><span class="co"># Display the thermal band.</span></span>
<span id="cb332-13"><a href="image.html#cb332-13"></a>Map<span class="op">$</span><span class="kw">centerObject</span>(point, <span class="dv">13</span>)</span>
<span id="cb332-14"><a href="image.html#cb332-14"></a>Map.<span class="op">$</span><span class="kw">addLayer</span>(kelvin, <span class="kw">list</span>(<span class="dt">min =</span> <span class="dv">288</span>, <span class="dt">max =</span> <span class="dv">305</span>), <span class="st">"Kelvin"</span>)</span>
<span id="cb332-15"><a href="image.html#cb332-15"></a><span class="op">==</span><span class="er">=====</span></span>
<span id="cb332-16"><a href="image.html#cb332-16"></a>kelvin&lt;-<span class="st"> </span><span class="kw">ee.Image</span>(<span class="st">'LANDSAT/LC08/C01/T1_TOA/LC08_044034_20140318'</span>)</span>
<span id="cb332-17"><a href="image.html#cb332-17"></a>  <span class="kw">.select</span>([<span class="st">'B10'</span>], [<span class="st">'kelvin'</span>])</span>
<span id="cb332-18"><a href="image.html#cb332-18"></a>  <span class="kw">.clip</span>(aoi)</span>
<span id="cb332-19"><a href="image.html#cb332-19"></a></span>
<span id="cb332-20"><a href="image.html#cb332-20"></a><span class="co"># Display the thermal band.</span></span>
<span id="cb332-21"><a href="image.html#cb332-21"></a>Map<span class="op">$</span><span class="kw">centerObject</span>(point, <span class="dv">13</span>);</span>
<span id="cb332-22"><a href="image.html#cb332-22"></a>Map.<span class="op">$</span><span class="kw">addLayer</span>(kelvin, <span class="kw">list</span>(min&lt;-<span class="st"> </span><span class="dv">288</span>, max&lt;-<span class="st"> </span><span class="dv">305</span>), <span class="st">'Kelvin'</span>)</span>
<span id="cb332-23"><a href="image.html#cb332-23"></a><span class="op">&gt;</span><span class="er">&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="st"> </span>master</span>
<span id="cb332-24"><a href="image.html#cb332-24"></a></span>
<span id="cb332-25"><a href="image.html#cb332-25"></a><span class="co"># Threshold the thermal band to set hot pixels as value 1, mask all else.</span></span>
<span id="cb332-26"><a href="image.html#cb332-26"></a>hotspots &lt;-<span class="st"> </span>kelvin<span class="op">$</span><span class="kw">gt</span>(<span class="dv">303</span>)<span class="op">$</span></span>
<span id="cb332-27"><a href="image.html#cb332-27"></a><span class="st">  </span><span class="kw">selfMask</span>()<span class="op">$</span></span>
<span id="cb332-28"><a href="image.html#cb332-28"></a><span class="st">  </span><span class="kw">rename</span>(<span class="st">"hotspots"</span>)</span>
<span id="cb332-29"><a href="image.html#cb332-29"></a></span>
<span id="cb332-30"><a href="image.html#cb332-30"></a><span class="co"># Display the thermal hotspots on the Map.</span></span>
<span id="cb332-31"><a href="image.html#cb332-31"></a><span class="op">&lt;</span><span class="er">&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="st"> </span>HEAD</span>
<span id="cb332-32"><a href="image.html#cb332-32"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(hotspots, <span class="kw">list</span>(<span class="dt">palette =</span> <span class="st">"FF0000"</span>), <span class="st">"Hotspots"</span>)</span>
<span id="cb332-33"><a href="image.html#cb332-33"></a><span class="op">==</span><span class="er">=====</span></span>
<span id="cb332-34"><a href="image.html#cb332-34"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(hotspots, <span class="kw">list</span>(palette&lt;-<span class="st"> 'FF0000'</span>), <span class="st">'Hotspots'</span>)</span>
<span id="cb332-35"><a href="image.html#cb332-35"></a><span class="op">&gt;</span><span class="er">&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="st"> </span>master</span></code></pre></div>
<center>
<div class="figure">
<img src="../images/chapter_05/figure_13.png" width="670" alt=""><p class="caption">Figure 13. Temperature for a region of San Francisco. Pixels with temperature greater than 303 degrees Kelvin are distinguished by the color red (thermal hotspots).</p>
</div>
</center>
</div>
<div id="label-objects" class="section level3 unnumbered">
<h3>Label objects<a class="anchor" aria-label="anchor" href="#label-objects"><i class="fas fa-link"></i></a>
</h3>
<p>Labeling objects is often the first step in object analysis. Here, the <code>connectedComponents()</code> function is used to identify image objects and assign a unique ID to each; all pixels belonging to an object are assigned the same integer ID value. The result is a copy of the input image with an additional “labels” band associating pixels with an object ID value based on connectivity of pixels in the first band of the image.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="image.html#cb333-1"></a><span class="co"># Uniquely label the hotspot image objects.</span></span>
<span id="cb333-2"><a href="image.html#cb333-2"></a>objectId &lt;-<span class="st"> </span>hotspots<span class="op">$</span><span class="kw">connectedComponents</span>(<span class="kw">list</span>(</span>
<span id="cb333-3"><a href="image.html#cb333-3"></a><span class="op">&lt;</span><span class="er">&lt;&lt;&lt;&lt;&lt;&lt;</span><span class="st"> </span>HEAD</span>
<span id="cb333-4"><a href="image.html#cb333-4"></a>  <span class="dt">connectedness =</span> ee<span class="op">$</span>Kernel<span class="op">$</span><span class="kw">plus</span>(<span class="dv">1</span>),</span>
<span id="cb333-5"><a href="image.html#cb333-5"></a>  <span class="dt">maxSize =</span> <span class="dv">128</span></span>
<span id="cb333-6"><a href="image.html#cb333-6"></a>))</span>
<span id="cb333-7"><a href="image.html#cb333-7"></a><span class="op">==</span><span class="er">=====</span></span>
<span id="cb333-8"><a href="image.html#cb333-8"></a><span class="st">  </span>connectedness&lt;-<span class="st"> </span><span class="kw">ee.Kernel.plus</span>(<span class="dv">1</span>),</span>
<span id="cb333-9"><a href="image.html#cb333-9"></a>  maxSize&lt;-<span class="st"> </span><span class="dv">128</span><span class="er">)</span></span>
<span id="cb333-10"><a href="image.html#cb333-10"></a>  <span class="er">)</span></span>
<span id="cb333-11"><a href="image.html#cb333-11"></a><span class="op">&gt;</span><span class="er">&gt;&gt;&gt;&gt;&gt;&gt;</span><span class="st"> </span>master</span>
<span id="cb333-12"><a href="image.html#cb333-12"></a></span>
<span id="cb333-13"><a href="image.html#cb333-13"></a><span class="co"># Display the uniquely ID'ed objects to the Map.</span></span>
<span id="cb333-14"><a href="image.html#cb333-14"></a>Map<span class="op">$</span><span class="kw">addLayer</span>(objectId<span class="op">$</span><span class="kw">randomVisualizer</span>(), null, <span class="st">"Objects"</span>)</span></code></pre></div>
Note that the maximum patch size is set to 128 pixels; objects composed of more pixels are masked. The connectivity is specified by an <code>ee$Kernel$plus(1)</code> kernel, which defines four-neighbor connectivity; use <code>ee$Kernel$square(1)</code> for eight-neighbor.
<center>
<div class="figure">
<img src="../images/chapter_05/figure_14.png" width="670" alt=""><p class="caption">Figure 14. Thermal hotspot objects labeled and styled by a unique ID.</p>
</div>
</center>
</div>
<div id="object-size" class="section level3 unnumbered">
<h3>Object size<a class="anchor" aria-label="anchor" href="#object-size"><i class="fas fa-link"></i></a>
</h3>
<div id="number-of-pixels" class="section level4 unnumbered">
<h4>Number of pixels<a class="anchor" aria-label="anchor" href="#number-of-pixels"><i class="fas fa-link"></i></a>
</h4>
<p>Calculate the number of pixels composing objects using the <code>connectedPixelCount()</code> image method. Knowing the number of pixels in an object can be helpful for masking objects by size and calculating object area. The following snippet applies <code>connectedPixelCount()</code> to the “labels” band of the <code>objectId</code> image defined in the previous section.</p>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compute the number of pixels in each object defined by the "labels" band.</span>
<span class="va">objectSize</span> <span class="op">&lt;-</span> <span class="va">objectId</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'labels'</span><span class="op">)</span><span class="op">$</span>
  <span class="fu">connectedPixelCount</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
     <span class="va">maxSize</span><span class="op">&lt;-</span> <span class="fl">128</span>, <span class="va">eightConnected</span><span class="op">&lt;-</span> <span class="va">false</span><span class="op">)</span>
     <span class="op">)</span>

<span class="co"># Display object pixel count to the Map.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">objectSize</span>, <span class="va">null</span>, <span class="st">'Object n pixels'</span><span class="op">)</span>;</code></pre></div>
<code>connectedPixelCount()</code> returns a copy of the input image where each pixel of each band contains the number of connected neighbors according to either the four- or eight-neighbor connectivity rule determined by a boolean argument passed to the <code>eightConnected</code> parameter. Note that connectivity is determined independently for each band of the input image. In this example, a single-band image (<code>objectId</code>) representing object ID was provided as input, so a single-band image was returned with a “labels” band (present as such in the input image), but now the values represent the number of pixels composing objects; every pixel of each object will have the same pixel count value.
<center>
<div class="figure">
<img src="../images/chapter_05/figure_15.png" width="670" alt=""><p class="caption">Figure 15. Thermal hotspot objects labeled and styled by a unique ID.</p>
</div>
</center>
</div>
<div id="area" class="section level4 unnumbered">
<h4>Area<a class="anchor" aria-label="anchor" href="#area"><i class="fas fa-link"></i></a>
</h4>
<p>Calculate object area by multiplying the area of a single pixel by the number of pixels composing an object (determined by <code>connectedPixelCount()</code>). Pixel area is provided by an image generated from <code>ee$Image$pixelArea()</code>.</p>
<div class="sourceCode" id="cb335"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get a pixel area image.</span>
<span class="va">pixelArea</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Image</span><span class="op">$</span><span class="fu">pixelArea</span><span class="op">(</span><span class="op">)</span>

<span class="co"># Multiply pixel area by the number of pixels in an object to calculate</span>
<span class="co"># the object area. The result is an image where each pixel</span>
<span class="co"># of an object relates the area of the object in m^2.</span>
<span class="va">objectArea</span> <span class="op">&lt;-</span> <span class="va">objectSize</span><span class="op">$</span><span class="fu">multiply</span><span class="op">(</span><span class="va">pixelArea</span><span class="op">)</span>

<span class="co"># Display object area to the Map.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">objectArea</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">min</span><span class="op">&lt;-</span> <span class="fl">0</span>, <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">30000</span>, <span class="va">palette</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'0000FF'</span>, <span class="st">'FF00FF'</span><span class="op">)</span><span class="op">)</span>,
             <span class="st">'Object area m^2'</span><span class="op">)</span></code></pre></div>
<p>The result is an image where each pixel of an object relates the area of the object in square meters. In this example, the <code>objectSize</code> image contains a single band, if it were multi-band, the multiplication operation would be applied to each band of the image.</p>
</div>
</div>
<div id="filter-objects-by-size" class="section level3 unnumbered">
<h3>Filter objects by size<a class="anchor" aria-label="anchor" href="#filter-objects-by-size"><i class="fas fa-link"></i></a>
</h3>
<p>Object size can be used as a mask condition to focus your analysis on objects of a certain size (e.g., mask out objects that are too small). Here the <code>objectArea</code> image calculated in the previous step is used as a mask to remove objects whose area are less than one hectare.</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Threshold the `objectArea` image to define a mask that will mask out</span>
<span class="co"># objects below a given size (1 hectare in this case).</span>
<span class="va">areaMask</span> <span class="op">&lt;-</span> <span class="va">objectArea</span><span class="op">$</span><span class="fu">gte</span><span class="op">(</span><span class="fl">10000</span><span class="op">)</span>

<span class="co"># Update the mask of the `objectId` layer defined previously using the</span>
<span class="co"># minimum area mask just defined.</span>
<span class="va">objectId</span> <span class="op">&lt;-</span> <span class="va">objectId</span><span class="op">$</span><span class="fu">updateMask</span><span class="op">(</span><span class="va">areaMask</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">objectId</span>, <span class="va">null</span>, <span class="st">'Large hotspots'</span><span class="op">)</span></code></pre></div>
<p>The result is a copy of the <code>objectId</code> image where objects less than one hectare are masked out.</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th align="center">Figure 16a. Thermal hotspot objects labeled and styled by unique ID.</th>
<th align="center">Figure 16b. Thermal hotspot objects filtered by minimum area (1 hectare).</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="../images/chapter_05/figure_16a.png" width="300"></td>
<td align="center"><img src="../images/chapter_05/figure_16b.png" width="300"></td>
</tr></tbody>
</table></div>
</div>
<div id="zonal-statistics" class="section level3 unnumbered">
<h3>Zonal statistics<a class="anchor" aria-label="anchor" href="#zonal-statistics"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>reduceConnectedComponents()</code> method applies a reducer to the pixels composing unique objects. The following snippet uses it to calculate the mean temperature of hotspot objects. <code>reduceConnectedComponents()</code> requires an input image with a band (or bands) to be reduced and a band that defines object labels. Here, the <code>objectID</code> “labels” image band is added to the <code>kelvin</code> temperature image to construct a suitable input image.</p>
<div class="sourceCode" id="cb337"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make a suitable image for `reduceConnectedComponents()` by adding a label</span>
<span class="co"># band to the `kelvin` temperature image.</span>
<span class="va">kelvin</span> <span class="op">&lt;-</span> <span class="va">kelvin</span><span class="op">$</span><span class="fu">addBands</span><span class="op">(</span><span class="va">objectId</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'labels'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Calculate the mean temperature per object defined by the previously added</span>
<span class="co"># "labels" band.</span>
<span class="va">patchTemp</span> <span class="op">&lt;-</span> <span class="va">kelvin</span><span class="op">$</span><span class="fu">reduceConnectedComponents</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">reducer</span><span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Reducer</span><span class="op">$</span><span class="fu">mean</span><span class="op">(</span><span class="op">)</span>,
  <span class="va">labelBand</span><span class="op">&lt;-</span> <span class="st">'labels'</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Display object mean temperature to the Map.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span>
  <span class="va">patchTemp</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="va">min</span><span class="op">&lt;-</span> <span class="fl">303</span>, <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">304</span>, <span class="va">palette</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'yellow'</span>, <span class="st">'red'</span><span class="op">)</span><span class="op">)</span>,
  <span class="st">'Mean temperature'</span>
<span class="op">)</span></code></pre></div>
The result is a copy of the input image without the band used to define objects, where pixel values represent the result of the reduction per object, per band.
<center>
<div class="figure">
<img src="../images/chapter_05/figure_17.png" width="670" alt=""><p class="caption">Figure 17. Thermal hotspot object pixels summarized and styled by mean temperature.</p>
</div>
</center>
<ul>
<li>
<strong>Note</strong>: <code>reduceToVectors()</code> provides similar functionality, except that the result is an <code>ee$FeatureCollection</code>, where each feature of the collection represents an object and the reduction of the pixels in each objects is expressed as a feature property for each band in the input image. <code>reduceToVectors()</code> is resource intensive, so use <code>reduceConnectedComponents()</code> whenever possible. See Raster to Vector Conversion for more information.</li>
</ul>
</div>
</div>
<div id="cumulative-cost-mapping" class="section level2 unnumbered">
<h2>Cumulative Cost Mapping<a class="anchor" aria-label="anchor" href="#cumulative-cost-mapping"><i class="fas fa-link"></i></a>
</h2>
<p>Use <code>image$cumulativeCost()</code> to compute a cost map where every pixel contains the total cost of the lowest cost path to the nearest source location. This process is useful in a variety of contexts such as habitat analysis (<a href="http:#www.sciencedirect.com/science/article/pii/S0169204602002426">Adriaensen et al. 2003</a>), watershed delineation (<a href="https:#www.sciencedirect.com/science/article/pii/S1878029611001691">Melles et al. 2011</a>) and image segmentation (<a href="http:#ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=1261076">Falcao et al. 2004</a>). Call the cumulative cost function on an image in which each pixel represents the cost per meter to traverse it. Paths are computed through any of a pixel’s eight neighbors. Required inputs include a <code>source</code> image, in which each non-zero pixel represents a potential source (or start of a path), and a <code>maxDistance</code> (in meters) over which to compute paths. The algorithm finds the cumulative cost of all paths less than <em>maxPixels</em>&lt;- <code>maxDistance</code>/<em>scale</em> in length, where scale is the pixel resolution, or <a href="">scale of analysis in Earth Engine</a>.</p>
<p>The following example demonstrates computing least-cost paths across a land cover image:</p>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A rectangle representing Bangui, Central African Republic.</span>
<span class="va">geometry</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="va">Geometry</span><span class="op">$</span><span class="fu">Rectangle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">18.5229</span>, <span class="fl">4.3491</span>, <span class="fl">18.5833</span>, <span class="fl">4.4066</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Create a source image where the geometry is 1, everything else is 0.</span>
<span class="va">sources</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">toByte</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">paint</span><span class="op">(</span><span class="va">geometry</span>, <span class="fl">1</span><span class="op">)</span>

<span class="co"># Mask the sources image with itself.</span>
<span class="va">sources</span> <span class="op">&lt;-</span> <span class="va">sources</span><span class="op">$</span><span class="fu">selfMask</span><span class="op">(</span><span class="op">)</span>

<span class="co"># The cost data is generated from classes in ESA/GLOBCOVER.</span>
<span class="va">cover</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">'ESA/GLOBCOVER_L4_200901_200912_V2_3'</span><span class="op">)</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>

<span class="co"># Classes 60, 80, 110, 140 have cost 1.</span>
<span class="co"># Classes 40, 90, 120, 130, 170 have cost 2.</span>
<span class="co"># Classes 50, 70, 150, 160 have cost 3.</span>
<span class="va">beforeRemap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">80</span>, <span class="fl">110</span>, <span class="fl">140</span>,
                <span class="fl">40</span>, <span class="fl">90</span>, <span class="fl">120</span>, <span class="fl">130</span>, <span class="fl">170</span>,
                <span class="fl">50</span>, <span class="fl">70</span>, <span class="fl">150</span>, <span class="fl">160</span><span class="op">)</span>
<span class="va">afterRemap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,
                <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>,
                <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>
<span class="va">cost</span> <span class="op">&lt;-</span> <span class="va">cover</span><span class="op">$</span><span class="fu">remap</span><span class="op">(</span><span class="va">beforeRemap</span>, <span class="va">afterRemap</span>, <span class="fl">0</span><span class="op">)</span>

<span class="co"># Compute the cumulative cost to traverse the land cover.</span>
<span class="va">cumulativeCost</span> <span class="op">&lt;-</span> <span class="va">cost</span><span class="op">$</span><span class="fu">cumulativeCost</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">source</span><span class="op">&lt;-</span> <span class="va">sources</span>,
  <span class="va">maxDistance</span><span class="op">&lt;-</span> <span class="fl">80</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span>  <span class="co">## 80 kilometers</span>
  <span class="op">)</span>

<span class="co"># Display the results</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">setCenter</span><span class="op">(</span><span class="fl">18.71</span>, <span class="fl">4.2</span>, <span class="fl">9</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">cover</span>, <span class="op">{</span><span class="op">}</span>, <span class="st">'Globcover'</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">cumulativeCost</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">min</span><span class="op">&lt;-</span> <span class="fl">0</span>, <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">5e4</span><span class="op">)</span>, <span class="st">'accumulated cost'</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">geometry</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">color</span><span class="op">&lt;-</span> <span class="st">'FF0000'</span><span class="op">)</span>, <span class="st">'source geometry'</span><span class="op">)</span></code></pre></div>
The result should look something like Figure 18, in which each output pixel represents the accumulated cost to the nearest source. Note that discontinuities can appear in places where the least cost path to the nearest source exceeds <em>maxPixels</em> in length.
<center>
<div class="figure">
<img src="../images/chapter_05/figure_18.png" width="660" alt=""><p class="caption">Figure 18. The cumulative cost to the source pixels, where cost is determined by the land cover categories. Low costs are black, higher costs are white.</p>
</div>
</center>
</div>
<div id="registering-images" class="section level2 unnumbered">
<h2>Registering Images<a class="anchor" aria-label="anchor" href="#registering-images"><i class="fas fa-link"></i></a>
</h2>
<p>The Earth Engine image registration algorithm is designed to be a final, post-ortho, fine-grained step in aligning images. It is assumed that the images to be registered have already gone through initial alignment stages, so they are already within a few degrees of rotation of one another, and differ by only small translations. The registration uses a “rubber-sheet” technique, allowing local image warping to correct for orthorectification errors and other artifacts from earlier processing. The underlying alignment technique is image correlation, so the bands for the input and reference images must be visually similar in order for the algorithm to compute an accurate alignment.</p>
<div id="image-displacement" class="section level3 unnumbered">
<h3>Image displacement<a class="anchor" aria-label="anchor" href="#image-displacement"><i class="fas fa-link"></i></a>
</h3>
<p>There are two steps to registering an image: Determining the displacement image using <code>displacement()</code>, and then applying it with <code>displace()</code>. The required inputs are the pair of images to register, and a maximum displacement parameter (<code>maxOffset</code>).</p>
<p>The <code>displacement()</code> algorithm takes a reference image, a maximum displacement parameter (<code>maxOffset</code>), and two optional parameters that modify the algorithm behaviour. The output is a displacement image with bands dx and dy which give the X and Y components (in meters) of the displacement vector at each pixel.</p>
<p>All bands of the calling and reference images are used for matching during registration, so the number of bands must be exactly equal. The input bands must be visually similar for registration to succeed. If that is not the case, it may be possible to pre-process them (e.g. smoothing, edge detection) to make them appear more similar. The registration computations are performed using a multiscale, coarse-to-fine process, with (multiscale) working projections that depend on three of the projections supplied to the algorithm:</p>
<ol style="list-style-type: decimal">
<li>the default projection of the calling image (Pc)</li>
<li>the default projection of the reference image (Pr)</li>
<li>the output projection (Po)</li>
</ol>
<p>The highest resolution working projection (Pw will be in the CRS of Pr, at a scale determined by the coarsest resolution of these 3 projections, to minimize computation. The results from Pr are then resampled to be in the projection specified by the input ‘projection’ parameter.</p>
<p>The output is a displacement image with the following bands:</p>
<p><code>dx</code>
- For a given reference image pixel location, this band contains the distance in the X direction that must be travelled to arrive at the matching location in the calling image. Units are in geodesic meters.</p>
<p><code>dy</code>
- For a given reference image pixel location, this band contains the distance in the Y direction that must be travelled to arrive at the matching location in the calling image. Units are in geodesic meters.</p>
<p><code>confidence</code>
- This is a per-pixel estimate of displacement confidence (where 0 is low confidence and 1 is high confidence) based on the correlation scores in regions where valid matches were found. In regions where no matches were found, confidence is estimated from nearby correlations using a Gaussian kernel to provide higher weight to nearby correlations.</p>
<p>The following example computes the magnitude and angle of displacement between two high-resolution <a href="">Terra Bella</a> images:</p>
<div class="sourceCode" id="cb339"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load the two images to be registered.</span>
<span class="va">image1</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">'SKYSAT/GEN-A/PUBLIC/ORTHO/MULTISPECTRAL/s01_20150502T082736Z'</span><span class="op">)</span>
<span class="va">image2</span> <span class="op">&lt;-</span> <span class="va">ee</span><span class="op">$</span><span class="fu">Image</span><span class="op">(</span><span class="st">'SKYSAT/GEN-A/PUBLIC/ORTHO/MULTISPECTRAL/s01_20150305T081019Z'</span><span class="op">)</span>

<span class="co"># Use bicubic resampling during registration.</span>
<span class="va">image1Orig</span> <span class="op">&lt;-</span> <span class="va">image1</span><span class="op">$</span><span class="fu">resample</span><span class="op">(</span><span class="st">'bicubic'</span><span class="op">)</span>
<span class="va">image2Orig</span> <span class="op">&lt;-</span> <span class="va">image2</span><span class="op">$</span><span class="fu">resample</span><span class="op">(</span><span class="st">'bicubic'</span><span class="op">)</span>

<span class="co"># Choose to register using only the 'R' band.</span>
<span class="va">image1RedBand</span> <span class="op">&lt;-</span> <span class="va">image1Orig</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'R'</span><span class="op">)</span>
<span class="va">image2RedBand</span> <span class="op">&lt;-</span> <span class="va">image2Orig</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'R'</span><span class="op">)</span>

<span class="co"># Determine the displacement by matching only the 'R' bands.</span>
<span class="va">displacement</span> <span class="op">&lt;-</span> <span class="fu">image2RedBand.displacement</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">referenceImage</span><span class="op">&lt;-</span> <span class="va">image1RedBand</span>,
  <span class="va">maxOffset</span><span class="op">&lt;-</span> <span class="fl">50.0</span>,
  <span class="va">patchWidth</span><span class="op">&lt;-</span> <span class="fl">100.0</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Compute image offset and direction.</span>
<span class="va">offset</span> <span class="op">&lt;-</span> <span class="va">displacement</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'dx'</span><span class="op">)</span><span class="op">$</span><span class="fu">hypot</span><span class="op">(</span><span class="va">displacement</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'dy'</span><span class="op">)</span><span class="op">)</span>
<span class="va">angle</span> <span class="op">&lt;-</span> <span class="va">displacement</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'dx'</span><span class="op">)</span><span class="op">$</span><span class="fu">atan2</span><span class="op">(</span><span class="va">displacement</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">'dy'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Display offset distance and angle.</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">offset</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">min</span><span class="op">&lt;-</span> <span class="fl">0</span>, <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">20</span><span class="op">)</span>, <span class="st">'offset'</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">angle</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">min</span><span class="op">&lt;-</span> <span class="op">-</span><span class="va">Math.PI</span>, <span class="va">max</span><span class="op">&lt;-</span> <span class="va">Math.PI</span><span class="op">)</span>, <span class="st">'angle'</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">setCenter</span><span class="op">(</span><span class="fl">37.44</span>,<span class="fl">0.58</span>, <span class="fl">15</span><span class="op">)</span></code></pre></div>
</div>
<div id="warping-an-image" class="section level3 unnumbered">
<h3>Warping an image<a class="anchor" aria-label="anchor" href="#warping-an-image"><i class="fas fa-link"></i></a>
</h3>
<p>There are two ways to warp an image to match another image: <code>displace()</code> or <code>register()</code>. The <code>displace()</code> algorithm takes a displacement image having <code>dx</code> and <code>dy</code> bands as the first two bands, and warps the image accordingly. The output image will be the result of warping the bands of the input image by the offsets present in the displacement image. Using the displacements computed in the previous example:</p>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use the computed displacement to register all original bands.</span>
<span class="va">registered</span> <span class="op">&lt;-</span> <span class="va">image2Orig</span><span class="op">$</span><span class="fu">displace</span><span class="op">(</span><span class="va">displacement</span><span class="op">)</span>

<span class="co"># Show the results of co-registering the images.</span>
<span class="va">visParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">bands</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'R'</span>, <span class="st">'G'</span>, <span class="st">'B'</span><span class="op">)</span>, <span class="va">max</span><span class="op">&lt;-</span> <span class="fl">4000</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">image1Orig</span>, <span class="va">visParams</span>, <span class="st">'Reference'</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">image2Orig</span>, <span class="va">visParams</span>, <span class="st">'Before Registration'</span><span class="op">)</span>
<span class="va">Map</span><span class="op">$</span><span class="fu">addLayer</span><span class="op">(</span><span class="va">registered</span>, <span class="va">visParams</span>, <span class="st">'After Registration'</span><span class="op">)</span></code></pre></div>
<p>If you don’t need the displacement bands, Earth Engine provides the <code>register()</code> method, which is a shortcut for calling <code>displacement()</code> followed by <code>displace()</code>. For example:</p>
<div class="sourceCode" id="cb341"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alsoRegistered</span> <span class="op">&lt;-</span> <span class="va">image2Orig</span><span class="op">$</span><span class="fu">register</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">referenceImage</span><span class="op">&lt;-</span> <span class="va">image1Orig</span>,
  <span class="va">maxOffset</span><span class="op">&lt;-</span> <span class="fl">50.0</span>,
  <span class="va">patchWidth</span><span class="op">&lt;-</span> <span class="fl">100.0</span><span class="op">)</span>
  <span class="op">)</span>
<span class="fu">Map.addLayer</span><span class="op">(</span><span class="va">alsoRegistered</span>, <span class="va">visParams</span>, <span class="st">'Also Registered'</span><span class="op">)</span></code></pre></div>
<p>In this example, the results of <code>register()</code> differ from the results of <code>displace()</code>. This is because a different set of bands was used in the two approaches: <code>register()</code> always uses all bands of the input images, while the <code>displacement()</code> example used only the red band before feeding the result to <code>displace()</code>. Note that when multiple bands are used, if band variances are very different this could over-weight the high-variance bands, since the bands are jointly normalized when their spatial correlation scores are combined. This illustrates the importance of selecting band(s) that are visually the most similar when registering. As in the previous example, use <code>displacement()</code> and <code>displace()</code> for control over which bands are used to compute displacement.</p>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="objects-and-methods-overview.html">Objects and Methods Overview</a></div>
<div class="next"><a href="imagecollection.html">ImageCollection</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#image">Image</a></li>
<li>
<a class="nav-link" href="#image-overview">Image Overview</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#eeimage-constructor">ee$Image constructor</a></li>
<li><a class="nav-link" href="#get-an-eeimage-from-an-eeimagecollection">Get an ee$Image from an ee$ImageCollection</a></li>
<li><a class="nav-link" href="#images-from-cloud-geotiffs">Images from Cloud GeoTIFFs</a></li>
<li><a class="nav-link" href="#constant-images">Constant images</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#image-visualization">Image Visualization</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#rgb-composites-1">RGB composites</a></li>
<li><a class="nav-link" href="#color-palettes-1">Color palettes</a></li>
<li><a class="nav-link" href="#masking-4">Masking</a></li>
<li><a class="nav-link" href="#visualization-images-1">Visualization images</a></li>
<li><a class="nav-link" href="#mosaicking-2">Mosaicking</a></li>
<li><a class="nav-link" href="#clipping">Clipping</a></li>
<li><a class="nav-link" href="#rendering-categorical-maps">Rendering categorical maps</a></li>
<li><a class="nav-link" href="#styled-layer-descriptors">Styled Layer Descriptors</a></li>
<li><a class="nav-link" href="#thumbnail-images">Thumbnail images</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#image-information-and-metadata">Image Information and Metadata</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#getting-metadata">Getting metadata</a></li></ul>
</li>
<li>
<a class="nav-link" href="#mathematical-operations">Mathematical Operations</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#operators">Operators</a></li>
<li><a class="nav-link" href="#expresions">Expresions</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#relational-conditional-and-boolean-operations">Relational, Conditional, and Boolean Operations</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#relational-and-boolean-operators">Relational and boolean operators</a></li>
<li><a class="nav-link" href="#conditional-operators">Conditional operators</a></li>
</ul>
</li>
<li><a class="nav-link" href="#convolutions">Convolutions</a></li>
<li><a class="nav-link" href="#morphological-operations">Morphological Operations</a></li>
<li><a class="nav-link" href="#gradients">Gradients</a></li>
<li><a class="nav-link" href="#edge-detection">Edge detection</a></li>
<li>
<a class="nav-link" href="#spectral-transformations">Spectral transformations</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pan-sharpening">Pan sharpening</a></li>
<li><a class="nav-link" href="#spectral-unmixing">Spectral unmixing</a></li>
</ul>
</li>
<li><a class="nav-link" href="#texture">Texture</a></li>
<li>
<a class="nav-link" href="#object-based-methods">Object-based methods</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#thermal-hotspots">Thermal hotspots</a></li>
<li><a class="nav-link" href="#label-objects">Label objects</a></li>
<li><a class="nav-link" href="#object-size">Object size</a></li>
<li><a class="nav-link" href="#filter-objects-by-size">Filter objects by size</a></li>
<li><a class="nav-link" href="#zonal-statistics">Zonal statistics</a></li>
</ul>
</li>
<li><a class="nav-link" href="#cumulative-cost-mapping">Cumulative Cost Mapping</a></li>
<li>
<a class="nav-link" href="#registering-images">Registering Images</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#image-displacement">Image displacement</a></li>
<li><a class="nav-link" href="#warping-an-image">Warping an image</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/r-earthengine/rgeebook/blob/master/chapters/05_object_methods.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/r-earthengine/rgeebook/edit/master/chapters/05_object_methods.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Earth Engine with R</strong>" was written by rgee team. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
